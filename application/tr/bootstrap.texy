Bootstrap
*********

<div class=perex>

Bootstrap, ortamÄ± baÅŸlatan, bir baÄŸÄ±mlÄ±lÄ±k enjeksiyonu (DI) konteyneri oluÅŸturan ve uygulamayÄ± baÅŸlatan Ã¶nyÃ¼kleme kodudur. TartÄ±ÅŸacaÄŸÄ±z:

- NEON dosyalarÄ±nÄ± kullanarak uygulamanÄ±zÄ± nasÄ±l yapÄ±landÄ±rÄ±rsÄ±nÄ±z
- Ã¼retim ve geliÅŸtirme modlarÄ±nÄ±n nasÄ±l ele alÄ±nacaÄŸÄ±
- DI konteyneri nasÄ±l oluÅŸturulur

</div>


Ä°ster web tabanlÄ± ister komut satÄ±rÄ± komut dosyalarÄ± olsun, uygulamalar bir tÃ¼r ortam baÅŸlatma ile baÅŸlar. Eski zamanlarda, bundan sorumlu olan ve baÅŸlangÄ±Ã§ dosyasÄ±na dahil edilen eg `include.inc.php` adlÄ± bir dosya olabilirdi.
Modern Nette uygulamalarÄ±nda bunun yerini, uygulamanÄ±n bir parÃ§asÄ± olarak `app/Bootstrap.php` adresinde bulunabilen `Bootstrap` sÄ±nÄ±fÄ± almÄ±ÅŸtÄ±r. Ã–rneÄŸin aÅŸaÄŸÄ±daki gibi gÃ¶rÃ¼nebilir:

```php
use Nette\Bootstrap\Configurator;

class Bootstrap
{
	private Configurator $configurator;
	private string $rootDir;

	public function __construct()
	{
		$this->rootDir = dirname(__DIR__);
		// YapÄ±landÄ±rÄ±cÄ±, uygulama ortamÄ±nÄ± ve hizmetlerini ayarlamaktan sorumludur.
		$this->configurator = new Configurator;
		// Nette tarafÄ±ndan oluÅŸturulan geÃ§ici dosyalar iÃ§in dizini ayarlayÄ±n (Ã¶rn. derlenmiÅŸ ÅŸablonlar)
		$this->configurator->setTempDirectory($this->rootDir . '/temp');
	}

	public function bootWebApplication(): Nette\DI\Container
	{
		$this->initializeEnvironment();
		$this->setupContainer();
		return $this->configurator->createContainer();
	}

	private function initializeEnvironment(): void
	{
		// Nette akÄ±llÄ±dÄ±r ve geliÅŸtirme modu otomatik olarak aÃ§Ä±lÄ±r,
		// ya da aÅŸaÄŸÄ±daki satÄ±rÄ±n yorumunu kaldÄ±rarak belirli bir IP adresi iÃ§in etkinleÅŸtirebilirsiniz:
		// $this->configurator->setDebugMode('secret@23.75.345.200');

		// Tracy'yi etkinleÅŸtirir: nihai "Ä°sviÃ§re Ã§akÄ±sÄ±" hata ayÄ±klama aracÄ±.
		$this->configurator->enableTracy($this->rootDir . '/log');

		// RobotLoader: verilen dizindeki tÃ¼m sÄ±nÄ±flarÄ± otomatik yÃ¼kler
		$this->configurator->createRobotLoader()
			->addDirectory(__DIR__)
			->register();
	}

	private function setupContainer(): void
	{
		// YapÄ±landÄ±rma dosyalarÄ±nÄ± yÃ¼kle
		$this->configurator->addConfig($this->rootDir . '/config/common.neon');
	}
}
```


index.php .[#toc-index-php]
===========================

Web uygulamalarÄ± iÃ§in baÅŸlangÄ±Ã§ dosyasÄ± `index.php`, `www/` genel dizininde bulunur. OrtamÄ± baÅŸlatmak ve bir DI konteyneri oluÅŸturmak iÃ§in `Bootstrap` sÄ±nÄ±fÄ±nÄ± kullanÄ±r. ArdÄ±ndan, web uygulamasÄ±nÄ± baÅŸlatan kapsayÄ±cÄ±dan `Application` hizmetini alÄ±r:

```php
$bootstrap = new App\Bootstrap;
// OrtamÄ± baÅŸlatma + bir DI konteyneri oluÅŸturma
$container = $bootstrap->bootWebApplication();
// DI konteyneri bir Nette\Application\Application nesnesi oluÅŸturur
$application = $container->getByType(Nette\Application\Application::class);
// Nette uygulamasÄ±nÄ± baÅŸlatÄ±n ve gelen isteÄŸi iÅŸleyin
$application->run();
```

GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z gibi, ÅŸimdi daha ayrÄ±ntÄ±lÄ± olarak tanÄ±tacaÄŸÄ±mÄ±z [api:Nette\Bootstrap\Configurator] sÄ±nÄ±fÄ±, ortamÄ±n ayarlanmasÄ±na ve bir baÄŸÄ±mlÄ±lÄ±k enjeksiyonu (DI) konteyneri oluÅŸturulmasÄ±na yardÄ±mcÄ± olur.


GeliÅŸtirme ve Ãœretim Modu .[#toc-development-vs-production-mode]
================================================================

Nette, bir geliÅŸtirme veya Ã¼retim sunucusunda Ã§alÄ±ÅŸmasÄ±na baÄŸlÄ± olarak farklÄ± davranÄ±r:

ğŸ› ï¸ GeliÅŸtirme Modu:
	- Tracy hata ayÄ±klama Ã§ubuÄŸunu yararlÄ± bilgilerle birlikte gÃ¶rÃ¼ntÃ¼ler (Ã¶rn. SQL sorgularÄ±, yÃ¼rÃ¼tme sÃ¼resi, bellek kullanÄ±mÄ±).
	- Bir hata oluÅŸtuÄŸunda iÅŸlev Ã§aÄŸrÄ±sÄ± izlerini ve deÄŸiÅŸken iÃ§eriklerini iÃ§eren ayrÄ±ntÄ±lÄ± bir hata sayfasÄ± gÃ¶sterir.
	- Latte ÅŸablonlarÄ±, yapÄ±landÄ±rma dosyalarÄ± vb. deÄŸiÅŸtirildiÄŸinde Ã¶nbelleÄŸi otomatik olarak yeniler.


ğŸš€ Ãœretim Modu:
	- Herhangi bir hata ayÄ±klama bilgisi gÃ¶stermez; tÃ¼m hatalar gÃ¼nlÃ¼ÄŸe kaydedilir.
	- Bir hata oluÅŸtuÄŸunda `ErrorPresenter` veya genel bir "Sunucu HatasÄ±" sayfasÄ± gÃ¶sterir.
	- Ã–nbellek asla otomatik olarak yenilenmez!
	- HÄ±z ve gÃ¼venlik iÃ§in optimize edilmiÅŸtir.


Mod otomatik olarak belirlenir, bu nedenle Ã§oÄŸu durumda manuel olarak yapÄ±landÄ±rmaya veya deÄŸiÅŸtirmeye gerek yoktur:

- GeliÅŸtirme modu: Bir proxy kullanÄ±lmadÄ±ÄŸÄ± sÃ¼rece (yani HTTP Ã¼stbilgilerine gÃ¶re) localhost'ta (IP adresi `127.0.0.1` veya `::1`) etkin.
- Ãœretim modu: DiÄŸer her yerde aktif.

GeliÅŸtirme modunu diÄŸer durumlarda, Ã¶rneÄŸin belirli bir IP adresinden eriÅŸen programcÄ±lar iÃ§in etkinleÅŸtirmek istiyorsanÄ±z, `setDebugMode()` adresini kullanabilirsiniz:

```php
$this->configurator->setDebugMode('23.75.345.200'); // bir veya daha fazla IP adresi
```

Bir IP adresini bir Ã§erezle birleÅŸtirmenizi kesinlikle Ã¶neririz. `nette-debug` Ã§erezine gizli bir belirteÃ§ depolayacaÄŸÄ±z, Ã¶rneÄŸin `secret1234` ve geliÅŸtirme modu, bu IP ve Ã§erez kombinasyonuna sahip programcÄ±lar iÃ§in etkinleÅŸtirilecektir.

```php
$this->configurator->setDebugMode('secret1234@23.75.345.200');
```

AyrÄ±ca localhost iÃ§in bile geliÅŸtirici modunu tamamen kapatabiliriz:

```php
$this->configurator->setDebugMode(false);
```

`true` deÄŸerinin, bir Ã¼retim sunucusunda asla gerÃ§ekleÅŸmemesi gereken geliÅŸtirici modunu zorlayarak aÃ§tÄ±ÄŸÄ±nÄ± unutmayÄ±n.


Hata AyÄ±klama AracÄ± Tracy .[#toc-debugging-tool-tracy]
======================================================

Kolay hata ayÄ±klama iÃ§in harika araÃ§ [Tracy'yi |tracy:] aÃ§acaÄŸÄ±z. GeliÅŸtirici modunda hatalarÄ± gÃ¶rselleÅŸtirir ve Ã¼retim modunda hatalarÄ± belirtilen dizine kaydeder:

```php
$this->configurator->enableTracy($this->rootDir . '/log');
```


GeÃ§ici Dosyalar .[#toc-temporary-files]
=======================================

Nette, DI konteyneri, RobotLoader, ÅŸablonlar vb. iÃ§in Ã¶nbelleÄŸi kullanÄ±r. Bu nedenle, Ã¶nbelleÄŸin depolanacaÄŸÄ± dizinin yolunu ayarlamak gerekir:

```php
$this->configurator->setTempDirectory($this->rootDir . '/temp');
```

Linux veya macOS Ã¼zerinde, `log/` ve `temp/` dizinleri iÃ§in [yazma izinlerini |nette:troubleshooting#Setting directory permissions] ayarlayÄ±n.


RobotLoader .[#toc-robotloader]
===============================

Genellikle, [RobotLoader'Ä± |robot-loader:] kullanarak sÄ±nÄ±flarÄ± otomatik olarak yÃ¼klemek isteyeceÄŸiz, bu yÃ¼zden onu baÅŸlatmalÄ± ve `Bootstrap.php` 'un bulunduÄŸu dizinden (yani `__DIR__`) ve tÃ¼m alt dizinlerinden sÄ±nÄ±flarÄ± yÃ¼klemesine izin vermeliyiz:

```php
$this->configurator->createRobotLoader()
	->addDirectory(__DIR__)
	->register();
```

Alternatif bir yol da sadece [Composer |best-practices:composer] PSR-4 otomatik yÃ¼klemeyi kullanmaktÄ±r.


Zaman Dilimi .[#toc-timezone]
=============================

YapÄ±landÄ±rÄ±cÄ±, uygulamanÄ±z iÃ§in bir saat dilimi belirlemenize olanak tanÄ±r.

```php
$this->configurator->setTimeZone('Europe/Prague');
```


DI Konteyner YapÄ±landÄ±rmasÄ± .[#toc-di-container-configuration]
==============================================================

Ã–nyÃ¼kleme sÃ¼recinin bir parÃ§asÄ±, tÃ¼m uygulamanÄ±n kalbi olan bir DI konteynerinin, yani nesneler iÃ§in bir fabrikanÄ±n oluÅŸturulmasÄ±dÄ±r. Bu aslÄ±nda Nette tarafÄ±ndan oluÅŸturulan ve bir Ã¶nbellek dizininde saklanan bir PHP sÄ±nÄ±fÄ±dÄ±r. Fabrika, temel uygulama nesnelerini Ã¼retir ve yapÄ±landÄ±rma dosyalarÄ±, bunlarÄ±n nasÄ±l oluÅŸturulacaÄŸÄ± ve yapÄ±landÄ±rÄ±lacaÄŸÄ± konusunda talimat verir ve bÃ¶ylece tÃ¼m uygulamanÄ±n davranÄ±ÅŸÄ±nÄ± etkileriz.

KonfigÃ¼rasyon dosyalarÄ± genellikle [NEON formatÄ±nda |neon:format] yazÄ±lÄ±r. [Nelerin yapÄ±landÄ±rÄ±labileceÄŸini buradan okuy abilirsiniz|nette:configuring].

.[tip]
GeliÅŸtirme modunda, kodu veya yapÄ±landÄ±rma dosyalarÄ±nÄ± her deÄŸiÅŸtirdiÄŸinizde kapsayÄ±cÄ± otomatik olarak gÃ¼ncellenir. Ãœretim modunda, yalnÄ±zca bir kez oluÅŸturulur ve performansÄ± en Ã¼st dÃ¼zeye Ã§Ä±karmak iÃ§in dosya deÄŸiÅŸiklikleri kontrol edilmez.

YapÄ±landÄ±rma dosyalarÄ± `addConfig()` kullanÄ±larak yÃ¼klenir:

```php
$this->configurator->addConfig($this->rootDir . '/config/common.neon');
```

Birden fazla dosya eklemek iÃ§in `addConfig()` yÃ¶ntemi birden fazla kez Ã§aÄŸrÄ±labilir.

```php
$configDir = $this->rootDir . '/config';
$this->configurator->addConfig($configDir . '/common.neon');
$this->configurator->addConfig($configDir . '/services.neon');
if (PHP_SAPI === 'cli') {
	$this->configurator->addConfig($configDir . '/cli.php');
}
```

`cli.php` adÄ± bir yazÄ±m hatasÄ± deÄŸildir, yapÄ±landÄ±rma bir dizi olarak dÃ¶ndÃ¼ren bir PHP dosyasÄ±na da yazÄ±labilir.

Alternatif olarak, daha fazla yapÄ±landÄ±rma dosyasÄ± yÃ¼klemek iÃ§in [`includes` bÃ¶lÃ¼mÃ¼nÃ¼ |dependency-injection:configuration#including files] kullanabiliriz.

AynÄ± anahtarlara sahip Ã¶ÄŸeler yapÄ±landÄ±rma dosyalarÄ±nda gÃ¶rÃ¼nÃ¼rse, diziler sÃ¶z konusu olduÄŸunda bunlarÄ±n [Ã¼zerine yazÄ±lÄ±r veya birleÅŸtirilir |dependency-injection:configuration#Merging]. Daha sonra dahil edilen dosyanÄ±n bir Ã¶ncekinden daha yÃ¼ksek Ã¶nceliÄŸi vardÄ±r. `includes` bÃ¶lÃ¼mÃ¼nÃ¼n listelendiÄŸi dosya, iÃ§ine dahil edilen dosyalardan daha yÃ¼ksek Ã¶nceliÄŸe sahiptir.


Statik Parametreler .[#toc-static-parameters]
---------------------------------------------

YapÄ±landÄ±rma dosyalarÄ±nda kullanÄ±lan parametreler [`parameters` bÃ¶lÃ¼mÃ¼nde |dependency-injection:configuration#parameters] tanÄ±mlanabilir ve ayrÄ±ca `addStaticParameters()` yÃ¶ntemi ( `addParameters()` takma adÄ± vardÄ±r) tarafÄ±ndan geÃ§irilebilir (veya Ã¼zerine yazÄ±labilir). FarklÄ± parametre deÄŸerlerinin ek DI konteynerlerinin, yani ek sÄ±nÄ±flarÄ±n oluÅŸturulmasÄ±na neden olmasÄ± Ã¶nemlidir.

```php
$this->configurator->addStaticParameters([
	'projectId' => 23,
]);
```

YapÄ±landÄ±rma dosyalarÄ±nda, `projectId` adlÄ± parametreye eriÅŸmek iÃ§in `%projectId%` normal notasyonunu yazabiliriz.


Dinamik Parametreler .[#toc-dynamic-parameters]
-----------------------------------------------

Konteynere dinamik parametreler de ekleyebiliriz, statik parametrelerin aksine farklÄ± deÄŸerleri yeni DI konteynerlerinin oluÅŸturulmasÄ±na neden olmaz.

```php
$this->configurator->addDynamicParameters([
	'remoteIp' => $_SERVER['REMOTE_ADDR'],
]);
```

Ortam deÄŸiÅŸkenleri dinamik parametreler kullanÄ±larak kolayca kullanÄ±labilir hale getirilebilir. Bunlara yapÄ±landÄ±rma dosyalarÄ±ndaki `%env.variable%` adresinden eriÅŸebiliriz.

```php
$this->configurator->addDynamicParameters([
	'env' => getenv(),
]);
```


VarsayÄ±lan Parametreler .[#toc-default-parameters]
--------------------------------------------------

YapÄ±landÄ±rma dosyalarÄ±nda aÅŸaÄŸÄ±daki statik parametreleri kullanabilirsiniz:

- `%appDir%`, `Bootstrap.php` dosyasÄ±nÄ±n dizinine giden mutlak yoldur
- `%wwwDir%`, `index.php` giriÅŸ dosyasÄ±nÄ± iÃ§eren dizinin mutlak yoludur
- `%tempDir%` geÃ§ici dosyalar iÃ§in dizinin mutlak yoludur
- `%vendorDir%` Composer'Ä±n kÃ¼tÃ¼phaneleri yÃ¼klediÄŸi dizinin mutlak yoludur
- `%rootDir%` projenin kÃ¶k dizinine giden mutlak yoldur
- `%debugMode%` uygulamanÄ±n hata ayÄ±klama modunda olup olmadÄ±ÄŸÄ±nÄ± gÃ¶sterir
- `%consoleMode%` isteÄŸin komut satÄ±rÄ± Ã¼zerinden gelip gelmediÄŸini gÃ¶sterir


Ä°thal Hizmetler .[#toc-imported-services]
-----------------------------------------

Åimdi daha derine iniyoruz. Bir DI konteynerinin amacÄ± nesneler oluÅŸturmak olsa da, istisnai olarak mevcut bir nesneyi konteynere ekleme ihtiyacÄ± olabilir. Bunu, servisi `imported: true` niteliÄŸi ile tanÄ±mlayarak yaparÄ±z.

```neon
services:
	myservice:
		type: App\Model\MyCustomService
		imported: true
```

Yeni bir Ã¶rnek oluÅŸturun ve bootstrap'e ekleyin:

```php
$this->configurator->addServices([
	'myservice' => new App\Model\MyCustomService('foobar'),
]);
```


FarklÄ± Ortamlar .[#toc-different-environments]
==============================================

 `Bootstrap` sÄ±nÄ±fÄ±nÄ± ihtiyaÃ§larÄ±nÄ±za gÃ¶re Ã¶zelleÅŸtirmekten Ã§ekinmeyin. Web projeleri arasÄ±nda ayrÄ±m yapmak iÃ§in `bootWebApplication()` yÃ¶ntemine parametreler ekleyebilirsiniz. Alternatif olarak, birim testleri iÃ§in ortamÄ± baÅŸlatmak Ã¼zere `bootTestEnvironment()`, komut satÄ±rÄ±ndan Ã§aÄŸrÄ±lan betikler iÃ§in `bootConsoleApplication()` gibi baÅŸka yÃ¶ntemler de ekleyebilirsiniz.

```php
public function bootTestEnvironment(): Nette\DI\Container
{
	Tester\Environment::setup(); // Nette Tester baÅŸlatma
	$this->setupContainer();
	return $this->configurator->createContainer();
}

public function bootConsoleApplication(): Nette\DI\Container
{
	$this->configurator->setDebugMode(false);
	$this->initializeEnvironment();
	$this->setupContainer();
	return $this->configurator->createContainer();
}
```
