Филтри за Latte
***************

.[perex]
Филтрите са функции, които променят или форматират данните в желаната от нас форма. Това е кратко описание на наличните вградени филтри.

.[table-latte-filters]
|## Конвертиране на редове/масиви
| `batch` | [линейно изброяване на данни в таблица |#batch]
| `breakLines` | [вмъква прекъсвания на редове в HTML преди всички нови редове |#breakLines]
| `bytes` | [форматира размера в байтове |#bytes]
| `clamp` | [ограничава стойността до определен диапазон |#clamp]
| `dataStream` | [Конвертиране на протокола за данни URI |#dataStream]
| `date` | [форматиране на датата |#date]
| `explode` | [разделя низа с даден разделител |#explode]
| `first` [връща първия елемент на масив или символен низ |#first]
| `implode` | [свързва масива с низ |#implode]
| `indent` | [отстъпи на текста наляво с броя на табулаторите |#indent]
| `join` | [обединяване на масив в низ |#implode]
| `last` | [връща последния елемент на масив или символен низ |#last]
| `length` | [връща дължината на низ или масив |#length]
| `number` | [форматира число |#number]
| `padLeft` | [допълва низа вляво |#padLeft]
| `padRight` | [допълва низа до зададена дължина надясно |#padRight]
| `random` | [връща произволен елемент от масив или символен низ |#random]
| `repeat` | [повтаря символния низ |#repeat]
| `replace` | [замества всички срещания на търсения низ със заместител |#replace]
| `replaceRE` | [замества всички срещания в съответствие с регулярен израз |#replaceRE]
| `reverse` | [инвертира низ или масив във формат UTF-8 |#reverse]
| `slice` | [извлича масив или фрагмент от низ |#slice]
| `sort` | [сортира масива |#sort]
| `spaceless` | [изтрива символите за бял интервал |#spaceless], като тага [без интервал |tags]
| `split` | [разделя низ по зададен разделител |#explode]
| `strip` | [изтриване на бели интервали |#spaceless]
| `stripHtml` | [изтрива HTML тагове и преобразува HTML обекти в текст |#stripHtml]
| `substr` | [връща част от низ |#substr]
| `trim` | [изтрива интервалите от символния низ |#trim]
| `translate` | [превод на други езици |#translate]
| `truncate` | [съкращава дължината, като запазва цели думи |#truncate]
| `webalize` | [прави така, че низът UTF-8 |#webalize] да [съответства на формата, използвана в URL адреса |#webalize]

.[table-latte-filters]
|## Азбучен регистър
| `capitalize` | [малки букви, първата буква на всяка дума е главна |#capitalize]
| `firstUpper` | [прави първата буква главна |#firstUpper]
| `lower` | [прави реда малък |#lower]
| `upper` | [прави реда главен |#upper]

.[table-latte-filters]
|## Закръгляне на числата
| `ceil` | [закръгляне на число до определена точност |#ceil]
| `floor` | [закръгляне на числото до определена точност|#floor]
| `round` | [закръгляне на число с определена точност|#round]

.[table-latte-filters]
|## ескейпинг
| `escapeUrl` | [изстъргва параметъра в URL адреса |#escapeUrl]
 `noescape` |00 | [отпечатва променливата без ескейпване |#noescape]
| `query` | [формира низ за заявка в URL адреса |#query]

Съществуват и ескейп филтри за HTML (`escapeHtml` и `escapeHtmlComment`), XML (`escapeXml`), JavaScript (`escapeJs`), CSS (`escapeCss`) и iCalendar (`escapeICal`),
които самият Latte използва благодарение на [контекстно-чувствителното ескапиране |safety-first#Context-Aware-Escaping], и не е необходимо да ги пишете.

.[table-latte-filters]
|## Сигурност
| `checkUrl` | [дезинфекцира символния низ, който ще се използва в атрибута href |#checkUrl]
| `nocheck` | [предотвратява автоматичната обработка на URL |#nocheck]

Latte [проверява |safety-first#Link-Checking] атрибутите `src` и `href` [автоматично |safety-first#Link-Checking], така че почти не е необходимо да използвате филтъра `checkUrl`.


.[note]
Всички вградени филтри работят с низове, кодирани в UTF-8.


Използване на .[#toc-usage]
===========================

Latte ви позволява да извиквате филтри, като използвате обозначението "pipe" (позволено е да се прави интервал):

```latte
<h1>{$heading|upper}</h1>
```

Филтрите могат да бъдат свързани във верига, като в този случай се прилагат в последователност отляво надясно:

```latte
<h1>{$heading|lower|capitalize}</h1>
```

Параметрите се поставят след името на филтъра, разделени с двоеточие или запетая:

```latte
<h1>{$heading|truncate:20,''}</h1>
```

Към даден израз могат да се прилагат филтри:

```latte
{var $name = ($title|upper) . ($subtitle|lower)}</h1>
```

[Потребителските филтри |extending-latte#Filters] могат да бъдат регистрирани по този начин:

```php
$latte = new Latte\Engine;
$latte->addFilter('shortify', fn(string $s, int $len = 10) => mb_substr($s, 0, $len));
```

Използваме го в шаблона по следния начин

```latte
<p>{$text|shortify}</p>
<p>{$text|shortify:100}</p>
```


Филтри .[#toc-filters]
======================


batch(int length, mixed item): array .[filter]{data-version:2.7}
----------------------------------------------------------------
Филтър, който опростява извеждането на линейни данни като таблица. Връща масив от масиви със зададен брой елементи. Ако е посочен втори параметър, той се използва за попълване на липсващите елементи в последния ред.

```latte
{var $items = ['a', 'b', 'c', 'd', 'e']}
<table>
{foreach ($items|batch: 3, 'No item') as $row}
	<tr>
		{foreach $row as $column}
			<td>{$column}</td>
		{/foreach}
	</tr>
{/foreach}
</table>
```

Отпечатъци:

```latte
<table>
	<tr>
		<td>a</td>
		<td>b</td>
		<td>c</td>
	</tr>
	<tr>
		<td>d</td>
		<td>e</td>
		<td>No item</td>
	</tr>
</table>
```


BreakLines .[#toc-breaklines]
-----------------------------
Вмъква прекъсвания на редове в HTML преди всички нови редове.

```latte
{var $s = "Text & with \n newline"}
{$s|breakLines}    {* outputs "Text & with <br>\n newline" *}
```


bytes(int precision = 2) .[filter]
----------------------------------
Форматира размера в байтове в удобна за четене от човека форма.

```latte
{$size|bytes}     0 B, 1.25 GB, …
{$size|bytes:0}   10 B, 1 GB, …
```


ceil(int precision = 0) .[filter]
---------------------------------
Закръгляне на число до зададена точност.

```latte
{=3.4|ceil}         {* outputs 4      *}
{=135.22|ceil:1}    {* outputs 135.3  *}
{=135.22|ceil:3}    {* outputs 135.22 *}
```

Вижте също [под |#floor], [кръгъл |#round].


с главна буква .[#toc-capitalize]
---------------------------------
Връща версия на стойността с главни букви. Думите ще започват с главни букви, а всички останали знаци ще бъдат малки. Изисква разширението на PHP `mbstring`.

```latte
{='i like LATTE'|capitalize}  {* outputs 'I Like Latte' *}
```

Вижте също [firstUpper |#firstUpper], [lower |#lower], [upper |#upper].


checkUrl .[#toc-checkurl]
-------------------------
Активира обработката на URL адреси. Проверява дали дадена променлива съдържа уеб адрес (т.е. протокол HTTP/HTTPS) и предотвратява записването на връзки, които могат да представляват риск за сигурността.

```latte
{var $link = 'javascript:window.close()'}
<a data-href="{$link|checkUrl}">checked</a>
<a data-href="{$link}">unchecked</a>
```

Отпечатъци:

```latte
<a data-href="">checked</a>
<a data-href="javascript:window.close()">unchecked</a>
```

Вижте също [nocheck |#nocheck].


clamp(int|float min, int|float max) .[filter]{data-version:2.9}
---------------------------------------------------------------
Връща стойността, която е вкарана в обхват от min и max.

```latte
{$level|clamp: 0, 255}
```

Съществува и като [скоба |functions#clamp].


dataStream(string mimetype = detect) .[filter]
----------------------------------------------
Конвертира съдържанието в схема за данни URI. Може да се използва за вграждане на изображения в HTML или CSS, без да е необходимо да се прави връзка към външни файлове.

Да предположим, че имате изображение в променливата `$img = Image::fromFile('obrazek.gif')`, тогава

```latte
<img src="{$img|dataStream}">
```

Отпечатъци, например:

```latte
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==">
```

.[caution]
Изисква разширение на PHP `fileinfo`.


date(string format) .[filter]
-----------------------------
Връща датата в зададен формат, като използва опциите на функцията на PHP [php:strftime] или [php:date]. Филтърът получава датата като времеви печат на UNIX, низ или тип обект `DateTime`.

```latte
{$today|date:'%d.%m.%Y'}
{$today|date:'j. n. Y'}
```


escapeUrl .[#toc-escapeurl]
---------------------------
Закрива променлива, която да се използва като параметър в URL адреса.

```latte
<a href="http://example.com/{$name|escapeUrl}">{$name}</a>
```

Вижте също [запитване |#query].


explode(string separator = '') .[filter]{data-version:2.10.2}
-------------------------------------------------------------
Разделя низ по зададен разделител и връща масив от низове. Псевдоним към `split`.

```latte
{='one,two,three'|explode:','}    {* returns ['one', 'two', 'three'] *}
```

Ако разделителят е празен низ (стойност по подразбиране), входните данни ще бъдат разделени на отделни символи:

```latte
{='123'|explode}                  {* returns ['1', '2', '3'] *}
```

Можете да използвате и псевдонима `split`:

```latte
{='1,2,3'|split:','}              {* returns ['1', '2', '3'] *}
```

Вижте също [имплозия |#implode].


first .[filter]{data-version:2.10.2}
------------------------------------
Връща първия елемент на масив или символен низ:

```latte
{=[1, 2, 3, 4]|first}    {* outputs 1 *}
{='abcd'|first}          {* outputs 'a' *}
```

Вижте също [последен |#last], [случаен |#random].


floor(int precision = 0) .[filter]
----------------------------------
Закръгляне на число до зададена точност.

```latte
{=3.5|floor}        {* outputs 3      *}
{=135.79|floor:1}   {* outputs 135.7  *}
{=135.79|floor:3}   {* outputs 135.79 *}
```

Вижте също [таван |#ceil], [кръг. |#round]


firstUpper .[#toc-firstupper]
-----------------------------
Преобразува първата буква на стойността в главни букви. Изисква разширението на PHP `mbstring`.

```latte
{='the latte'|firstUpper}  {* outputs 'The latte' *}
```

Вижте също [главни |#capitalize] букви, [малки букви |#lower], [големи букви |#upper].


implode(string glue = '') .[filter]
-----------------------------------
Връща низ, който е конкатенация на низове в масив. Псевдонимът на `join`.

```latte
{=[1, 2, 3]|implode}      {* outputs '123' *}
{=[1, 2, 3]|implode:'|'}  {* outputs '1|2|3' *}
```

Можете да използвате и псевдонима `join`: .{data-version:2.10.2}

```latte
{=[1, 2, 3]|join}         {* outputs '123' *}
```


indent(int level = 1, string char = "\t") .[filter]
---------------------------------------------------
Отстъпване на текста отляво с определен брой табулации или други символи, които се посочват във втория незадължителен аргумент. Празните редове не се отстъпват.

```latte
<div>
{block |indent}
<p>Hello</p>
{/block}
</div>
```

Отпечатъци:

```latte
<div>
	<p>Hello</p>
</div>
```


last .[filter]{data-version:2.10.2}
-----------------------------------
Връща последния елемент на масив или символен низ:

```latte
{=[1, 2, 3, 4]|last}    {* outputs 4 *}
{='abcd'|last}          {* outputs 'd' *}
```

Вижте също [първи |#first], [случаен |#random].


дължина .[#toc-length]
----------------------
Връща дължината на низ или масив.

- За низове връща дължината в UTF-8 символи.
- за масиви връща броя на елементите
- за обектите, които имплементират интерфейса Countable, ще се използва върнатата стойност на функцията count()
- за обекти, които имплементират интерфейса IteratorAggregate, ще се използва върнатата стойност на iterator_count()


```latte
{if ($users|length) > 10}
	...
{/if}
```


по-нисък .[#toc-lower]
----------------------
Преобразува стойността в малки букви. Изисква разширението на PHP `mbstring`.

```latte
{='LATTE'|lower}   {* outputs 'latte' *}
```

Вижте също [capitalize |#capitalize], [firstUpper |#firstUpper], [upper |#upper].


nocheck .[#toc-nocheck]
-----------------------
Предотвратява автоматичното обработване на URL адресите. Latte [автоматично проверява |safety-first#Link-Checking] дали дадена променлива съдържа уеб адрес (т.е. протокол HTTP/HTTPS) и предотвратява записването на връзки, които могат да представляват риск за сигурността.

Ако дадена връзка използва друга схема, например `javascript:` или `data:`, и сте сигурни в нейното съдържание, можете да деактивирате проверката чрез `|nocheck`.

```latte
{var $link = 'javascript:window.close()'}

<a href="{$link}">checked</a>
<a href="{$link|nocheck}">unchecked</a>
```

Печатни издания:

```latte
<a href="">checked</a>
<a href="javascript:window.close()">unchecked</a>
```

Вижте също [checkUrl |#checkUrl].


noescape .[#toc-noescape]
-------------------------
Деактивира автоматичната проверка на екрана.

```latte
{var $trustedHtmlString = '<b>hello</b>'}
Escaped: {$trustedHtmlString}
Unescaped: {$trustedHtmlString|noescape}
```

Отпечатъци:

```latte
Escaped: &lt;b&gt;hello&lt;/b&gt;
Unescaped: <b>hello</b>
```

.[warning]
Неправилното използване на филтъра `noescape` може да доведе до уязвимост XSS! Никога не го използвайте, освен ако не сте абсолютно сигурни** в това, което правите, и че низът, който отпечатвате, е от надежден източник.


number(int decimals = 0, string decPoint = '.', string thousandsSep = ',') .[filter]
------------------------------------------------------------------------------------
Форматира число с посочения брой знаци след десетичната запетая. Можете също така да посочите десетичната запетая и разделителя за хиляди.

```latte
{1234.20 |number}              1,234
{1234.20 |number:1}            1,234.2
{1234.20 |number:2}            1,234.20
{1234.20 |number:2, ',', ' '}  1 234,20
```


padLeft(int length, string pad = ' ') .[filter]
-----------------------------------------------
Добавя низ с определена дължина към друг низ вляво.

```latte
{='hello'|padLeft: 10, '123'}  {* outputs '12312hello' *}
```


padRight(int length, string pad = ' ') .[filter]
------------------------------------------------
Добавя низ с определена дължина към друг низ вдясно.

```latte
{='hello'|padRight: 10, '123'}  {* outputs 'hello12312' *}
```


заявка .[#toc-query]
--------------------
Динамично генериране на низ от заявки в URL адреса:

```latte
<a href="http://example.com/?{[name: 'John Doe', age: 43]|query}">click</a>
<a href="http://example.com/?search={$search|query}">search</a>
```

Отпечатъци:

```latte
<a href="http://example.com/?name=John+Doe&amp;age=43">click</a>
<a href="http://example.com/?search=Foo+Bar">search</a>
```

Ключовете със стойност `null` се пропускат.

Вижте също [escapeUrl |#escapeUrl].


random .[filter]{data-version:2.10.2}
-------------------------------------
Връща произволен елемент от масив или символен низ:

```latte
{=[1, 2, 3, 4]|random}    {* example output: 3 *}
{='abcd'|random}          {* example output: 'b' *}
```

Вижте също [първи |#first], [последен |#last].


repeat(int count) .[filter]
---------------------------
Повтаря символния низ x пъти.

```latte
{='hello'|repeat: 3}  {* outputs 'hellohellohello' *}
```


replace(string|array search, string replace = '') .[filter]
-----------------------------------------------------------
Заменя всички срещания на низ за търсене с низ за замяна.

```latte
{='hello world'|replace: 'world', 'friend'}  {* outputs 'hello friend' *}
```

Могат да се направят няколко замени едновременно: .{data-version:2.10.2}

```latte
{='hello world'|replace: [h => l, l => h]}  {* outputs 'lehho worhd' *}
```


replaceRE(string pattern, string replace = '') .[filter]
--------------------------------------------------------
Заменя всички срещания в съответствие с регулярен израз.

```latte
{='hello world'|replaceRE: '/l.*/', 'l'}  {* outputs 'hel' *}
```


обратен .[#toc-reverse]
-----------------------
Обръща даден низ или масив.

```latte
{var $s = 'Nette'}
{$s|reverse}    {* outputs 'etteN' *}
{var $a = ['N', 'e', 't', 't', 'e']}
{$a|reverse}    {* returns ['e', 't', 't', 'e', 'N'] *}
```


round(int precision = 0) .[filter]
----------------------------------
Закръгляне на число до зададена точност.

```latte
{=3.4|round}        {* outputs 3      *}
{=3.5|round}        {* outputs 4      *}
{=135.79|round:1}   {* outputs 135.8  *}
{=135.79|round:3}   {* outputs 135.79 *}
```

Вижте също [таван |#ceil], [под. |#floor]


slice(int start, int length = null, bool preserveKeys = false) .[filter]{data-version:2.10.2}
---------------------------------------------------------------------------------------------
Извлича фрагмент от масив или низ.

```latte
{='hello'|slice: 1, 2}           {* outputs 'el' *}
{=['a', 'b', 'c']|slice: 1, 2}   {* outputs ['b', 'c'] *}
```

Филтърът за парчета работи като функцията на PHP `array_slice` за масиви и `mb_substr` за низове, като се връща към `iconv_substr` в режим UTF-8.

Ако start е неотрицателно число, последователността ще започне от това начало в променлива. Ако началната стойност е отрицателна, последователността ще започне на това разстояние от края на променливата.

Ако е зададена дължина и тя е положителна, последователността ще съдържа до този брой елементи. Ако променливата е по-къса от дължината, ще бъдат представени само наличните елементи на променливата. Ако е зададена дължина и тя е отрицателна, последователността ще спре на толкова елемента от края на променливата. Ако не е зададена дължина, последователността ще съдържа всички елементи от отместването до края на променливата.

Филтърът по подразбиране пренарежда и нулира ключовете на масив от цели числа. Това поведение може да бъде променено чрез задаване на preserveKeys на true. Ключовете на низове винаги се запазват, независимо от този параметър.


сортиране .[#toc-sort]
----------------------
Филтър, който сортира масива и съхранява асоциацията на индексите.

```latte
{foreach ($names|sort) as $name}
	...
{/foreach}
```

Масивът се подрежда в обратен ред.

```latte
{foreach ($names|sort|reverse) as $name}
	...
{/foreach}
```

Можете да подадете своя собствена функция за сравнение като параметър: .{data-version:2.10.2}

```latte
{var $sorted = ($names|sort: fn($a, $b) => $b <=> $a)}
```


без пространство .[#toc-spaceless]
----------------------------------
Премахва ненужните бели полета от изхода. Можете да използвате и псевдонима `strip`.

```latte
{block |spaceless}
	<ul>
		<li>Hello</li>
	</ul>
{/block}
```

Отпечатъци:

```latte
<ul> <li>Hello</li> </ul>
```


stripHtml .[#toc-striphtml]
---------------------------
Конвертира HTML в обикновен текст. Това означава, че той премахва HTML таговете и преобразува HTML единиците в текст.

```latte
{='<p>one &lt; two</p>'|stripHtml}  {* outputs 'one < two' *}
```

Полученият обикновен текст естествено може да съдържа символи, представляващи HTML тагове, например `'&lt;p&gt;'|stripHtml` се преобразува в `<p>`. Никога не извеждайте получения текст от `|noescape`, тъй като това може да доведе до уязвимост в сигурността.


substr(int offset, int length = null) .[filter]
-----------------------------------------------
Извличане на фрагмент от низ. Този филтър е заменен с филтър за [резени |#slice].

```latte
{$string|substr: 1, 2}
```


translate(string message, ...args) .[filter]{data-version:3.0}
--------------------------------------------------------------
Превежда изрази на други езици. За да направите филтъра достъпен, трябва да [настроите преводач |develop#TranslatorExtension]. Можете също така да използвате [етикети за превод |tags#Translation].

```latte
<a href="basket">{='Baskter'|translate}</a>
<span>{$item|translate}</span>
```


trim(string charlist = " \t\n\r\0\x0B\u{A0}") .[filter]
-------------------------------------------------------
Зачеркнете водещите и последващите символи, по подразбиране интервали.

```latte
{='  I like Latte.  '|trim}    {* outputs 'I like Latte.' *}
{='  I like Latte.'|trim: '.'} {* outputs '  I like Latte' *}
```


truncate(int length, string append = '…') .[filter]
---------------------------------------------------
Съкращава даден низ до зададената максимална дължина, но се опитва да запази цели думи. Ако символният низ е съкратен, в края се добавя елипса (това може да се промени с втория параметър).

```latte
{var $title = 'Hello, how are you?'}
{$title|truncate:5}  {* Hell…                *}
{$title|truncate:17} {* Hello, how are…      *}
{$title|truncate:30} {* Hello, how are you?  *}
```


горна част .[#toc-upper]
------------------------
Преобразува стойността в главни букви. Изисква разширението на PHP `mbstring`.

```latte
{='latte'|upper}  {* outputs 'LATTE' *}
```

Вижте също [главни букви |#capitalize], [firstUpper |#firstUpper], [lower |#lower].


Webalize .[#toc-webalize]
-------------------------
Конвертира в ASCII.

Превръща интервалите в тирета. Премахва знаци, които не са буквено-цифрови, подчертавания или тирета. Преобразува в малки букви. Също така премахва началните и крайните бели символи.

```latte
{var $s = 'Our 10. product'}
{$s|webalize}    {* outputs 'our-10-product' *}
```

.[caution]
Изисква пакета [nette/utils |utils:].
