Eciovni - generátor faktur
********************

.[perex]
Tento plugin umožňuje vytvářet faktury na základě Nette šablony a použití knihovny "mPDF":http://www.mpdf1.com/.

|Verze | 1.0
|GitHub | http://github.com/OndrejBrejla/Eciovni
|Packagist| http://packagist.org/packages/OndrejBrejla/Eciovni
|Ukázka | [PDF faktura | attachment:invoice.pdf]
|Forum thread | http://forum.nette.org/cs/1710-generator-faktur-nette-sablony-mpdf
|Autor | Ondřej Brejla
|Licence | New BSD License

Instalace
=========

Composer / Packagist
--------------------
Jeden z distribučních kanálů **Eciovni** je "Packagist":http://packagist.org/, repozitář "Composeru":http://getcomposer.org/. Pokud jste tedy zvyklí používat Composer pro správu závislostí vašich projektů, jednoduše deklarujte novou závislost. A to závislost na `"OndrejBrejla/Eciovni": "*"`. Následně balík klasicky doinstalujte.

GitHub
------
Pokud je vám bližší klasické stažení zdrojových kódů, můžete tak učinit z hlavního repozitáře projektu, z  "GitHubu":https://github.com/OndrejBrejla/Eciovni. Stažené soubory vložte do vašeho `LIBS_DIR` adrešáře (resp. do adresáře, který je indexován `RobotLoader`em).

mPDF
----
Stáhněte "mPDF":http://www.mpdf1.com/mpdf/download a vložte ho do vašeho `LIBS_DIR` adresáře. Nezapomeňte `RobotLoader`u zakázat indexování adresáře `mPDF` pomocí dorektivy `Disallow: /MPDF54/` v souboru `netterobots.txt` (tento soubor vytvořte ve vašem `LIBS_DIR` adresáři).

Podpisový obrázek
-----------------
Pro vložení vlastního obrázku razítka s podpisem je potřeba upravit šablonu `Eciovni.latte`. Na jejím konci je HTML image tag s prázdnou cestou, tu je potřeba doplnit.

/--html
<img src="" alt="Razitko s podpisem" />
\--

Příklad použití
===============

Ukázkový presenter
------------------
/--php
<?php

use OndrejBrejla\Eciovni\Eciovni;
use OndrejBrejla\Eciovni\ParticipantBuilder;
use OndrejBrejla\Eciovni\ItemImpl;
use OndrejBrejla\Eciovni\DataBuilder;
use OndrejBrejla\Eciovni\TaxImpl;

class EciovniPresenter extends BasePresenter {

    protected function createComponentEciovni() {
        $dateNow = new DateTime();
        $dateExp = new DateTime();
        $dateExp->modify('+14 days');
        $variableSymbol = '1234';

        $supplierBuilder = new ParticipantBuilder('František Vosáhlo', 'Uličná', '11', 'Praha 3 - Žižkov', '13000');
        $supplier = $supplierBuilder->setIn('12345678')->setTin('CZ12345678')->setAccountNumber('123456789 / 1111')->build();
        $customerBuilder = new ParticipantBuilder('Antonie Vosáhlová', 'Cizácká', '3', 'Praha 9 - Prosek', '19000');
        $customer = $customerBuilder->setAccountNumber('123456789 / 1111')->build();

        $items = array(
            new ItemImpl('Testovací položka - from percent', 1, 900, TaxImpl::fromPercent(22)),
            new ItemImpl('Testovací položka - from lower decimal', 1, 900, TaxImpl::fromLowerDecimal(0.22)),
            new ItemImpl('Testovací položka - from upper decimal', 1, 900, TaxImpl::fromUpperDecimal(1.22)),
        );

        $dataBuilder = new DataBuilder(date('YmdHis'), 'Daňový doklad, č.', $supplier, $customer, $dateExp, $dateNow, $items);
        $dataBuilder->setVariableSymbol($variableSymbol)->setDateOfVatRevenueRecognition($dateNow);
        $data = $dataBuilder->build();

        return new Eciovni($data);
    }

    public function actionGenerate() {
        include_once(LIBS_DIR . '/MPDF54/mpdf.php');
        $mpdf = new \mPDF('utf-8');

        // Exportování připravené faktury do PDF.
        // Pro uložení faktury do souboru použijte druhý a třetí parametr, stejně jak je popsáno v dokumentaci k mPDF->Output().
        $this['eciovni']->exportToPdf($mpdf);
    }

}
\--

Generování PDF
--------------
Pro vygenerování faktury stačí zavolat metodu `actionGenerate()`, např. v šabloně pomocí odkazu:
/--html
<a n:href="Eciovni:generate">Vygenerovat fakturu</a>
\--

Prosté HTML zobrazení
---------------------
Fakturu lze v šablonách také bez problémů zobrazit jako klasické HTML. Stačí využít klasického zápisu pro vykreslení `controlu`, tedy:
/--html
{control eciovni}
\--

.[note]
Komponenta vykresluje kompletní HTML se všemi klasickými tagy (včetně `html`, `head`, `body`, atd.)

{{author: Ondřej Brejla|1672}}
