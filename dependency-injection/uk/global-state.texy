–ì–ª–æ–±–∞–ª—å–Ω–∞ –¥–µ—Ä–∂–∞–≤–∞ —Ç–∞ –æ–¥–∏–Ω–∞–∫–∏
****************************

.[perex]
–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è: –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —î —Å–∏–º–ø—Ç–æ–º–∞–º–∏ –ø–æ–≥–∞–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω—É –∫–æ–¥—É:

- `Foo::getInstance()`
- `DB::insert(...)`
- `Article::setDb($db)`
- `ClassName::$var` –∞–±–æ `static::$var`

–£ –≤–∞—à–æ–º—É –∫–æ–¥—ñ –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è –±—É–¥—å-—è–∫–∞ –∑ —Ü–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π? –¢–æ–¥—ñ —É –≤–∞—Å —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –π–æ–≥–æ. –ú–æ–∂–ª–∏–≤–æ, –≤–∏ –¥—É–º–∞—î—Ç–µ, —â–æ —Ü–µ –∑–≤–∏—á–∞–π–Ω—ñ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, —è–∫—ñ –º–∏ –±–∞—á–∏–º–æ —É –∑—Ä–∞–∑–∫–∞—Ö —Ä—ñ—à–µ–Ω—å —Ä—ñ–∑–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ —Ç–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤.
–ù–∞ –∂–∞–ª—å, –≤–æ–Ω–∏ –≤—Å–µ —â–µ —î —è–≤–Ω–∏–º —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –ø–æ–≥–∞–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω—É. –á—Ö –æ–±'—î–¥–Ω—É—î –æ–¥–Ω–µ: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É.

–ó–≤—ñ—Å–Ω–æ, –º–∏ –Ω–µ –≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —è–∫—É—Å—å –∞–∫–∞–¥–µ–º—ñ—á–Ω—É —á–∏—Å—Ç–æ—Ç—É. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —Ç–∞ —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω—ñ–≤ —Ä—É–π–Ω—ñ–≤–Ω–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —è–∫—ñ—Å—Ç—å –∫–æ–¥—É. –ô–æ–≥–æ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Å—Ç–∞—î –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—é, –∑–Ω–∏–∂—É—î –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ —ñ –∑–º—É—à—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –∫–ª–∞—Å—ñ–≤ –±—Ä–µ—Ö–∞—Ç–∏ –ø—Ä–æ —Å–≤–æ—ó —Å–ø—Ä–∞–≤–∂–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –©–æ –∑–±–∏–≤–∞—î –∑ –ø–∞–Ω—Ç–µ–ª–∏–∫—É –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç—ñ–≤.

–£ —Ü—ñ–π –≥–ª–∞–≤—ñ –º–∏ –ø–æ–∫–∞–∂–µ–º–æ, —è–∫ —Ü–µ –º–æ–∂–ª–∏–≤–æ.


–ì–ª–æ–±–∞–ª—å–Ω–µ –≤–∑–∞—î–º–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è .[#toc-global-interlinking]
-------------------------------------------------------

–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ—é –ø—Ä–æ–±–ª–µ–º–æ—é –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —î —Ç–µ, —â–æ –≤—ñ–Ω —î –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º. –¶–µ —Ä–æ–±–∏—Ç—å –º–æ–∂–ª–∏–≤–∏–º –∑–∞–ø–∏—Å –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–∏–π (—Å—Ç–∞—Ç–∏—á–Ω–∏–π) –º–µ—Ç–æ–¥ `DB::insert()`.
–í —ñ–¥–µ–∞–ª—å–Ω–æ–º—É —Å–≤—ñ—Ç—ñ –æ–±'—î–∫—Ç –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ —Ç–∏–º–∏ –æ–±'—î–∫—Ç–∞–º–∏, —è–∫—ñ –±—É–ª–∏ –π–æ–º—É [–±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø–µ—Ä–µ–¥–∞–Ω—ñ |passing-dependencies].
–Ø–∫—â–æ —è —Å—Ç–≤–æ—Ä—é—é –¥–≤–∞ –æ–±'—î–∫—Ç–∏ `A` —ñ `B` —ñ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ `A` –Ω–∞ `B`, —Ç–æ –Ω—ñ `A`, –Ω—ñ `B` –Ω–µ –∑–º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–æ–≥–æ –æ–±'—î–∫—Ç–∞ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ —Å—Ç–∞–Ω.
–¶–µ –¥—É–∂–µ –±–∞–∂–∞–Ω–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –∫–æ–¥—É. –¶–µ —Å—Ö–æ–∂–µ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–π–∫–∏ —ñ –ª–∞–º–ø–æ—á–∫–∏; –ª–∞–º–ø–æ—á–∫–∞ –Ω–µ –∑–∞—Å–≤—ñ—Ç–∏—Ç—å—Å—è, –ø–æ–∫–∏ –≤–∏ –Ω–µ –∑'—î–¥–Ω–∞—î—Ç–µ —ó—Ö —Ä–∞–∑–æ–º.

–¶–µ –Ω–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö (—Å—Ç–∞—Ç–∏—á–Ω–∏—Ö) –∑–º—ñ–Ω–Ω–∏—Ö –∞–±–æ —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω—ñ–≤. –û–±'—î–∫—Ç `A` –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ *–±–µ–∑–¥—Ä–æ—Ç–æ–≤–∏–π* –¥–æ—Å—Ç—É–ø –¥–æ –æ–±'—î–∫—Ç–∞ `C` —ñ –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –π–æ–≥–æ, –Ω–µ –ø–µ—Ä–µ–¥–∞—é—á–∏ –∂–æ–¥–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `C::changeSomething()`.
–Ø–∫—â–æ –æ–±'—î–∫—Ç `B` —Ç–∞–∫–æ–∂ –∑–∞—Ö–æ–ø–ª—é—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π `C`, —Ç–æ `A` —ñ `B` –º–æ–∂—É—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –æ–¥–∏–Ω –∑ –æ–¥–Ω–∏–º —á–µ—Ä–µ–∑ `C`.

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö –≤–≤–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –Ω–æ–≤—É —Ñ–æ—Ä–º—É *–±–µ–∑–¥—Ä–æ—Ç–æ–≤–æ–≥–æ* –∑–≤'—è–∑–∫—É, —è–∫—É –Ω–µ –≤–∏–¥–Ω–æ –∑–∑–æ–≤–Ω—ñ.
–¶–µ —Å—Ç–≤–æ—Ä—é—î –¥–∏–º–æ–≤—É –∑–∞–≤—ñ—Å—É, —â–æ —É—Å–∫–ª–∞–¥–Ω—é—î —Ä–æ–∑—É–º—ñ–Ω–Ω—è —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–¥—É.
–†–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ —á–∏—Ç–∞—Ç–∏ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É, —â–æ–± –ø–æ-—Å–ø—Ä–∞–≤–∂–Ω—å–æ–º—É –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø—Ä–æ—Å—Ç–æ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∫–ª–∞—Å—ñ–≤.
–î–æ —Ç–æ–≥–æ –∂, —Ü–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∞ –∑–≤'—è–∑–∫–∞.

.[note]
–ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É –ø–æ–≤–µ–¥—ñ–Ω–∫–∏, –Ω–µ–º–∞—î –Ω—ñ—è–∫–æ—ó —Ä—ñ–∑–Ω–∏—Ü—ñ –º—ñ–∂ –≥–ª–æ–±–∞–ª—å–Ω–æ—é —ñ —Å—Ç–∞—Ç–∏—á–Ω–æ—é –∑–º—ñ–Ω–Ω–æ—é. –í–æ–Ω–∏ –æ–¥–Ω–∞–∫–æ–≤–æ —à–∫—ñ–¥–ª–∏–≤—ñ.


–°—Ç—Ä–∞—à–Ω–∞ –¥—ñ—è –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ .[#toc-the-spooky-action-at-a-distance]
---------------------------------------------------------------

"–ú–æ—Ç–æ—Ä–æ—à–Ω–∞ –¥—ñ—è –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ" - —Ç–∞–∫ –ê–ª—å–±–µ—Ä—Ç –ï–π–Ω—à—Ç–µ–π–Ω –Ω–∞–∑–≤–∞–≤ —è–≤–∏—â–µ —É –∫–≤–∞–Ω—Ç–æ–≤—ñ–π —Ñ—ñ–∑–∏—Ü—ñ, –≤—ñ–¥ —è–∫–æ–≥–æ —É 1935 —Ä–æ—Ü—ñ —É –Ω—å–æ–≥–æ –º—É—Ä–∞—à–∫–∏ –ø–æ —à–∫—ñ—Ä—ñ.
–¶–µ –∫–≤–∞–Ω—Ç–æ–≤–∞ –∑–∞–ø–ª—É—Ç–∞–Ω—ñ—Å—Ç—å, –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å —è–∫–æ—ó –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –∫–æ–ª–∏ –≤–∏ –≤–∏–º—ñ—Ä—é—î—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ–¥–Ω—É —á–∞—Å—Ç–∏–Ω–∫—É, –≤–∏ –æ–¥—Ä–∞–∑—É –∂ –≤–ø–ª–∏–≤–∞—î—Ç–µ –Ω–∞ —ñ–Ω—à—É —á–∞—Å—Ç–∏–Ω–∫—É, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –º—ñ–ª—å–π–æ–Ω—ñ–≤ —Å–≤—ñ—Ç–ª–æ–≤–∏—Ö —Ä–æ–∫—ñ–≤ –æ–¥–Ω–∞ –≤—ñ–¥ –æ–¥–Ω–æ—ó.
–©–æ, –∑–¥–∞–≤–∞–ª–æ—Å—è –±, –ø–æ—Ä—É—à—É—î —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π –∑–∞–∫–æ–Ω –í—Å–µ—Å–≤—ñ—Ç—É, –∑–≥—ñ–¥–Ω–æ –∑ —è–∫–∏–º –Ω—ñ—â–æ –Ω–µ –º–æ–∂–µ —Ä—É—Ö–∞—Ç–∏—Å—è —à–≤–∏–¥—à–µ –∑–∞ —Å–≤—ñ—Ç–ª–æ.

–£ —Å–≤—ñ—Ç—ñ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–∏ –º–æ–∂–µ–º–æ –Ω–∞–∑–≤–∞—Ç–∏ "–º–æ—Ç–æ—Ä–æ—à–Ω–æ—é –¥—ñ—î—é –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ" —Å–∏—Ç—É–∞—Ü—ñ—é, –∫–æ–ª–∏ –º–∏ –∑–∞–ø—É—Å–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –≤–≤–∞–∂–∞—î–º–æ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–º (–±–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–ª–∏ –π–æ–º—É –∂–æ–¥–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å), –∞–ª–µ —É –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö —Å–∏—Å—Ç–µ–º–∏ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó —Ç–∞ –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É, –ø—Ä–æ —è–∫—ñ –º–∏ –Ω–µ –ø–æ–≤—ñ–¥–æ–º–∏–ª–∏ –æ–±'—î–∫—Ç—É. –¶–µ –º–æ–∂–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω.

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –ø—Ä–∏—î–¥–Ω–∞–ª–∏—Å—è –¥–æ –∫–æ–º–∞–Ω–¥–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø—Ä–æ–µ–∫—Ç—É, —è–∫–∞ –º–∞—î –≤–µ–ª–∏–∫—É, –∑—Ä—ñ–ª—É –∫–æ–¥–æ–≤—É –±–∞–∑—É. –í–∞—à –Ω–æ–≤–∏–π –∫–µ—Ä—ñ–≤–Ω–∏–∫ –ø—Ä–æ—Å–∏—Ç—å –≤–∞—Å —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é —ñ, —è–∫ —Ö–æ—Ä–æ—à–∏–π —Ä–æ–∑—Ä–æ–±–Ω–∏–∫, –≤–∏ –ø–æ—á–∏–Ω–∞—î—Ç–µ –∑ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ç–µ—Å—Ç—É. –ê–ª–µ –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –Ω–æ–≤–∞—á–æ–∫ —É –ø—Ä–æ–µ–∫—Ç—ñ, –≤–∏ —Ä–æ–±–∏—Ç–µ –±–∞–≥–∞—Ç–æ –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫–∏—Ö —Ç–µ—Å—Ç—ñ–≤ —Ç–∏–ø—É "—â–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è, —è–∫—â–æ —è –≤–∏–∫–ª–∏—á—É —Ü–µ–π –º–µ—Ç–æ–¥". –Ü –≤–∏ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—è –Ω–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ç–µ—Å—Ç:

```php
function testCreditCardCharge()
{
	$cc = new CreditCard('1234567890123456', 5, 2028); // –Ω–æ–º–µ—Ä –≤–∞—à–æ—ó –∫–∞—Ä—Ç–∫–∏
	$cc->charge(100);
}
```

–í–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –∫–æ–¥, –º–æ–∂–ª–∏–≤–æ, –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤, —ñ —á–µ—Ä–µ–∑ –¥–µ—è–∫–∏–π —á–∞—Å –ø–æ–º—ñ—á–∞—î—Ç–µ –Ω–∞ —Å–≤–æ—î–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –±–∞–Ω–∫—É –ø—Ä–æ —Ç–µ, —â–æ –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –≤–∏ –π–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–ª–∏, –∑ –≤–∞—à–æ—ó –∫—Ä–µ–¥–∏—Ç–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏ –±—É–ª–æ –∑–Ω—è—Ç–æ $100 ü§¶‚Äç‚ôÇÔ∏è.

–Ø–∫ —Ç–µ—Å—Ç –º—ñ–≥ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–µ —Å–ø–∏—Å–∞–Ω–Ω—è –∫–æ—à—Ç—ñ–≤? –ü—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –∫—Ä–µ–¥–∏—Ç–Ω–æ—é –∫–∞—Ä—Ç–∫–æ—é –Ω–µ–ø—Ä–æ—Å—Ç–æ. –í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º –≤–µ–±-—Å–µ—Ä–≤—ñ—Å–æ–º, –∑–Ω–∞—Ç–∏ URL-–∞–¥—Ä–µ—Å—É —Ü—å–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤—ñ—Å—É, —É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —ñ —Ç–∞–∫ –¥–∞–ª—ñ.
–ñ–æ–¥–Ω–∞ –∑ —Ü–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –Ω–µ –º—ñ—Å—Ç–∏—Ç—å—Å—è –≤ —Ç–µ—Å—Ç—ñ. –ù–∞–≤—ñ—Ç—å –≥—ñ—Ä—à–µ, –≤–∏ –Ω–∞–≤—ñ—Ç—å –Ω–µ –∑–Ω–∞—î—Ç–µ, –¥–µ —Ü—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–∏—Å—É—Ç–Ω—è, –∞ –æ—Ç–∂–µ, —è–∫ —ñ–º—ñ—Ç—É–≤–∞—Ç–∏ –∑–æ–≤–Ω—ñ—à–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞–∫, —â–æ–± –∫–æ–∂–µ–Ω –∑–∞–ø—É—Å–∫ –Ω–µ –ø—Ä–∏–∑–≤–æ–¥–∏–≤ –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–Ω—è 100 –¥–æ–ª–∞—Ä—ñ–≤. –Ü —è–∫ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫-–ø–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å, –∑–≤—ñ–¥–∫–∏ –≤–∏ –º–æ–≥–ª–∏ –∑–Ω–∞—Ç–∏, —â–æ —Ç–µ, —â–æ –≤–∏ –∑–±–∏—Ä–∞—î—Ç–µ—Å—å —Ä–æ–±–∏—Ç–∏, –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ —Ç–æ–≥–æ, —â–æ –≤–∏ —Å—Ç–∞–Ω–µ—Ç–µ –Ω–∞ 100 –¥–æ–ª–∞—Ä—ñ–≤ –±—ñ–¥–Ω—ñ—à–∏–º–∏?

–ù–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ —Ü–µ –≤–∏–≥–ª—è–¥–∞—î –º–æ—Ç–æ—Ä–æ—à–Ω–æ!

–£ –≤–∞—Å –Ω–µ–º–∞—î —ñ–Ω—à–æ–≥–æ –≤–∏–±–æ—Ä—É, –æ–∫—Ä—ñ–º —è–∫ –ø–µ—Ä–µ–ª–æ–ø–∞—Ç–∏—Ç–∏ –∫—É–ø—É –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É, —Ä–æ–∑–ø–∏—Ç—É—é—á–∏ —Å—Ç–∞—Ä—à–∏—Ö —ñ –¥–æ—Å–≤—ñ–¥—á–µ–Ω—ñ—à–∏—Ö –∫–æ–ª–µ–≥, –ø–æ–∫–∏ –≤–∏ –Ω–µ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ, —è–∫ –ø—Ä–∞—Ü—é—é—Ç—å –∑–≤'—è–∑–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç—ñ.
–¶–µ –ø–æ–≤'—è–∑–∞–Ω–æ –∑ —Ç–∏–º, —â–æ, –¥–∏–≤–ª—è—á–∏—Å—å –Ω–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∞—Å—É `CreditCard`, –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏. –ù–∞–≤—ñ—Ç—å –ø–µ—Ä–µ–≥–ª—è–¥ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É –∫–ª–∞—Å—É –Ω–µ –ø—ñ–¥–∫–∞–∂–µ –≤–∞–º, —è–∫–∏–π –º–µ—Ç–æ–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤–∏–∫–ª–∏–∫–∞—Ç–∏. –£ –∫—Ä–∞—â–æ–º—É –≤–∏–ø–∞–¥–∫—É, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É, –¥–æ —è–∫–æ—ó –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –¥–æ—Å—Ç—É–ø, —ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–¥–æ–≥–∞–¥–∞—Ç–∏—Å—è, —è–∫ —ó—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏, –≤–∏—Ö–æ–¥—è—á–∏ –∑ —Ü—å–æ–≥–æ.

–ö–ª–∞—Å–∏ –≤ —Ç–∞–∫–æ–º—É –ø—Ä–æ–µ–∫—Ç—ñ - –ø–∞—Ç–æ–ª–æ–≥—ñ—á–Ω—ñ –±—Ä–µ—Ö—É–Ω–∏. –ü–ª–∞—Ç—ñ–∂–Ω–∞ –∫–∞—Ä—Ç–∫–∞ —Ä–æ–±–∏—Ç—å –≤–∏–≥–ª—è–¥, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —ó—ó –µ–∫–∑–µ–º–ø–ª—è—Ä —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –º–µ—Ç–æ–¥ `charge()`. –û–¥–Ω–∞–∫ –≤–æ–Ω–∞ —Ç–∞—î–º–Ω–æ –≤–∑–∞—î–º–æ–¥—ñ—î –∑ —ñ–Ω—à–∏–º –∫–ª–∞—Å–æ–º, `PaymentGateway`. –ù–∞–≤—ñ—Ç—å –≤ —ó—ó —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ –Ω–∞–ø–∏—Å–∞–Ω–æ, —â–æ –≤–æ–Ω–∞ –º–æ–∂–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏—Å—è —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ, –∞–ª–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≤–æ–Ω–∞ –≤–∏—Ç—è–≥—É—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ —è–∫–æ–≥–æ—Å—å –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É —ñ —Ç–∞–∫ –¥–∞–ª—ñ.
–†–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º, —è–∫—ñ –Ω–∞–ø–∏—Å–∞–ª–∏ —Ü–µ–π –∫–æ–¥, –∑—Ä–æ–∑—É–º—ñ–ª–æ, —â–æ `CreditCard` –ø–æ—Ç—Ä—ñ–±–µ–Ω `PaymentGateway`. –í–æ–Ω–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ –∫–æ–¥ —Å–∞–º–µ —Ç–∞–∫. –ê–ª–µ –¥–ª—è –Ω–æ–≤–∞—á–∫—ñ–≤ —É –ø—Ä–æ–µ–∫—Ç—ñ —Ü–µ –ø–æ–≤–Ω–∞ –∑–∞–≥–∞–¥–∫–∞ —ñ –∑–∞–≤–∞–∂–∞—î –Ω–∞–≤—á–∞–Ω–Ω—é.

–Ø–∫ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—é? –î—É–∂–µ –ø—Ä–æ—Å—Ç–æ. **–î–æ–∑–≤–æ–ª—å—Ç–µ API –æ–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.**

```php
function testCreditCardCharge()
{
	$gateway = new PaymentGateway(/* ... */);
	$cc = new CreditCard('1234567890123456', 5, 2028);
	$cc->charge($gateway, 100);
}
```

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ –≤–∑–∞—î–º–æ–∑–≤'—è–∑–∫–∏ –≤ –∫–æ–¥—ñ —Å—Ç–∞—é—Ç—å —Ä–∞–ø—Ç–æ–≤–æ –æ—á–µ–≤–∏–¥–Ω–∏–º–∏. –û–≥–æ–ª–æ—Å–∏–≤—à–∏, —â–æ –º–µ—Ç–æ–¥ `charge()` –ø–æ—Ç—Ä–µ–±—É—î `PaymentGateway`, –≤–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω—ñ–∫–æ–≥–æ –ø–∏—Ç–∞—Ç–∏, —è–∫ –∫–æ–¥ –≤–∑–∞—î–º–æ–∑–∞–ª–µ–∂–Ω–∏–π. –í–∏ –∑–Ω–∞—î—Ç–µ, —â–æ –º–∞—î—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä, —ñ –∫–æ–ª–∏ –≤–∏ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—å —Ü–µ –∑—Ä–æ–±–∏—Ç–∏, —Ç–æ —Å—Ç–∏–∫–∞—î—Ç–µ—Å—å –∑ —Ç–∏–º, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–æ—Å—Ç—É–ø—É. –ë–µ–∑ –Ω–∏—Ö –∫–æ–¥ –Ω–∞–≤—ñ—Ç—å –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è.

–Ü –Ω–∞–π–≥–æ–ª–æ–≤–Ω—ñ—à–µ, —Ç–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–≥—Ä–∞—Ç–∏—Å—è –∑ –ø–ª–∞—Ç—ñ–∂–Ω–∏–º —à–ª—é–∑–æ–º, —â–æ–± –∑ –≤–∞—Å –Ω–µ –∑–Ω—ñ–º–∞–ª–∏ $100 —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ —Ç–µ—Å—Ç.

–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ –≤–∞—à—ñ –æ–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å —Ç–∞—î–º–Ω–æ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—á–µ–π, —è–∫—ñ –Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω—ñ –≤ —ó—Ö–Ω—ñ—Ö API, —ñ, —è–∫ –Ω–∞—Å–ª—ñ–¥–æ–∫, —Ä–æ–±–∏—Ç—å –≤–∞—à—ñ API –ø–∞—Ç–æ–ª–æ–≥—ñ—á–Ω–∏–º–∏ –±—Ä–µ—Ö—É–Ω–∞–º–∏.

–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –Ω–µ –∑–∞–º–∏—Å–ª—é–≤–∞–ª–∏—Å—è –ø—Ä–æ —Ü–µ —Ä–∞–Ω—ñ—à–µ, –∞–ª–µ –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ —Ç–∞—î–º–Ω—ñ –±–µ–∑–¥—Ä–æ—Ç–æ–≤—ñ –∫–∞–Ω–∞–ª–∏ –∑–≤'—è–∑–∫—É. –ú–æ—Ç–æ—Ä–æ—à–Ω—ñ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ –¥—ñ—ó –∑–º—É—à—É—é—Ç—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ —á–∏—Ç–∞—Ç–∏ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –∫–æ–¥—É, —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó, –∑–Ω–∏–∂—É—é—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ —ñ –∑–∞–ø–ª—É—Ç—É—é—Ç—å –Ω–æ–≤–∏—Ö —á–ª–µ–Ω—ñ–≤ –∫–æ–º–∞–Ω–¥–∏.
–Ø–∫—â–æ –≤–∏ —Ç–æ–π, —Ö—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤ –∫–æ–¥, –≤–∏ –∑–Ω–∞—î—Ç–µ —Ä–µ–∞–ª—å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, –∞–ª–µ –±—É–¥—å-—Ö—Ç–æ, —Ö—Ç–æ –ø—Ä–∏–π–¥–µ –ø—ñ—Å–ª—è –≤–∞—Å, –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞—î.

–ù–µ –ø–∏—à—ñ—Ç—å –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –¢–æ–±—Ç–æ, —ñ–Ω'—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.


–ö—Ä–∏—Ö–∫—ñ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –¥–µ—Ä–∂–∞–≤–∏ .[#toc-brittleness-of-the-global-state]
--------------------------------------------------------------------

–£ –∫–æ–¥—ñ, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —Ç–∞ —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏, –Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–æ–∂–Ω–∞ –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–º, –∫–æ–ª–∏ —ñ –∫–∏–º —Ü–µ–π —Å—Ç–∞–Ω –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ. –¶–µ–π —Ä–∏–∑–∏–∫ –ø—Ä–∏—Å—É—Ç–Ω—ñ–π –≤–∂–µ –Ω–∞ –µ—Ç–∞–ø—ñ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –ù–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –ø–æ–≤–∏–Ω–µ–Ω —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–ª–∞—Ç—ñ–∂–Ω–∏–π —à–ª—é–∑, –∞–ª–µ –≤—ñ–Ω –ø–æ—Å—Ç—ñ–π–Ω–æ –≤–∏–¥–∞—î –≤–∏–∫–ª—é—á–µ–Ω–Ω—è, —ñ –ø–æ—à—É–∫ –ø—Ä–∏—á–∏–Ω–∏ —Ü—å–æ–≥–æ —î –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –Ω—É–¥–Ω–∏–º:

```php
PaymentGateway::init();
DB::init('mysql:', 'user', 'password');
```

–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –¥–µ—Ç–∞–ª—å–Ω–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–æ–¥, —â–æ–± –≤–∏—è–≤–∏—Ç–∏, —â–æ –æ–±'—î–∫—Ç `PaymentGateway` –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –±–µ–∑–¥—Ä–æ—Ç–æ–≤–∏–º —Å–ø–æ—Å–æ–±–æ–º, –¥–µ—è–∫—ñ –∑ —è–∫–∏—Ö –≤–∏–º–∞–≥–∞—é—Ç—å –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ `PaymentGateway`. –û–¥–Ω–∞–∫ –¥–∏–º–æ–≤–∞ –∑–∞–≤—ñ—Å–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –ø—Ä–∏—Ö–æ–≤—É—î —Ü–µ –≤—ñ–¥ –≤–∞—Å. –°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –≤–∏ –± –∑–∞–æ—â–∞–¥–∏–ª–∏, —è–∫–±–∏ API –∫–æ–∂–Ω–æ–≥–æ –∫–ª–∞—Å—É –Ω–µ –±—Ä–µ—Ö–∞–≤ —ñ –æ–≥–æ–ª–æ—à—É–≤–∞–≤ —Å–≤–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ?

```php
$db = new DB('mysql:', 'user', 'password');
$gateway = new PaymentGateway($db, ...);
```

–°—Ö–æ–∂–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∏–Ω–∏–∫–∞—î –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö:

```php
use Illuminate\Support\Facades\DB;

class Article
{
	public function save(): void
	{
		DB::insert(/* ... */);
	}
}
```

–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É –º–µ—Ç–æ–¥—É `save()` –Ω–µ–º–∞—î –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ, —â–æ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö –≤–∂–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ —ñ —Ö—Ç–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –π–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –º–∏ –∑–∞—Ö–æ—á–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –Ω–∞ –ª—å–æ—Ç—É, –º–æ–∂–ª–∏–≤–æ, –∑ –º–µ—Ç–æ—é —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, –Ω–∞–º, –π–º–æ–≤—ñ—Ä–Ω–æ, –¥–æ–≤–µ–¥–µ—Ç—å—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏, —Ç–∞–∫—ñ —è–∫ `DB::reconnect(...)` –∞–±–æ `DB::reconnectForTest()`.

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—Ä–∏–∫–ª–∞–¥:

```php
$article = new Article;
// ...
DB::reconnectForTest();
Foo::doSomething();
$article->save();
```

–î–µ –º–∏ –º–æ–∂–µ–º–æ –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É `$article->save()` –¥—ñ–π—Å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç–µ—Å—Ç–æ–≤–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö? –©–æ, —è–∫—â–æ –º–µ—Ç–æ–¥ `Foo::doSomething()` –∑–º—ñ–Ω–∏–≤ –≥–ª–æ–±–∞–ª—å–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö? –©–æ–± –∑'—è—Å—É–≤–∞—Ç–∏ —Ü–µ, –Ω–∞–º –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –≤–∏–≤—á–∏—Ç–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ –∫–ª–∞—Å—É `Foo` —ñ, –π–º–æ–≤—ñ—Ä–Ω–æ, –±–∞–≥–∞—Ç—å–æ—Ö —ñ–Ω—à–∏—Ö –∫–ª–∞—Å—ñ–≤. –û–¥–Ω–∞–∫ —Ç–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–∞—Å—Ç—å –ª–∏—à–µ –∫–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –æ—Å–∫—ñ–ª—å–∫–∏ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É —Å–∏—Ç—É–∞—Ü—ñ—è –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏—Å—è.

–©–æ, —è–∫—â–æ –º–∏ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É —Å—Ç–∞—Ç–∏—á–Ω—É –∑–º—ñ–Ω–Ω—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—É `Article`?

```php
class Article
{
	private static DB $db;

	public static function setDb(DB $db): void
	{
		self::$db = $db;
	}

	public function save(): void
	{
		self::$db->insert(/* ... */);
	}
}
```

–¶–µ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–∏—Ç—å. –ü—Ä–æ–±–ª–µ–º–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å—Ç–∞–Ω—ñ, —ñ –Ω–µ –º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è, –≤ —è–∫–æ–º—É –∫–ª–∞—Å—ñ –≤—ñ–Ω —Ö–æ–≤–∞—î—Ç—å—Å—è. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫ —ñ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É, –º–∏ –Ω–µ –º–∞—î–º–æ –∂–æ–¥–Ω–æ–≥–æ —É—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, –¥–æ —è–∫–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞–ø–∏—Å, –∫–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥ `$article->save()`. –ë—É–¥—å-—Ö—Ç–æ –Ω–∞ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–º—É –∫—ñ–Ω—Ü—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –º–æ–∂–µ –≤ –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç –∑–º—ñ–Ω–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—É `Article::setDb()`. –ü—ñ–¥ –Ω–∞—à–∏–º–∏ —Ä—É–∫–∞–º–∏.

–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —Ä–æ–±–∏—Ç—å –Ω–∞—à –¥–æ–¥–∞—Ç–æ–∫ **–Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –≤—Ä–∞–∑–ª–∏–≤–∏–º**.

–û–¥–Ω–∞–∫ —î –ø—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É. –ü—Ä–æ—Å—Ç–æ –∑–º—É—Å—å—Ç–µ API –¥–µ–∫–ª–∞—Ä—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –Ω–∞–ª–µ–∂–Ω—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å.

```php
class Article
{
	public function __construct(
		private DB $db,
	) {
	}

	public function save(): void
	{
		$this->db->insert(/* ... */);
	}
}

$article = new Article($db);
// ...
Foo::doSomething();
$article->save();
```

–¢–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –ø–æ–∑–±–∞–≤–ª—è—î –≤–∞—Å –≤—ñ–¥ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Ç—É—Ä–±—É–≤–∞—Ç–∏—Å—è –ø—Ä–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–∞ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –∑–º—ñ–Ω–∏ —É –∑'—î–¥–Ω–∞–Ω–Ω—è—Ö –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö. –¢–µ–ø–µ—Ä –º–∏ —Ç–æ—á–Ω–æ –∑–Ω–∞—î–º–æ, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Å—Ç–∞—Ç—Ç—è, —ñ –∂–æ–¥–Ω—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ–¥—É –≤ —ñ–Ω—à–æ–º—É, –Ω–µ –ø–æ–≤'—è–∑–∞–Ω–æ–º—É –∑ –Ω–µ—é –∫–ª–∞—Å—ñ, –±—ñ–ª—å—à–µ –Ω–µ –∑–º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—é. –ö–æ–¥ –±—ñ–ª—å—à–µ –Ω–µ –∫—Ä–∏—Ö–∫–∏–π, –∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π.

–ù–µ –ø–∏—à—ñ—Ç—å –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, —ñ–Ω'—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.


–°–∏–Ω–≥–ª—Ç–æ–Ω .[#toc-singleton]
--------------------------

–°–∏–Ω–≥–ª—Ç–æ–Ω - —Ü–µ –ø–∞—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è, —è–∫–∏–π, –∑–∞ [–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º |https://en.wikipedia.org/wiki/Singleton_pattern] –∑ –≤—ñ–¥–æ–º–æ—ó –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó Gang of Four, –æ–±–º–µ–∂—É—î –∫–ª–∞—Å —î–¥–∏–Ω–∏–º –µ–∫–∑–µ–º–ø–ª—è—Ä–æ–º —ñ –ø—Ä–æ–ø–æ–Ω—É—î –≥–ª–æ–±–∞–ª—å–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –Ω—å–æ–≥–æ. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ü—å–æ–≥–æ –ø–∞—Ç–µ—Ä–Ω—É –∑–∞–∑–≤–∏—á–∞–π –Ω–∞–≥–∞–¥—É—î –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:

```php
class Singleton
{
	private static self $instance;

	public static function getInstance(): self
	{
		self::$instance ??= new self;
		return self::$instance;
	}

	// —Ç–∞ —ñ–Ω—à—ñ –º–µ—Ç–æ–¥–∏, —â–æ –≤–∏–∫–æ–Ω—É—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó –∫–ª–∞—Å—É
}
```

–ù–∞ –∂–∞–ª—å, —Å–∏–Ω–≥–ª—Ç–æ–Ω –≤–≤–æ–¥–∏—Ç—å –≤ –¥–æ–¥–∞—Ç–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω. –ê —è–∫ –º–∏ –ø–æ–∫–∞–∑–∞–ª–∏ –≤–∏—â–µ, –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –Ω–µ–±–∞–∂–∞–Ω–∏–π. –°–∞–º–µ —Ç–æ–º—É —Å–∏–Ω–≥–ª—Ç–æ–Ω –≤–≤–∞–∂–∞—î—Ç—å—Å—è –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º.

–ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏ —É —Å–≤–æ—î–º—É –∫–æ–¥—ñ —ñ –∑–∞–º—ñ–Ω—ñ—Ç—å —ó—Ö —ñ–Ω—à–∏–º–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∞–º–∏. –°–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ. –û–¥–Ω–∞–∫, —è–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —î–¥–∏–Ω–æ–≥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä—É –∫–ª–∞—Å—É –¥–ª—è –≤—Å—å–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É, –∑–∞–ª–∏—à—Ç–µ —Ü–µ [–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É DI |container].
–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —Å—Ç–≤–æ—Ä—ñ—Ç—å —Å–∏–Ω–≥–ª—Ç–æ–Ω –¥–æ–¥–∞—Ç–∫—É, –∞–±–æ —Å–µ—Ä–≤—ñ—Å. –¢–æ–¥—ñ –∫–ª–∞—Å –Ω–µ –±—É–¥–µ –Ω–∞–¥–∞–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–æ—ó —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ (—Ç–æ–±—Ç–æ –Ω–µ –º–∞—Ç–∏–º–µ –º–µ—Ç–æ–¥—É `getInstance()` —Ç–∞ —Å—Ç–∞—Ç–∏—á–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó) —ñ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏–º–µ –ª–∏—à–µ —Å–≤–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ –ø–æ—Ä—É—à—É–≤–∞—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø —î–¥–∏–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ.


–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –ø—Ä–æ—Ç–∏ —Ç–µ—Å—Ç—ñ–≤ .[#toc-global-state-versus-tests]
--------------------------------------------------------------

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ñ —Ç–µ—Å—Ç—ñ–≤ –º–∏ –ø—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ –∫–æ–∂–µ–Ω —Ç–µ—Å—Ç —î —ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ—é –æ–¥–∏–Ω–∏—Ü–µ—é, —ñ –∂–æ–¥–µ–Ω –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Å—Ç–∞–Ω –Ω–µ –≤—Ö–æ–¥–∏—Ç—å –¥–æ –Ω—å–æ–≥–æ. –Ü –∂–æ–¥–µ–Ω —Å—Ç–∞–Ω –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å –∑ —Ç–µ—Å—Ç—É. –ö–æ–ª–∏ —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è, –±—É–¥—å-—è–∫–∏–π —Å—Ç–∞–Ω, –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ —Ç–µ—Å—Ç–æ–º, –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–±–∏—Ä–∞—á–µ–º —Å–º—ñ—Ç—Ç—è. –¶–µ —Ä–æ–±–∏—Ç—å —Ç–µ—Å—Ç–∏ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–º–∏. –¢–æ–º—É –º–∏ –º–æ–∂–µ–º–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ç–µ—Å—Ç–∏ —É –±—É–¥—å-—è–∫–æ–º—É –ø–æ—Ä—è–¥–∫—É.

–û–¥–Ω–∞–∫, —è–∫—â–æ –ø—Ä–∏—Å—É—Ç–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω—ñ —Å—Ç–∞–Ω–∏/—Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏, –≤—Å—ñ —Ü—ñ –≥–∞—Ä–Ω—ñ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è —Ä—É–π–Ω—É—é—Ç—å—Å—è. –°—Ç–∞–Ω –º–æ–∂–µ –≤—Ö–æ–¥–∏—Ç–∏ —ñ –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑ —Ç–µ—Å—Ç—É. –ù–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–æ, –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–µ—Å—Ç—ñ–≤ –º–æ–∂–µ –º–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è.

–©–æ–± –≤–∑–∞–≥–∞–ª—ñ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏, —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º —á–∞—Å—Ç–æ –¥–æ–≤–æ–¥–∏—Ç—å—Å—è –ø–æ—Å–ª–∞–±–ª—é–≤–∞—Ç–∏ —ó—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –º–æ–∂–ª–∏–≤–æ, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –∑–∞–º—ñ–Ω—é–≤–∞—Ç–∏ –æ–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä —ñ–Ω—à–∏–º. –¢–∞–∫—ñ —Ä—ñ—à–µ–Ω–Ω—è, –≤ –∫—Ä–∞—â–æ–º—É –≤–∏–ø–∞–¥–∫—É, —î —Ö–∞–∫–∞–º–∏, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å –∫–æ–¥, —è–∫–∏–π –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —ñ —Ä–æ–∑—É–º—ñ—Ç–∏. –ë—É–¥—å-—è–∫–∏–π —Ç–µ—Å—Ç –∞–±–æ –º–µ—Ç–æ–¥ `tearDown()`, —è–∫–∏–π –≤–ø–ª–∏–≤–∞—î –Ω–∞ –±—É–¥—å-—è–∫–∏–π –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, –ø–æ–≤–∏–Ω–µ–Ω —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ü—ñ –∑–º—ñ–Ω–∏.

–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω - —Ü–µ –Ω–∞–π–±—ñ–ª—å—à–∏–π –≥–æ–ª–æ–≤–Ω–∏–π –±—ñ–ª—å —É –º–æ–¥—É–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ!

–Ø–∫ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—é? –î—É–∂–µ –ø—Ä–æ—Å—Ç–æ. –ù–µ –ø–∏—à—ñ—Ç—å –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω–∏, –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –¢–æ–±—Ç–æ, —ñ–Ω'—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.


–ì–ª–æ–±–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ .[#toc-global-constants]
--------------------------------------------

–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –Ω–µ –æ–±–º–µ–∂—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Å–∏–Ω–≥–ª–µ—Ç–æ–Ω—ñ–≤ —ñ —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, –∞–ª–µ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏—Å—è –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç.

–ó –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏, –∑–Ω–∞—á–µ–Ω–Ω—è —è–∫–∏—Ö –Ω–µ –Ω–∞–¥–∞—î –Ω–∞–º –Ω—ñ—è–∫–æ—ó –Ω–æ–≤–æ—ó (`M_PI`) –∞–±–æ –∫–æ—Ä–∏—Å–Ω–æ—ó (`PREG_BACKTRACK_LIMIT_ERROR`) —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, —è–≤–Ω–æ –≤—Å–µ –≥–∞—Ä–∞–∑–¥.
–Ü –Ω–∞–≤–ø–∞–∫–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏, —è–∫—ñ —Å–ª—É–≥—É—é—Ç—å —Å–ø–æ—Å–æ–±–æ–º "–±–µ–∑–¥—Ä–æ—Ç–æ–≤–æ—ó" –ø–µ—Ä–µ–¥–∞—á—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–¥—É, —î –Ω—ñ—á–∏–º —ñ–Ω—à–∏–º, —è–∫ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—é –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—é. –Ø–∫ `LOG_FILE` —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ.
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ `FILE_APPEND` —î –∞–±—Å–æ–ª—é—Ç–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º.

```php
const LOG_FILE = '...';

class Foo
{
	public function doSomething()
	{
		// ...
		file_put_contents(LOG_FILE, $message . "\n", FILE_APPEND);
		// ...
	}
}
```

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –æ–≥–æ–ª–æ—Å–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä —É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ –∫–ª–∞—Å—É `Foo`, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ —á–∞—Å—Ç–∏–Ω–æ—é API:

```php
class Foo
{
	public function __construct(
		private string $logFile,
	) {
	}

	public function doSomething()
	{
		// ...
		file_put_contents($this->logFile, $message . "\n", FILE_APPEND);
		// ...
	}
}
```

–¢–µ–ø–µ—Ä –º–∏ –º–æ–∂–µ–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –ª–æ–≥—É–≤–∞–Ω–Ω—è —ñ –ª–µ–≥–∫–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –π–æ–≥–æ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏, —â–æ –ø–æ–ª–µ–≥—à—É—î —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —ñ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –∫–æ–¥—É.


–ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ —Å—Ç–∞—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ .[#toc-global-functions-and-static-methods]
--------------------------------------------------------------------------------

–ú–∏ —Ö–æ—á–µ–º–æ –ø—ñ–¥–∫—Ä–µ—Å–ª–∏—Ç–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —ñ –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —Å–∞–º–µ –ø–æ —Å–æ–±—ñ –Ω–µ —î –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–∏–º. –ú–∏ –≤–∂–µ –ø–æ—è—Å–Ω—é–≤–∞–ª–∏ –Ω–µ–¥–æ—Ä–µ—á–Ω—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `DB::insert()` —Ç–∞ –ø–æ–¥—ñ–±–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤, –∞–ª–µ –∑–∞–≤–∂–¥–∏ –π—à–ª–æ—Å—è –ø—Ä–æ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω, —â–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É —Å—Ç–∞—Ç–∏—á–Ω—ñ–π –∑–º—ñ–Ω–Ω—ñ–π. –ú–µ—Ç–æ–¥ `DB::insert()` –≤–∏–º–∞–≥–∞—î –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Å—Ç–∞—Ç–∏—á–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –∑–±–µ—Ä—ñ–≥–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö. –ë–µ–∑ —Ü—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–µ—Ç–æ–¥—É –±—É–ª–∞ –± –Ω–µ–º–æ–∂–ª–∏–≤–æ—é.

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏—Ö —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —ñ —Ñ—É–Ω–∫—Ü—ñ–π, —Ç–∞–∫–∏—Ö —è–∫ `DateTime::createFromFormat()`, `Closure::fromCallable`, `strlen()` —ñ –±–∞–≥–∞—Ç—å–æ—Ö —ñ–Ω—à–∏—Ö, —Ü—ñ–ª–∫–æ–º —É–∑–≥–æ–¥–∂—É—î—Ç—å—Å—è –∑ —ñ–Ω'—î–∫—Ü—ñ—î—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π. –¶—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—ñ–¥ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —ñ —Ç–æ–º—É —î –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏. –í–æ–Ω–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∂–æ–¥–Ω–æ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É.

–û–¥–Ω–∞–∫, –≤ PHP —î —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –Ω–µ —î –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–º–∏. –î–æ –Ω–∏—Ö –≤—ñ–¥–Ω–æ—Å–∏—Ç—å—Å—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ñ—É–Ω–∫—Ü—ñ—è `htmlspecialchars()`. –á—ó —Ç—Ä–µ—Ç—ñ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, `$encoding`, —è–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–∏–π–º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó `ini_get('default_charset')`. –¢–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑–∞–≤–∂–¥–∏ –≤–∫–∞–∑—É–≤–∞—Ç–∏ —Ü–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –º–æ–∂–ª–∏–≤–æ—ó –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Ñ—É–Ω–∫—Ü—ñ—ó. Nette –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ —Ü–µ —Ä–æ–±–∏—Ç—å.

–î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ `strtolower()`, `strtoupper()`, —Ç–æ—â–æ, —É –Ω–µ–¥–∞–ª–µ–∫–æ–º—É –º–∏–Ω—É–ª–æ–º—É –º–∞–ª–∏ –Ω–µ–¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É —ñ –∑–∞–ª–µ–∂–∞–ª–∏ –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `setlocale()`. –¶–µ –≤–∏–∫–ª–∏–∫–∞–ª–æ –±–∞–≥–∞—Ç–æ —É—Å–∫–ª–∞–¥–Ω–µ–Ω—å, –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ —Ç—É—Ä–µ—Ü—å–∫–æ—é –º–æ–≤–æ—é.
–¶–µ –ø–æ–≤'—è–∑–∞–Ω–æ –∑ —Ç–∏–º, —â–æ —Ç—É—Ä–µ—Ü—å–∫–∞ –º–æ–≤–∞ —Ä–æ–∑—Ä—ñ–∑–Ω—è—î –≤–µ—Ä—Ö–Ω—ñ–π —ñ –Ω–∏–∂–Ω—ñ–π —Ä–µ–≥—ñ—Å—Ç—Ä `I` –∑ –∫—Ä–∞–ø–∫–æ—é —ñ –±–µ–∑ –Ω–µ—ó. –¢–æ–º—É `strtolower('I')` –ø–æ–≤–µ—Ä—Ç–∞–≤ —Å–∏–º–≤–æ–ª `ƒ±`, –∞ `strtoupper('i')` –ø–æ–≤–µ—Ä—Ç–∞–≤ —Å–∏–º–≤–æ–ª `ƒ∞`, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ —Ç–æ–≥–æ, —â–æ –¥–æ–¥–∞—Ç–∫–∏ –≤–∏–∫–ª–∏–∫–∞–ª–∏ —Ä—è–¥ –∑–∞–≥–∞–¥–∫–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫.
–û–¥–Ω–∞–∫ —Ü—è –ø—Ä–æ–±–ª–µ–º–∞ –±—É–ª–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ —É –≤–µ—Ä—Å—ñ—ó PHP 8.2, —ñ —Ñ—É–Ω–∫—Ü—ñ—ó –±—ñ–ª—å—à–µ –Ω–µ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –ª–æ–∫–∞–ª—ñ.

–¶–µ –≥–∞—Ä–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Ç–æ–≥–æ, —è–∫ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –¥–æ—à–∫—É–ª—è–≤ —Ç–∏—Å—è—á–∞–º —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ –≤—Å—å–æ–º—É —Å–≤—ñ—Ç—É. –†—ñ—à–µ–Ω–Ω—è–º –±—É–ª–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ —ñ–Ω'—î–∫—Ü—ñ—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.


–ö–æ–ª–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É –¥–µ—Ä–∂–∞–≤—É? .[#toc-when-is-it-possible-to-use-global-state]
---------------------------------------------------------------------------------------------

–Ü—Å–Ω—É—é—Ç—å –ø–µ–≤–Ω—ñ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥ —á–∞—Å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó –∞–±–æ –≤–∏–º—ñ—Ä—è—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–µ–≤–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–∏. –£ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ –π–¥–µ—Ç—å—Å—è –ø—Ä–æ —Ç–∏–º—á–∞—Å–æ–≤—ñ –¥—ñ—ó, —è–∫—ñ –∑–≥–æ–¥–æ–º –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ –∑ –∫–æ–¥—É, –ø—Ä–∞–≤–æ–º—ñ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–∞–º–ø–µ—Ä –∞–±–æ —Å–µ–∫—É–Ω–¥–æ–º—ñ—Ä. –¶—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –Ω–µ —î —á–∞—Å—Ç–∏–Ω–æ—é –¥–∏–∑–∞–π–Ω—É –∫–æ–¥—É.

–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ - —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–º–∏ –≤–∏—Ä–∞–∑–∞–º–∏ `preg_*`, —è–∫—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ —Ä–µ–≥—É–ª—è—Ä–Ω—ñ –≤–∏—Ä–∞–∑–∏ –≤ —Å—Ç–∞—Ç–∏—á–Ω–æ–º—É –∫–µ—à—ñ –≤ –ø–∞–º'—è—Ç—ñ. –ö–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ –æ–¥–∏–Ω —ñ —Ç–æ–π —Å–∞–º–∏–π —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ —É —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å—Ç–∏–Ω–∞—Ö –∫–æ–¥—É, –≤—ñ–Ω –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –ª–∏—à–µ –æ–¥–∏–Ω —Ä–∞–∑. –ö–µ—à –µ–∫–æ–Ω–æ–º–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –∞ —Ç–∞–∫–æ–∂ —î –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–µ–≤–∏–¥–∏–º–∏–º –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ç–æ–º—É —Ç–∞–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –≤–≤–∞–∂–∞—Ç–∏ –ª–µ–≥—ñ—Ç–∏–º–Ω–∏–º.


–ü—ñ–¥—Å—É–º–æ–∫ .[#toc-summary]
------------------------

–ú–∏ –ø–æ–∫–∞–∑–∞–ª–∏, —á–æ–º—É —Ü–µ –º–∞—î —Å–µ–Ω—Å

1) –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Å—Ç–∞—Ç–∏—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –∑ –∫–æ–¥—É
2) –û–≥–æ–ª–æ—Å–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
3) –Ü –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω'—î–∫—Ü—ñ—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

–ö–æ–ª–∏ –≤–∏ –æ–±–º—ñ—Ä–∫–æ–≤—É—î—Ç–µ –¥–∏–∑–∞–π–Ω –∫–æ–¥—É, –ø–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –∫–æ–∂–Ω–µ `static $foo` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –ø—Ä–æ–±–ª–µ–º—É. –î–ª—è —Ç–æ–≥–æ, —â–æ–± –≤–∞—à –∫–æ–¥ –±—É–≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º, —â–æ –ø–æ–≤–∞–∂–∞—î DI, –≤–∞–∂–ª–∏–≤–æ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–∫–æ—Ä—ñ–Ω–∏—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —ñ –∑–∞–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ —ñ–Ω'—î–∫—Ü—ñ—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.

–ü—ñ–¥ —á–∞—Å —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏—è–≤–∏—Ç–∏, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –∫–ª–∞—Å, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –º–∞—î –±—ñ–ª—å—à–µ –æ–¥–Ω—ñ—î—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ. –ù–µ —Ç—É—Ä–±—É–π—Ç–µ—Å—è –ø—Ä–æ —Ü–µ; –ø—Ä–∞–≥–Ω—ñ—Ç—å –¥–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —î–¥–∏–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ.

*–Ø —Ö–æ—Ç—ñ–≤ –±–∏ –ø–æ–¥—è–∫—É–≤–∞—Ç–∏ –ú—ñ—à–∫–æ –•–µ–≤–µ—Ä—ñ, —á–∏—ó —Å—Ç–∞—Ç—Ç—ñ, —Ç–∞–∫—ñ —è–∫ [Flaw: Brittle Global State —Ç–∞ Singletons |http://misko.hevery.com/code-reviewers-guide/flaw-brittle-global-state-singletons/], –ª—è–≥–ª–∏ –≤ –æ—Å–Ω–æ–≤—É —Ü—ñ—î—ó –≥–ª–∞–≤–∏. –Ø —Ö–æ—Ç—ñ–≤ –±–∏ –ø–æ–¥—è–∫—É–≤–∞—Ç–∏ –ú—ñ—à–∫–æ –•–µ–≤–µ—Ä—ñ.*
