Cum funcÈ›ioneazÄƒ aplicaÈ›iile?
*****************************

<div class=perex>

Ãn prezent citiÈ›i documentul de bazÄƒ al documentaÈ›iei Nette. VeÈ›i Ã®nvÄƒÈ›a toate principiile aplicaÈ›iilor web. Nisa de la A la Z, de la momentul naÈ™terii pÃ¢nÄƒ la ultima suflare a scriptului PHP. DupÄƒ ce veÈ›i citi veÈ›i È™ti:

- cum funcÈ›ioneazÄƒ totul
- ce este Bootstrap, Presenter È™i containerul DI
- cum aratÄƒ structura directoarelor

</div>


Structura directoarelor .[#toc-directory-structure]
===================================================

DeschideÈ›i un exemplu de schelet al unei aplicaÈ›ii web numit [WebProject |https://github.com/nette/web-project] È™i puteÈ›i urmÄƒri fiÈ™ierele despre care se scrie.

Structura directoarelor aratÄƒ cam aÈ™a:

/--pre
<b>web-project/</b>
â”œâ”€â”€ <b>app/</b>                      â† directory with application
â”‚   â”œâ”€â”€ <b>Presenters/</b>           â† presenter classes
â”‚   â”‚   â”œâ”€â”€ <b>HomePresenter.php</b> â† Home presenter class
â”‚   â”‚   â””â”€â”€ <b>templates/</b>        â† templates directory
â”‚   â”‚       â”œâ”€â”€ <b>@layout.latte</b> â† template of shared layout
â”‚   â”‚       â””â”€â”€ <b>Home/</b>         â† templates for Home presenter
â”‚   â”‚           â””â”€â”€ <b>default.latte</b>  â† template for action `default`
â”‚   â”œâ”€â”€ <b>Router/</b>               â† configuration of URL addresses
â”‚   â””â”€â”€ <b>Bootstrap.php</b>         â† booting class Bootstrap
â”œâ”€â”€ <b>bin/</b>                      â† scripts for the command line
â”œâ”€â”€ <b>config/</b>                   â† configuration files
â”‚   â”œâ”€â”€ <b>common.neon</b>
â”‚   â””â”€â”€ <b>local.neon</b>
â”œâ”€â”€ <b>log/</b>                      â† error logs
â”œâ”€â”€ <b>temp/</b>                     â† temporary files, cache, â€¦
â”œâ”€â”€ <b>vendor/</b>                   â† libraries installed by Composer
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ <b>autoload.php</b>          â† autoloading of libs installed by Composer
â”œâ”€â”€ <b>www/</b>                      â† public directory, document root of project
â”‚   â”œâ”€â”€ <b>.htaccess</b>             â† mod_rewrite rules etc
â”‚   â””â”€â”€ <b>index.php</b>             â† initial file that launches the application
â””â”€â”€ <b>.htaccess</b>                 â† prohibits access to all directories except www
\--

PuteÈ›i modifica structura directoarelor Ã®n orice mod, puteÈ›i redenumi sau muta folderele È™i apoi puteÈ›i edita doar cÄƒile de acces la `log/` È™i `temp/` Ã®n fiÈ™ierul `Bootstrap.php` È™i calea de acces la acest fiÈ™ier Ã®n `composer.json` Ã®n secÈ›iunea `autoload`. Nimic mai mult, fÄƒrÄƒ reconfigurÄƒri complicate, fÄƒrÄƒ schimbÄƒri constante. Nette are o [autodetecÈ›ie inteligentÄƒ |bootstrap#development-vs-production-mode].

Pentru aplicaÈ›ii ceva mai mari, putem Ã®mpÄƒrÈ›i dosarele cu prezentatori È™i È™abloane Ã®n subdirectoare (pe disc) È™i Ã®n spaÈ›ii de nume (Ã®n cod), pe care le numim [module |modules].

Directorul `www/` este directorul public sau documentul-rÄƒdÄƒcinÄƒ al proiectului. Ãl puteÈ›i redenumi fÄƒrÄƒ a fi nevoie sÄƒ setaÈ›i nimic altceva pe partea de aplicaÈ›ie. Trebuie doar sÄƒ [configuraÈ›i gÄƒzduirea |nette:troubleshooting#How to change or remove www directory from URL] astfel Ã®ncÃ¢t documentul-root sÄƒ ajungÄƒ Ã®n acest director.

De asemenea, puteÈ›i descÄƒrca direct proiectul WebProject, inclusiv Nette, folosind [Composer |best-practices:composer]:

```shell
composer create-project nette/web-project
```

Pe Linux sau macOS, setaÈ›i [permisiunile de scriere |nette:troubleshooting#Setting directory permissions] pentru directoarele `log/` È™i `temp/`.

AplicaÈ›ia WebProject este gata sÄƒ ruleze, nu mai este nevoie sÄƒ configuraÈ›i absolut nimic altceva È™i o puteÈ›i vizualiza direct Ã®n browser accesÃ¢nd folderul `www/`.


Cerere HTTP .[#toc-http-request]
================================

Totul Ã®ncepe atunci cÃ¢nd un utilizator deschide o paginÄƒ Ã®ntr-un browser È™i browserul bate la server cu o cerere HTTP. Cererea merge la un fiÈ™ier PHP aflat Ã®n directorul public `www/`, care este `index.php`. SÄƒ presupunem cÄƒ este vorba de o cerere cÄƒtre `https://example.com/product/123` È™i va fi executat.

Sarcina sa este:

1) sÄƒ iniÈ›ializeze mediul
2) sÄƒ obÈ›inÄƒ fabrica
3) lansarea aplicaÈ›iei Nette care gestioneazÄƒ cererea

Ce fel de fabricÄƒ? Noi nu producem tractoare, ci site-uri web! StaÈ›i puÈ›in, vÄƒ explicÄƒm imediat.

Prin "iniÈ›ializarea mediului" Ã®nÈ›elegem, de exemplu, cÄƒ este activat [Tracy |tracy:], care este un instrument uimitor pentru Ã®nregistrarea sau vizualizarea erorilor. Acesta Ã®nregistreazÄƒ erorile de pe serverul de producÈ›ie È™i le afiÈ™eazÄƒ direct pe serverul de dezvoltare. Prin urmare, iniÈ›ializarea trebuie, de asemenea, sÄƒ decidÄƒ dacÄƒ site-ul ruleazÄƒ Ã®n modul de producÈ›ie sau de dezvoltare. Pentru a face acest lucru, Nette foloseÈ™te autodetecÈ›ia: dacÄƒ executaÈ›i site-ul pe localhost, acesta ruleazÄƒ Ã®n modul dezvoltator. Nu trebuie sÄƒ configuraÈ›i nimic, iar aplicaÈ›ia este pregÄƒtitÄƒ atÃ¢t pentru dezvoltare, cÃ¢t È™i pentru implementarea Ã®n producÈ›ie. AceÈ™ti paÈ™i sunt realizaÈ›i È™i descriÈ™i Ã®n detaliu Ã®n capitolul despre [clasa Bootstrap |bootstrap].

Al treilea punct (da, l-am sÄƒrit pe al doilea, dar vom reveni la el) este sÄƒ pornim aplicaÈ›ia. Gestionarea cererilor HTTP Ã®n Nette este realizatÄƒ de clasa `Nette\Application\Application` (denumitÄƒ Ã®n continuare `Application`), astfel Ã®ncÃ¢t atunci cÃ¢nd spunem "a rula o aplicaÈ›ie", ne referim la apelarea unei metode cu numele `run()` pe un obiect din aceastÄƒ clasÄƒ.

Nette este un mentor care vÄƒ ghideazÄƒ sÄƒ scrieÈ›i aplicaÈ›ii curate prin metodologii dovedite. Iar cea mai doveditÄƒ se numeÈ™te **InjecÈ›ie de dependenÈ›Äƒ**, prescurtat DI. DeocamdatÄƒ nu vrem sÄƒ vÄƒ Ã®mpovÄƒrÄƒm cu explicaÈ›ii despre DI, deoarece existÄƒ un [capitol separat |dependency-injection:introduction], important aici este cÄƒ obiectele cheie vor fi create de obicei de o fabricÄƒ de obiecte numitÄƒ **DI container** (abreviat DIC). Da, aceasta este fabrica care a fost menÈ›ionatÄƒ cu ceva timp Ã®n urmÄƒ. È˜i tot ea creeazÄƒ pentru noi obiectul `Application`, deci avem nevoie mai Ã®ntÃ¢i de un container. Ãl obÈ›inem cu ajutorul clasei `Configurator` È™i Ã®l lÄƒsÄƒm sÄƒ producÄƒ obiectul `Application`, apelÄƒm metoda `run()` È™i astfel pornim aplicaÈ›ia Nette. Este exact ceea ce se Ã®ntÃ¢mplÄƒ Ã®n fiÈ™ierul [index.php |bootstrap#index.php].


AplicaÈ›ia Nette .[#toc-nette-application]
=========================================

Clasa Application are o singurÄƒ sarcinÄƒ: sÄƒ rÄƒspundÄƒ la o cerere HTTP.

AplicaÈ›iile scrise Ã®n Nette sunt Ã®mpÄƒrÈ›ite Ã®n mai multe aÈ™a-numite prezentÄƒri (Ã®n alte framework-uri este posibil sÄƒ Ã®ntÃ¢lniÈ›i termenul de controler, care este acelaÈ™i), care sunt clase care reprezintÄƒ o anumitÄƒ paginÄƒ de site web: de exemplu, pagina de start; produs Ã®n magazinul electronic; formular de Ã®nregistrare; feed sitemap etc. AplicaÈ›ia poate avea de la unul pÃ¢nÄƒ la mii de prezentatori.

AplicaÈ›ia Ã®ncepe prin a cere aÈ™a-numitului router sÄƒ decidÄƒ care dintre prezentatori sÄƒ transmitÄƒ cererea curentÄƒ pentru procesare. Routerul decide a cui este responsabilitatea. Acesta se uitÄƒ la URL-ul de intrare `https://example.com/product/123`, care doreÈ™te sÄƒ `show` un produs cu `id: 123` ca acÈ›iune. Este un bun obicei sÄƒ se scrie perechile prezentator + acÈ›iune separate de douÄƒ puncte ca `Product:show`.

Astfel, routerul a transformat URL-ul Ã®ntr-o pereche `Presenter:action` + parametri, Ã®n cazul nostru `Product:show` + `id: 123`. PuteÈ›i vedea cum aratÄƒ un router Ã®n fiÈ™ierul `app/Router/RouterFactory.php` È™i Ã®l vom descrie Ã®n detaliu Ã®n capitolul [Routing |Routing].

SÄƒ mergem mai departe. AplicaÈ›ia cunoaÈ™te deja numele prezentatorului È™i poate continua. Prin crearea unui obiect `ProductPresenter`, care este codul prezentatorului `Product`. Mai exact, solicitÄƒ containerului DI crearea prezentatorului, deoarece producerea de obiecte este sarcina acestuia.

Prezentatorul ar putea arÄƒta astfel:

```php
class ProductPresenter extends Nette\Application\UI\Presenter
{
	public function __construct(
		private ProductRepository $repository,
	) {
	}

	public function renderShow(int $id): void
	{
		// obÈ›inem datele din model È™i le transmitem È™ablonului
		$this->template->product = $this->repository->getProduct($id);
	}
}
```

Cererea este gestionatÄƒ de prezentator. Iar sarcina este clarÄƒ: efectuaÈ›i acÈ›iunea `show` cu `id: 123`. Ceea ce Ã®n limbajul prezentatorilor Ã®nseamnÄƒ cÄƒ metoda `renderShow()` este apelatÄƒ È™i Ã®n parametrul `$id` se obÈ›ine `123`.

Un prezentator poate gestiona mai multe acÈ›iuni, adicÄƒ are mai multe metode `render<Action>()`. Dar noi recomandÄƒm proiectarea de prezentatoare cu una sau cÃ¢t mai puÈ›ine acÈ›iuni posibile.

AÈ™adar, a fost apelatÄƒ metoda `renderShow(123)`, al cÄƒrei cod este un exemplu fictiv, dar se poate vedea pe ea cum sunt transmise datele cÄƒtre È™ablon, adicÄƒ prin scrierea la `$this->template`.

Ulterior, prezentatorul returneazÄƒ rÄƒspunsul. Acesta poate fi o paginÄƒ HTML, o imagine, un document XML, trimiterea unui fiÈ™ier de pe disc, JSON sau redirecÈ›ionarea cÄƒtre o altÄƒ paginÄƒ. Este important de reÈ›inut cÄƒ, dacÄƒ nu spunem Ã®n mod explicit cum sÄƒ rÄƒspundem (ceea ce este cazul `ProductPresenter`), rÄƒspunsul va fi redarea È™ablonului cu o paginÄƒ HTML. De ce? Ei bine, pentru cÄƒ Ã®n 99% din cazuri dorim sÄƒ desenÄƒm un È™ablon, aÈ™a cÄƒ prezentatorul ia acest comportament ca fiind implicit È™i doreÈ™te sÄƒ ne uÈ™ureze munca. Acesta este punctul de vedere al lui Nette.

Nici mÄƒcar nu trebuie sÄƒ precizÄƒm ce È™ablon sÄƒ desenÄƒm, el derivÄƒ calea cÄƒtre acesta conform unei logici simple. Ãn cazul prezentatorului `Product` È™i al acÈ›iunii `show`, el Ã®ncearcÄƒ sÄƒ vadÄƒ dacÄƒ unul dintre aceste fiÈ™iere È™ablon existÄƒ Ã®n raport cu directorul Ã®n care se aflÄƒ clasa `ProductPresenter`:

- `templates/Product/show.latte`
- `templates/Product.show.latte`

De asemenea, va Ã®ncerca sÄƒ gÄƒseascÄƒ aspectul Ã®n fiÈ™ierul `@layout.latte` È™i apoi va reda È™ablonul. Acum sarcina prezentatorului È™i a Ã®ntregii aplicaÈ›ii este finalizatÄƒ. Ãn cazul Ã®n care È™ablonul nu existÄƒ, va fi returnatÄƒ o paginÄƒ cu eroarea 404. PuteÈ›i citi mai multe despre prezentatori pe pagina [Prezentatori |Presenters].

[* request-flow.svg *]

Doar pentru a fi siguri, sÄƒ Ã®ncercÄƒm sÄƒ recapitulÄƒm Ã®ntregul proces cu un URL uÈ™or diferit:

1) URL-ul va fi `https://example.com`
2) vom porni aplicaÈ›ia, vom crea un container È™i vom rula `Application::run()`
3) routerul decodificÄƒ URL-ul ca o pereche `Home:default`
4) este creat un obiect `HomePresenter`
5) se apeleazÄƒ metoda `renderDefault()` (dacÄƒ existÄƒ)
6) este redat un È™ablon `templates/Home/default.latte` cu un layout `templates/@layout.latte`


Este posibil sÄƒ fi Ã®ntÃ¢lnit acum o mulÈ›ime de concepte noi, dar noi credem cÄƒ acestea au sens. Crearea de aplicaÈ›ii Ã®n Nette este o joacÄƒ de copii.


È˜abloane .[#toc-templates]
==========================

Ãn ceea ce priveÈ™te È™abloanele, Nette foloseÈ™te sistemul de È™abloane [Latte |latte:]. De aceea, fiÈ™ierele cu È™abloane se terminÄƒ cu `.latte`. Latte este utilizat deoarece este cel mai sigur sistem de È™abloane pentru PHP È™i, Ã®n acelaÈ™i timp, cel mai intuitiv sistem. Nu trebuie sÄƒ Ã®nvÄƒÈ›aÈ›i multe lucruri noi, trebuie doar sÄƒ cunoaÈ™teÈ›i PHP È™i cÃ¢teva etichete Latte. VeÈ›i afla totul [Ã®n documentaÈ›ie |latte:].

Ãn È™ablon [creÄƒm un link |creating-links] cÄƒtre alÈ›i prezentatori & acÈ›iuni dupÄƒ cum urmeazÄƒ:

```latte
<a n:href="Product:show $productId">product detail</a>
```

Pur È™i simplu scrieÈ›i binomul cunoscut `Presenter:action` Ã®n locul URL-ului real È™i includeÈ›i orice parametru. Trucul este `n:href`, care spune cÄƒ acest atribut va fi procesat de Nette. È˜i acesta va genera:

```latte
<a href="/product/456">product detail</a>
```

Routerul menÈ›ionat anterior se ocupÄƒ de generarea URL-ului. De fapt, routerele din Nette sunt unice prin faptul cÄƒ pot efectua nu numai transformÄƒri de la un URL la o pereche prezentator:acÈ›iune, ci È™i invers, genereazÄƒ un URL din numele prezentatorului + acÈ›iune + parametri.
DatoritÄƒ acestui fapt, Ã®n Nette puteÈ›i schimba complet forma URL-ului Ã®n Ã®ntreaga aplicaÈ›ie finalizatÄƒ fÄƒrÄƒ a schimba nici mÄƒcar un singur caracter din È™ablon sau prezentator, doar prin modificarea routerului.
È˜i datoritÄƒ acestui lucru, funcÈ›ioneazÄƒ aÈ™a-numita canonizare, care este o altÄƒ caracteristicÄƒ unicÄƒ a Nette, care Ã®mbunÄƒtÄƒÈ›eÈ™te SEO (optimizarea capacitÄƒÈ›ii de cÄƒutare pe internet) prin prevenirea automatÄƒ a existenÈ›ei conÈ›inutului duplicat la diferite URL-uri.
MulÈ›i programatori considerÄƒ acest lucru uimitor.


Componente interactive .[#toc-interactive-components]
=====================================================

Mai avem un lucru de spus despre prezentatori: aceÈ™tia au un sistem de componente Ã®ncorporat. Cei mai Ã®n vÃ¢rstÄƒ dintre dumneavoastrÄƒ Ã®È™i amintesc poate ceva similar din Delphi sau ASP.NET Web Forms. React sau Vue.js este construit pe ceva foarte asemÄƒnÄƒtor. Ãn lumea cadrelor PHP, aceasta este o caracteristicÄƒ complet unicÄƒ.

Componentele sunt unitÄƒÈ›i separate reutilizabile pe care le plasÄƒm Ã®n pagini (adicÄƒ Ã®n prezentatori). Ele pot fi [formulare |forms:in-presenter], [datagrids |https://componette.org/contributte/datagrid/], meniuri, sondaje, de fapt, orice are sens sÄƒ fie folosit Ã®n mod repetat. Putem sÄƒ ne creÄƒm propriile componente sau sÄƒ folosim o parte din [gama imensÄƒ |https://componette.org] de componente opensource.

Componentele schimbÄƒ Ã®n mod fundamental abordarea dezvoltÄƒrii aplicaÈ›iilor. Ele vor deschide noi posibilitÄƒÈ›i de a compune pagini din unitÄƒÈ›i predefinite. È˜i au ceva Ã®n comun cu [Hollywood-ul |components#Hollywood style].


Containerul È™i configuraÈ›ia DI .[#toc-di-container-and-configuration]
=====================================================================

Containerul DI (fabrica de obiecte) este inima Ã®ntregii aplicaÈ›ii.

Nu vÄƒ faceÈ›i griji, nu este o cutie neagrÄƒ magicÄƒ, aÈ™a cum ar putea pÄƒrea din cuvintele anterioare. De fapt, este o clasÄƒ PHP destul de plictisitoare generatÄƒ de Nette È™i stocatÄƒ Ã®ntr-un director de cache. Are o mulÈ›ime de metode numite `createServiceAbcd()` È™i fiecare dintre ele creeazÄƒ È™i returneazÄƒ un obiect. Da, existÄƒ, de asemenea, o metodÄƒ `createServiceApplication()` care va produce `Nette\Application\Application`, de care aveam nevoie Ã®n fiÈ™ierul `index.php` pentru a rula aplicaÈ›ia. È˜i existÄƒ metode pentru a produce prezentatori individuali. È˜i aÈ™a mai departe.

Obiectele pe care le creeazÄƒ containerul DI se numesc servicii dintr-un anumit motiv.

Ceea ce este cu adevÄƒrat special la aceastÄƒ clasÄƒ este faptul cÄƒ nu este programatÄƒ de dumneavoastrÄƒ, ci de cÄƒtre cadru. Acesta genereazÄƒ de fapt codul PHP È™i Ã®l salveazÄƒ pe disc. DumneavoastrÄƒ doar daÈ›i instrucÈ›iuni cu privire la obiectele pe care containerul ar trebui sÄƒ fie capabil sÄƒ le producÄƒ È™i cum anume. Iar aceste instrucÈ›iuni sunt scrise Ã®n [fiÈ™iere de configurare |bootstrap#DI Container Configuration] Ã®n [format NEON |neon:format] È™i, prin urmare, au extensia `.neon`.

FiÈ™ierele de configurare sunt utilizate exclusiv pentru a da instrucÈ›iuni containerului DI. Astfel, de exemplu, dacÄƒ precizez opÈ›iunea `expiration: 14 days` Ã®n secÈ›iunea [sesiune |http:configuration#Session], containerul DI, atunci cÃ¢nd creeazÄƒ obiectul `Nette\Http\Session` care reprezintÄƒ sesiunea, va apela metoda sa `setExpiration('14 days')`, È™i astfel configuraÈ›ia devine realitate.

ExistÄƒ un Ã®ntreg capitol pregÄƒtit pentru dumneavoastrÄƒ, Ã®n care se descrie ce poate fi [configurat |nette:configuring] È™i cum sÄƒ [vÄƒ definiÈ›i propriile servicii |dependency-injection:services].

OdatÄƒ ce intraÈ›i Ã®n crearea serviciilor, veÈ›i da peste cuvÃ¢ntul [autowiring |dependency-injection:autowiring]. Acesta este un gadget care vÄƒ va face viaÈ›a incredibil de uÈ™oarÄƒ. Acesta poate trece automat obiectele acolo unde aveÈ›i nevoie de ele (Ã®n constructorii claselor dvs., de exemplu), fÄƒrÄƒ sÄƒ trebuiascÄƒ sÄƒ faceÈ›i nimic. VeÈ›i descoperi cÄƒ containerul DI din Nette este un mic miracol.


Ce urmeazÄƒ? .[#toc-what-next]
=============================

Am trecut Ã®n revistÄƒ principiile de bazÄƒ ale aplicaÈ›iilor Ã®n Nette. PÃ¢nÄƒ acum, foarte superficial, dar Ã®n curÃ¢nd veÈ›i pÄƒtrunde Ã®n profunzime È™i, Ã®n cele din urmÄƒ, veÈ›i crea aplicaÈ›ii web minunate. Unde sÄƒ continuÄƒm? AÈ›i Ã®ncercat tutorialul [CreeazÄƒ-È›i prima aplicaÈ›ie |quickstart:]?

Pe lÃ¢ngÄƒ cele de mai sus, Nette are un Ã®ntreg arsenal de [clase utile |utils:], un [strat de baze de date |database:], etc. ÃncercaÈ›i Ã®n mod intenÈ›ionat doar sÄƒ faceÈ›i clic prin documentaÈ›ie. Sau vizitaÈ›i [blogul |https://blog.nette.org]. VeÈ›i descoperi o mulÈ›ime de lucruri interesante.

LÄƒsaÈ›i cadrul sÄƒ vÄƒ aducÄƒ multÄƒ bucurie ğŸ’™.
