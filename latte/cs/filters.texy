Latte filtry
************

.[perex]
V šablonách můžeme používat funkce, které pomáhají upravit nebo přeformátovat data do výsledné podoby. Říkáme jim *filtry*.

.[table-latte-filters]
|## Transformace
| `batch`      | [výpis lineárních dat do tabulky |#batch]
| `breakLines` | [Před konce řádku přidá HTML odřádkování |#breakLines]
| `bytes`      | [formátuje velikost v bajtech |#bytes]
| `clamp`      | [ohraničí hodnotu do daného rozsahu |#clamp]
| `dataStream` | [konverze pro Data URI protokol |#datastream]
| `date`       | [formátuje datum |#date]
| `implode`    | [spojí pole do řetězce |#implode]
| `indent`     | [odsadí text zleva o daný počet tabulátorů |#indent]
| `length`     | [vrací délku řetězce ve znacích nebo pole |#length]
| `number`     | [formátuje číslo |#number]
| `padLeft`    | [doplní řetězec zleva na požadovanou délku |#padLeft]
| `padRight`   | [doplní řetězec zprava na požadovanou délku |#padRight]
| `repeat`     | [opakování řetězce |#repeat]
| `replace`    | [zamění výskyty hledaného řetězce |#replace]
| `replaceRE`  | [zamění výskyty dle regulárního výrazu |#replaceRE]
| `reverse`    | [obrátí UTF‑8 řetězec nebo pole |#reverse]
| `sort`       | [seřadí pole |#sort]
| `strip`      | [odstraní bílé místo |#strip], podobně jako značka [spaceless |tags]
| `stripHtml`  | [odstraní HTML značky a HTML entity převede na znaky |#stripHtml]
| `substr`     | [vrátí část řetězce |#substr]
| `trim`       | [odstraní počáteční a koncové mezery či jiné znaky |#trim]
| `truncate`   | [zkrátí délku se zachováním slov |#truncate]
| `webalize`   | [upraví UTF‑8 řetězec do tvaru používaného v URL |#webalize]

.[table-latte-filters]
|## Velikost písmen
| `capitalize` | [malá písmena, první písmeno ve slovech velké |#capitalize]
| `firstUpper` | [převede první písmeno na velké |#firstUpper]
| `lower`      | [převede na malá písmena |#lower]
| `upper`      | [převede na velká písmena |#upper]

.[table-latte-filters]
|## Escapování
| `escapeUrl`  | [escapuje parametr v URL |#escapeUrl]
| `noescape`   | [vypíše proměnnou bez escapování |tags#Vypisování]
| `query`      | [generuje query string v URL |#query]

Dále existují escapovací filtry pro HTML (`escapeHtml` a `escapeHtmlComment`), XML (`escapeXml`), JavaScript (`escapeJs`), CSS (`escapeCss`) a iCalendar (`escapeICal`),
které Latte používá samo díky [kontextově sensitivnímu escapování|safety-first#Kontextově sensitivní escapování] a nemusíte je zapisovat.

.[table-latte-filters]
|## Bezpečnost
| `checkUrl`   | [ošetří URL adresu od nebezpečných vstupů |#checkUrl]
| `noCheck`    | [předejde automatickému ošetření URL adresy |#noCheck]

Latte atributy `src` a `href` [kontroluje automaticky |safety-first#Kontrola odkazů], takže filtr `checkUrl` téměř nemusíte používat.


.[note]
Všechny výchozí filtry jsou určeny pro řetězce v kódování UTF‑8.


Použití
=======

Filtry se zapisují za svislítko (může být před ním mezera):

```html
<h1>{$heading|upper}</h1>
```

Filtry (ve starších verzích helpery) lze zřetězit a poté se aplikují v pořadí od levého k pravému:

```html
<h1>{$heading|lower|capitalize}</h1>
```

Parametry se zadávají za jménem filtru oddělené dvojtečkami nebo čárkami:

```html
<h1>{$heading|truncate:20,''}</h1>
```

Filtry lze aplikovat i na výraz:

```html
{var $name = ($title|upper) . ($subtitle|lower)}</h1>
```

Jako filtr lze do šablony zaregistrovat libovolný callback:

```php
$latte = new Latte\Engine;
$latte->addFilter('shortify', function (string $s, int $len = 10): string {
	return mb_substr($s, 0, $len);
});
```

V šabloně se potom volá takto:

```html
<p>{$text|shortify}</p>
<p>{$text|shortify:100}</p>
```


Filtry
======


batch(int length, mixed item): array .[filter]{data-version:2.7}
----------------------------------------------------------------
Filtr, který zjednodušuje výpis lineárních dat do podoby tabulky. Vrací pole polí se zadaným počtem položek. Pokud zadáte druhý parametr, použije se k doplnění chybějících položek na posledním řádku.

```html
{var $items = ['a', 'b', 'c', 'd', 'e']}
<table>
{foreach ($items|batch: 3, 'No item') as $row}
	<tr>
		{foreach $row as $column}
			<td>{$column}</td>
		{/foreach}
	</tr>
{/foreach}
</table>
```

Vypíše:

```html
<table>
	<tr>
		<td>a</td>
		<td>b</td>
		<td>c</td>
	</tr>
	<tr>
		<td>d</td>
		<td>e</td>
		<td>No item</td>
	</tr>
</table>
```


breakLines
----------
Přidává před každý znak nového řádku HTML značku `<br>`

```latte
{var $s = "Text & with \n newline"}
{$s|breakLines}    {* vypíše "Text &amp; with <br>\n newline" *}
```


bytes(int precision = 2) .[filter]
----------------------------------
Formátuje velikost v bajtech do lidsky čitelné podoby.

```html
{$size|bytes}     0 B, 10 B, …
{$size|bytes:2}   1.25 GB, …
```


clamp(int|float min, int|float max) .[filter]{data-version:2.9}
---------------------------------------------------------------
Ohraničí hodnotu do daného inkluzivního rozsahu min a max.

```html
{$level|clamp: 0, 255}
```

Existuje také jako funkce:

```html
{=clamp($level, 0, 255)}
```


dataStream(string mimetype = detect) .[filter]
----------------------------------------------
Konvertuje obsah do data URI scheme. Pomocí něj lze do HTML nebo CSS vkládat obrázky bez nutnosti linkovat externí soubory.

Mějme v proměnné obrázek `$img = Image::fromFile('obrazek.gif')`, poté

```html
<img src="{$img|dataStream}">
```

Vypíše například:

```html
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==">
```

.[caution]
Vyžaduje PHP rozšíření `fileinfo`.


date(string format) .[filter]
-----------------------------
Formátuje datum podle masky buď ve tvaru používaném PHP funkcí [php:strftime] nebo [php:date]. Filtr přijímá datum buď ve formátu UNIX timestamp, v podobě řetězce nebo jako objekt `DateTime`.

```html
{$today|date:'%d.%m.%Y'}
{$today|date:'j. n. Y'}
```


implode(string glue = '') .[filter]
-----------------------------------
Vrátí řetězec, který je zřetězením položek sekvence. Oddělovač mezi prvky je ve výchozím nastavení prázdný řetězec, ale můžete jej definovat pomocí volitelného prvního parametru.

```latte
{=[1, 2, 3]|implode}      {* vypíše '123' *}
{=[1, 2, 3]|implode:'|'}  {* vypíše '1|2|3' *}
```


indent(int level = 1, string char = "\t") .[filter]
---------------------------------------------------
Odsadí text zleva o daný počet tabulátorů nebo jiných znaků, které můžeme uvést ve druhém argumentu. Prázdné řádky nejsou odsazeny.

```html
<div>
{block |indent}
<p>Hello</p>
{/block}
</div>
```

Vypíše:

```html
<div>
	<p>Hello</p>
</div>
```


length
------
Vrátí délku řetězce nebo pole.

- pro řetězce vrátí délku v UTF‑8 znacích
- pro pole vrátí počet položek
- pro objekty, které implementují rozhraní Countable, použije návratovou hodnotu metody count()
- pro objekty, které implementují rozhraní IteratorAggregate, použije návratovou hodnotu funkce iterator_count()


```latte
{if ($users|length) > 10}
	...
{/if}
```


number(int decimals = 0, string decPoint = '.', string thousandsSep = ',') .[filter]
------------------------------------------------------------------------------------
Formátuje číslo na určitý počet desetinných míst. Lze určit znak pro desetinnou čárku a oddělovač tisíců.

```html
{1234.20 |number}              1,234
{1234.20 |number:1}            1,234.2
{1234.20 |number:2}            1,234.20
{1234.20 |number:2, ',', ' '}  1 234,20
```


padLeft(int length, string pad = ' ') .[filter]
-----------------------------------------------
Doplní řetězec do určité délky jiným řetězcem zleva.

```latte
{='hello'|padLeft: 10, '123'}  {* vypíše '12312hello' *}
```


padRight(int length, string pad = ' ') .[filter]
------------------------------------------------
Doplní řetězec do určité délky jiným řetězcem zprava.

```latte
{='hello'|padRight: 10, '123'}  {* vypíše 'hello12312' *}
```


repeat(int count) .[filter]
---------------------------
Opakuje řetězec x-krát.

```latte
{='hello'|repeat: 3}  {* vypíše 'hellohellohello' *}
```


replace(string search, string replace = '') .[filter]
-----------------------------------------------------
Nahradí všechny výskyty vyhledávacího řetězce náhradním řetězcem.

```latte
{='hello world'|replace: 'world', 'friend'}  {* vypíše 'hello friend' *}
```


replaceRE(string pattern, string replace = '') .[filter]
--------------------------------------------------------
Provede vyhledávání regulárních výrazů s nahrazením.

```latte
{='hello world'|replaceRE: 'l.*', 'l'}  {* vypíše 'hel' *}
```


reverse
-------
Obrátí daný řetězec nebo pole.

```latte
{var $s = 'Nette'}
{$s|reverse}    {* vypíše 'etteN' *}
{var $a = ['N', 'e', 't', 't', 'e']}
{$a|reverse}    {* returns ['e', 't', 't', 'e', 'N'] *}
```


sort .{data-version:2.9}
------------------------
Filtr, který třídí pole.

```html
{foreach ($names|sort) as $name}
	...
{/foreach}
```

Řazené pole v opačném pořadí:

```html
{foreach ($names|sort|reverse) as $name}
	...
{/foreach}
```


strip
-----
Odstraní zbytečné bílé místo (mezery) z výstupu.

```html
{block |strip}
	<ul>
		<li>Hello</li>
	</ul>
{/block}
```

Vypíše:

```html
<ul> <li>Hello</li> </ul>
```


stripHtml
---------
Odstraní značky HTML a převede entity HTML na text.

```latte
{='<p>one &lt; two</p>'|stripHtml}  {* vypíše 'one < two' *}
```


substr(int offset, int length = null) .[filter]
-----------------------------------------------
Extrahuje část řetězce. Funguje jako funkce PHP `mb_substr` s fallbackem k `iconv_substr` v režimu UTF‑8.

```latte
{$string|substr: 1, 2}
```


trim
----
Odstraní prázdné znaky (nebo jiné znaky) od začátku a konce řetězce.

```latte
{='  I like Latte.  '|trim}    {* vypíše 'I like Latte.' *}
{='  I like Latte.'|trim: '.'} {* vypíše '  I like Latte' *}
```


truncate(int length, string append = '…') .[filter]
---------------------------------------------------
Ořízne řetězec na uvedenou maximální délku, přičemž se snaží zachovávat celá slova. Pokud dojde ke zkrácení řetězce, přidá nakonec trojtečku (lze změnit druhým parametrem).

```latte
{var $title = 'Hello, how are you?'}
{$title|truncate:5}  {* Hell…                *}
{$title|truncate:17} {* Hello, how are…      *}
{$title|truncate:30} {* Hello, how are you?  *}
```


webalize
--------
Upraví UTF‑8 řetězec do tvaru používaného v URL.

Převádí se na ASCII. Převede mezery na pomlčky. Odstraní znaky, které nejsou alfanumerické, podtržítka ani pomlčky. Převede na malá písmena. Také odstraní přední a koncové mezery.

```latte
{var $s = 'Náš 10. produkt'}
{$s|webalize}   {* vypíše 'nas-10-produkt' *}
```

.[caution]
Vyžaduje knihovnu [nette/utils|doc:utils].


Velikost písmen
===============

.[caution]
Vyžaduje PHP rozšíření `mbstring`.


capitalize
----------
Slova budou začínat velkými písmeny, všechny zbývající znaky budou malá.

```latte
{='i like LATTE'|capitalize}  {* vypíše 'I Like Latte' *}

```


firstUpper
----------
Převede první písmeno na velká.

```latte
{='the latte'|upper}  {* vypíše 'The latte' *}
```


lower
-----
Převede řetězec na malá písmena.


```latte
{='LATTE'|lower}   {* vypíše 'latte' *}
```


upper
-----
Převede řetězec na velká písmena.

```latte
{='latte'|upper}  {* vypíše 'LATTE' *}
```


Escapování
==========


escapeUrl
---------
Escapuje proměnnou pro použití jakožto parametru v URL.

```html
<a href="http://example.com/{$name|escapeUrl}">{$name}</a>
```


noescape
--------
Zakáže automatické escapování.


query .{data-version:2.10}
--------------------------
Dynamicky generuje query string v URL:

```html
<a href="http://example.com/?{[name: 'John Doe', age: 43]|query}">click</a>
```

Vygeneruje:

```html
<a href="http://example.com/?name=John+Doe&amp;age=43">click</a>
```

Klíče s hodnotou `null` se vynechají.


Bezpečnost
==========


checkUrl
--------
Vynutí ošetření URL adresy. Kontroluje, zda proměnná obsahuje webovou URL (tj. protokol HTTP/HTTPS) a předchází vypsání odkazů, které mohou představovat bezpečnostní riziko.

```html
{var $link = 'javascript:window.close()'}
<a data-href="{$link|checkUrl}">kontrolované</a>
<a data-href="{$link}">nekontrolované</a>
```

Vygeneruje:

```html
<a data-href="">kontrolované</a>
<a data-href="javascript:window.close()">nekontrolované</a>
```


noCheck
-------
Předejde automatickému ošetření URL adresy. Latte [automaticky kontroluje|safety-first#Kontrola odkazů], zda proměnná obsahuje webovou URL (tj. protokol HTTP/HTTPS) a předchází vypsání odkazů, které mohou představovat bezpečnostní riziko.

Pokud odkaz používá jiné schéma, např. `javascript:` nebo `data:`, a jste si jistí jeho obsahem, můžete kontrolu vypnout pomoci `|noCheck`.

```html
{var $link = 'javascript:window.close()'}

<a href="{$link}">kontrolované</a>
<a href="{$link|noCheck}">nekontrolované</a>
```

Vygeneruje:

```html
<a href="">kontrolované</a>
<a href="javascript:window.close()">nekontrolované</a>
```


{{composer: latte/latte}}
