Cum funcÈ›ioneazÄƒ aplicaÈ›iile?
*****************************

<div class=perex>

Tocmai citiÈ›i documentul de bazÄƒ al documentaÈ›iei Nette. VeÈ›i afla Ã®ntregul principiu de funcÈ›ionare al aplicaÈ›iilor web. De la A la Z, de la momentul naÈ™terii pÃ¢nÄƒ la ultima suflare a scriptului PHP. DupÄƒ citire, veÈ›i È™ti:

- cum funcÈ›ioneazÄƒ totul
- ce sunt Bootstrap, Presenter È™i containerul DI
- cum aratÄƒ structura directoarelor

</div>


Structura directoarelor
=======================

DeschideÈ›i exemplul de schelet al unei aplicaÈ›ii web numit [WebProject|https://github.com/nette/web-project] È™i, Ã®n timp ce citiÈ›i, puteÈ›i privi fiÈ™ierele despre care este vorba.

Structura directoarelor aratÄƒ cam aÈ™a:

/--pre
<b>web-project/</b>
â”œâ”€â”€ <b>app/</b>                      â† director cu aplicaÈ›ia
â”‚   â”œâ”€â”€ <b>Core/</b>                 â† clase de bazÄƒ necesare pentru funcÈ›ionare
â”‚   â”‚   â””â”€â”€ <b>RouterFactory.php</b> â† configurarea adreselor URL
â”‚   â”œâ”€â”€ <b>Presentation/</b>         â† presentere, È™abloane & co.
â”‚   â”‚   â”œâ”€â”€ <b>@layout.latte</b>     â† È™ablon de layout
â”‚   â”‚   â””â”€â”€ <b>Home/</b>             â† directorul presenterului Home
â”‚   â”‚       â”œâ”€â”€ <b>HomePresenter.php</b> â† clasa presenterului Home
â”‚   â”‚       â””â”€â”€ <b>default.latte</b> â† È™ablonul acÈ›iunii default
â”‚   â””â”€â”€ <b>Bootstrap.php</b>         â† clasa de iniÈ›ializare Bootstrap
â”œâ”€â”€ <b>bin/</b>                      â† scripturi rulate din linia de comandÄƒ
â”œâ”€â”€ <b>config/</b>                   â† fiÈ™iere de configurare
â”‚   â”œâ”€â”€ <b>common.neon</b>
â”‚   â””â”€â”€ <b>services.neon</b>
â”œâ”€â”€ <b>log/</b>                      â† erori Ã®nregistrate
â”œâ”€â”€ <b>temp/</b>                     â† fiÈ™iere temporare, cache, â€¦
â”œâ”€â”€ <b>vendor/</b>                   â† biblioteci instalate de Composer
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ <b>autoload.php</b>          â† autoloading pentru toate pachetele instalate
â”œâ”€â”€ <b>www/</b>                      â† director public sau document-root al proiectului
â”‚   â”œâ”€â”€ <b>.htaccess</b>             â† reguli mod_rewrite
â”‚   â””â”€â”€ <b>index.php</b>             â† fiÈ™ierul iniÈ›ial prin care se lanseazÄƒ aplicaÈ›ia
â””â”€â”€ <b>.htaccess</b>                 â† interzice accesul la toate directoarele, cu excepÈ›ia www
\--

Structura directoarelor poate fi modificatÄƒ oricum, folderele pot fi redenumite sau mutate, este complet flexibilÄƒ. Nette dispune, Ã®n plus, de autodetecÈ›ie inteligentÄƒ È™i recunoaÈ™te automat locaÈ›ia aplicaÈ›iei, inclusiv baza sa URL.

Pentru aplicaÈ›ii puÈ›in mai mari, putem [Ã®mpÄƒrÈ›i folderele cu presentere È™i È™abloane Ã®n subdirectoare |directory-structure#Presentere È™i È™abloane] È™i clasele Ã®n spaÈ›ii de nume, pe care le numim module.

Directorul `www/` reprezintÄƒ aÈ™a-numitul director public sau document-root al proiectului. Ãl puteÈ›i redenumi fÄƒrÄƒ a fi nevoie sÄƒ setaÈ›i altceva Ã®n partea de aplicaÈ›ie. Este necesar doar sÄƒ [configuraÈ›i hostingul |nette:troubleshooting#Cum sÄƒ schimbaÈ›i sau sÄƒ eliminaÈ›i directorul www din URL] astfel Ã®ncÃ¢t document-root sÄƒ indice cÄƒtre acest director.

WebProject poate fi, de asemenea, descÄƒrcat direct, inclusiv Nette, folosind [Composer |best-practices:composer]:

```shell
composer create-project nette/web-project
```

Pe Linux sau macOS, setaÈ›i [permisiunile de scriere |nette:troubleshooting#Setarea permisiunilor pentru directoare] pentru directoarele `log/` È™i `temp/`.

AplicaÈ›ia WebProject este gata de rulare, nu este nevoie sÄƒ configuraÈ›i absolut nimic È™i o puteÈ›i afiÈ™a direct Ã®n browser accesÃ¢nd folderul `www/`.


Cerere HTTP
===========

Totul Ã®ncepe Ã®n momentul Ã®n care utilizatorul deschide pagina Ã®n browser. AdicÄƒ atunci cÃ¢nd browserul bate la uÈ™a serverului cu o cerere HTTP. Cererea vizeazÄƒ un singur fiÈ™ier PHP, care se aflÄƒ Ã®n directorul public `www/`, È™i acesta este `index.php`. SÄƒ presupunem cÄƒ este vorba despre o cerere pentru adresa `https://example.com/product/123`. DatoritÄƒ [setÄƒrilor adecvate ale serverului |nette:troubleshooting#Cum sÄƒ configuraÈ›i serverul pentru URL-uri prietenoase], chiar È™i acest URL este mapat pe fiÈ™ierul `index.php` È™i acesta se executÄƒ.

Sarcina sa este:

1) iniÈ›ializarea mediului
2) obÈ›inerea fabricii
3) pornirea aplicaÈ›iei Nette, care va gestiona cererea

Ce fel de fabricÄƒ? Nu producem tractoare, ci pagini web! AveÈ›i rÄƒbdare, se va explica imediat.

Prin â€iniÈ›ializarea mediuluiâ€ ne referim, de exemplu, la faptul cÄƒ se activeazÄƒ [Tracy|tracy:], care este un instrument uimitor pentru Ã®nregistrarea sau vizualizarea erorilor. Pe serverul de producÈ›ie, Ã®nregistreazÄƒ erorile, pe cel de dezvoltare le afiÈ™eazÄƒ direct. Prin urmare, iniÈ›ializarea include È™i decizia dacÄƒ site-ul ruleazÄƒ Ã®n modul de producÈ›ie sau de dezvoltare. Pentru aceasta, Nette utilizeazÄƒ [autodetecÈ›ia inteligentÄƒ |bootstrap#Modul de dezvoltare vs producÈ›ie]: dacÄƒ rulaÈ›i site-ul pe localhost, ruleazÄƒ Ã®n modul de dezvoltare. Nu trebuie sÄƒ configuraÈ›i nimic È™i aplicaÈ›ia este direct pregÄƒtitÄƒ atÃ¢t pentru dezvoltare, cÃ¢t È™i pentru implementarea live. AceÈ™ti paÈ™i se efectueazÄƒ È™i sunt descriÈ™i detaliat Ã®n capitolul despre [clasa Bootstrap|bootstrap].

Al treilea punct (da, am sÄƒrit peste al doilea, dar vom reveni la el) este pornirea aplicaÈ›iei. Gestionarea cererilor HTTP este responsabilitatea clasei `Nette\Application\Application` (Ã®n continuare `Application`), aÈ™a cÄƒ atunci cÃ¢nd spunem pornirea aplicaÈ›iei, ne referim Ã®n mod specific la apelarea metodei cu numele sugestiv `run()` pe obiectul acestei clase.

Nette este un mentor care vÄƒ ghideazÄƒ sÄƒ scrieÈ›i aplicaÈ›ii curate conform metodologiilor dovedite. È˜i una dintre cele absolut cele mai dovedite se numeÈ™te **dependency injection**, prescurtat DI. Ãn acest moment, nu vrem sÄƒ vÄƒ Ã®ncÄƒrcÄƒm cu explicaÈ›ii despre DI, pentru asta existÄƒ [un capitol separat|dependency-injection:introduction], esenÈ›ial este rezultatul cÄƒ obiectele cheie ne vor fi de obicei create de o fabricÄƒ de obiecte, care se numeÈ™te **container DI** (prescurtat DIC). Da, aceasta este fabrica despre care am vorbit mai devreme. È˜i ne va produce È™i obiectul `Application`, de aceea avem nevoie mai Ã®ntÃ¢i de container. Ãl obÈ›inem folosind clasa `Configurator` È™i Ã®l lÄƒsÄƒm sÄƒ producÄƒ obiectul `Application`, apelÄƒm pe el metoda `run()` È™i astfel porneÈ™te aplicaÈ›ia Nette. Exact acest lucru se Ã®ntÃ¢mplÄƒ Ã®n fiÈ™ierul [index.php |bootstrap#index.php].


Nette Application
=================

Clasa Application are o singurÄƒ sarcinÄƒ: sÄƒ rÄƒspundÄƒ la cererea HTTP.

AplicaÈ›iile scrise Ã®n Nette sunt Ã®mpÄƒrÈ›ite Ã®n multe aÈ™a-numite presentere (Ã®n alte framework-uri puteÈ›i Ã®ntÃ¢lni termenul controller, este acelaÈ™i lucru), care sunt clase, fiecare reprezentÃ¢nd o anumitÄƒ paginÄƒ specificÄƒ a site-ului: de ex. homepage; produs Ã®ntr-un magazin online; formular de conectare; feed sitemap etc. AplicaÈ›ia poate avea de la unul la mii de presentere.

Application Ã®ncepe prin a solicita aÈ™a-numitului router sÄƒ decidÄƒ cÄƒruia dintre presentere sÄƒ Ã®i transmitÄƒ cererea curentÄƒ pentru gestionare. Routerul decide a cui este responsabilitatea. Se uitÄƒ la URL-ul de intrare `https://example.com/product/123` È™i, pe baza modului Ã®n care este setat, decide cÄƒ aceasta este treaba, de ex., a **presenterului** `Product`, de la care va dori ca **acÈ›iune** afiÈ™area (`show`) produsului cu `id: 123`. Perechea presenter + acÈ›iune este o bunÄƒ practicÄƒ sÄƒ fie scrisÄƒ separatÄƒ prin douÄƒ puncte ca `Product:show`.

Deci, routerul a transformat URL-ul Ã®n perechea `Presenter:action` + parametri, Ã®n cazul nostru `Product:show` + `id: 123`. Cum aratÄƒ un astfel de router puteÈ›i vedea Ã®n fiÈ™ierul `app/Core/RouterFactory.php` È™i Ã®l descriem detaliat Ã®n capitolul [Rutare |Routing].

SÄƒ mergem mai departe. Application cunoaÈ™te deja numele presenterului È™i poate continua. Prin crearea obiectului clasei `ProductPresenter`, care este codul presenterului `Product`. Mai precis, solicitÄƒ containerului DI sÄƒ creeze presenterul, deoarece crearea este treaba lui.

Presenterul poate arÄƒta, de exemplu, aÈ™a:

```php
class ProductPresenter extends Nette\Application\UI\Presenter
{
	public function __construct(
		private ProductRepository $repository,
	) {
	}

	public function renderShow(int $id): void
	{
		// obÈ›inem datele din model È™i le transmitem È™ablonului
		$this->template->product = $this->repository->getProduct($id);
	}
}
```

Gestionarea cererii este preluatÄƒ de presenter. È˜i sarcina este clarÄƒ: executÄƒ acÈ›iunea `show` cu `id: 123`. Ceea ce, Ã®n limbajul presenterelor, Ã®nseamnÄƒ cÄƒ se apeleazÄƒ metoda `renderShow()` È™i Ã®n parametrul `$id` primeÈ™te `123`.

Presenterul poate gestiona mai multe acÈ›iuni, adicÄƒ poate avea mai multe metode `render<Action>()`. Dar recomandÄƒm proiectarea presenterelor cu una sau cÃ¢t mai puÈ›ine acÈ›iuni.

Deci, s-a apelat metoda `renderShow(123)`, al cÄƒrei cod este un exemplu fictiv, dar puteÈ›i vedea pe el cum se transmit datele cÄƒtre È™ablon, adicÄƒ prin scrierea Ã®n `$this->template`.

Ulterior, presenterul returneazÄƒ un rÄƒspuns. Acesta poate fi o paginÄƒ HTML, o imagine, un document XML, trimiterea unui fiÈ™ier de pe disc, JSON sau chiar o redirecÈ›ionare cÄƒtre o altÄƒ paginÄƒ. Important este cÄƒ, dacÄƒ nu spunem explicit cum sÄƒ rÄƒspundÄƒ (ceea ce este cazul `ProductPresenter`), rÄƒspunsul va fi redarea È™ablonului cu pagina HTML. De ce? Deoarece Ã®n 99% din cazuri dorim sÄƒ redÄƒm un È™ablon, prin urmare presenterul considerÄƒ acest comportament ca fiind implicit È™i vrea sÄƒ ne uÈ™ureze munca. Acesta este scopul Nette.

Nu trebuie nici mÄƒcar sÄƒ specificÄƒm ce È™ablon sÄƒ redÄƒm, calea cÄƒtre acesta o deduce singur. Ãn cazul acÈ›iunii `show`, Ã®ncearcÄƒ pur È™i simplu sÄƒ Ã®ncarce È™ablonul `show.latte` din directorul cu clasa `ProductPresenter`. De asemenea, Ã®ncearcÄƒ sÄƒ gÄƒseascÄƒ layout-ul Ã®n fiÈ™ierul `@layout.latte` (mai detaliat despre [gÄƒsirea È™abloanelor |templates#CÄƒutarea È™abloanelor]).

È˜i ulterior redÄƒ È™abloanele. Astfel, sarcina presenterului È™i a Ã®ntregii aplicaÈ›ii este finalizatÄƒ È™i lucrarea este Ã®ncheiatÄƒ. DacÄƒ È™ablonul nu ar exista, s-ar returna o paginÄƒ cu eroarea 404. Mai multe despre presentere puteÈ›i citi pe pagina [Presentere |presenters].

[* request-flow.svg *]

Pentru siguranÈ›Äƒ, sÄƒ Ã®ncercÄƒm sÄƒ recapitulÄƒm Ã®ntregul proces cu un URL puÈ›in diferit:

1) URL-ul va fi `https://example.com`
2) iniÈ›ializÄƒm aplicaÈ›ia, se creeazÄƒ containerul È™i se ruleazÄƒ `Application::run()`
3) routerul decodeazÄƒ URL-ul ca perechea `Home:default`
4) se creeazÄƒ obiectul clasei `HomePresenter`
5) se apeleazÄƒ metoda `renderDefault()` (dacÄƒ existÄƒ)
6) se redÄƒ È™ablonul, de ex. `default.latte` cu layout-ul, de ex. `@layout.latte`


Poate cÄƒ v-aÈ›i Ã®ntÃ¢lnit acum cu o mulÈ›ime de termeni noi, dar credem cÄƒ au sens. Crearea aplicaÈ›iilor Ã®n Nette este o adevÄƒratÄƒ plÄƒcere.


È˜abloane
========

Deoarece am ajuns la subiectul È™abloanelor, Ã®n Nette se utilizeazÄƒ sistemul de È™abloane [Latte |latte:]. De aceea È™i extensiile `.latte` la È™abloane. Latte se utilizeazÄƒ, pe de o parte, pentru cÄƒ este cel mai sigur sistem de È™abloane pentru PHP È™i, pe de altÄƒ parte, È™i cel mai intuitiv sistem. Nu trebuie sÄƒ Ã®nvÄƒÈ›aÈ›i multe lucruri noi, vÄƒ descurcaÈ›i cu cunoÈ™tinÈ›ele de PHP È™i cÃ¢teva tag-uri. Totul veÈ›i afla [Ã®n documentaÈ›ie |templates].

Ãn È™ablon se [creeazÄƒ linkuri |creating-links] cÄƒtre alÈ›i presenteri & acÈ›iuni astfel:

```latte
<a n:href="Product:show $productId">detaliu produs</a>
```

Pur È™i simplu, Ã®n loc de URL-ul real, scrieÈ›i perechea cunoscutÄƒ `Presenter:action` È™i specificaÈ›i eventualii parametri. Trucul este Ã®n `n:href`, care spune cÄƒ acest atribut va fi procesat de Nette. È˜i va genera:

```latte
<a href="/product/456">detaliu produs</a>
```

Generarea URL-ului este responsabilitatea routerului menÈ›ionat anterior. De fapt, routerele din Nette sunt excepÈ›ionale prin faptul cÄƒ pot efectua nu numai transformÄƒri din URL Ã®n perechea presenter:action, ci È™i invers, adicÄƒ din numele presenterului + acÈ›iunii + parametrilor sÄƒ genereze un URL. DatoritÄƒ acestui fapt, Ã®n Nette puteÈ›i schimba complet formele URL-urilor Ã®n Ã®ntreaga aplicaÈ›ie finalizatÄƒ, fÄƒrÄƒ a schimba un singur caracter Ã®n È™ablon sau presenter. Doar prin modificarea routerului. De asemenea, datoritÄƒ acestui fapt funcÈ›ioneazÄƒ aÈ™a-numita canonizare, care este o altÄƒ caracteristicÄƒ unicÄƒ a Nette, care contribuie la un SEO mai bun (optimizarea gÄƒsirii pe internet) prin prevenirea automatÄƒ a existenÈ›ei conÈ›inutului duplicat la URL-uri diferite. MulÈ›i programatori considerÄƒ acest lucru uimitor.


Componente interactive
======================

Despre presentere trebuie sÄƒ vÄƒ mai spunem un lucru: au Ã®ncorporat un sistem de componente. Ceva similar ar putea fi cunoscut de veterani din Delphi sau ASP.NET Web Forms, ceva asemÄƒnÄƒtor stÄƒ la baza React sau Vue.js. Ãn lumea framework-urilor PHP, este o caracteristicÄƒ complet unicÄƒ.

Componentele sunt unitÄƒÈ›i separate, reutilizabile, pe care le inserÄƒm Ã®n pagini (adicÄƒ presentere). Acestea pot fi [formulare |forms:in-presenter], [datagrid-uri |https://componette.org/contributte/datagrid/], meniuri, sondaje de votare, de fapt, orice are sens sÄƒ fie folosit Ã®n mod repetat. Putem crea propriile componente sau putem folosi unele din [oferta imensÄƒ |https://componette.org] de componente open source.

Componentele influenÈ›eazÄƒ fundamental abordarea creÄƒrii aplicaÈ›iilor. VÄƒ vor deschide noi posibilitÄƒÈ›i de compunere a paginilor din unitÄƒÈ›i pre-pregÄƒtite. È˜i, Ã®n plus, au ceva Ã®n comun cu [Hollywood-ul |components#Stilul Hollywood].


Container DI È™i configurare
===========================

Containerul DI sau fabrica de obiecte este inima Ã®ntregii aplicaÈ›ii.

Nu vÄƒ faceÈ›i griji, nu este nicio cutie neagrÄƒ magicÄƒ, aÈ™a cum ar putea pÄƒrea din rÃ¢ndurile anterioare. De fapt, este o clasÄƒ PHP destul de plictisitoare, pe care Nette o genereazÄƒ È™i o salveazÄƒ Ã®n directorul de cache. Are o mulÈ›ime de metode numite precum `createServiceAbcd()` È™i fiecare dintre ele È™tie sÄƒ creeze È™i sÄƒ returneze un anumit obiect. Da, existÄƒ È™i metoda `createServiceApplication()`, care creeazÄƒ `Nette\Application\Application`, de care aveam nevoie Ã®n fiÈ™ierul `index.php` pentru a porni aplicaÈ›ia. È˜i existÄƒ metode care creeazÄƒ presentere individuale. È˜i aÈ™a mai departe.

Obiectelor pe care le creeazÄƒ containerul DI li se spune, din anumite motive, servicii.

Ceea ce este cu adevÄƒrat special la aceastÄƒ clasÄƒ este cÄƒ nu o programaÈ›i voi, ci framework-ul. El genereazÄƒ efectiv codul PHP È™i Ã®l salveazÄƒ pe disc. Voi doar daÈ›i instrucÈ›iuni despre ce obiecte ar trebui sÄƒ È™tie sÄƒ creeze containerul È™i cum anume. Iar aceste instrucÈ›iuni sunt scrise Ã®n [fiÈ™ierele de configurare |bootstrap#Configurarea containerului DI], pentru care se utilizeazÄƒ formatul [NEON|neon:format] È™i, prin urmare, au È™i extensia `.neon`.

FiÈ™ierele de configurare servesc exclusiv pentru a instrui containerul DI. Deci, dacÄƒ, de exemplu, specific Ã®n secÈ›iunea [session |http:configuration#Sesiune] opÈ›iunea `expiration: 14 days`, atunci containerul DI, la crearea obiectului `Nette\Http\Session` reprezentÃ¢nd sesiunea, va apela metoda sa `setExpiration('14 days')` È™i astfel configuraÈ›ia devine realitate.

ExistÄƒ un capitol Ã®ntreg pregÄƒtit pentru voi, care descrie ce totul poate fi [configurat |nette:configuring] È™i cum sÄƒ [definiÈ›i propriile servicii |dependency-injection:services].

OdatÄƒ ce pÄƒtrundeÈ›i puÈ›in Ã®n crearea serviciilor, veÈ›i Ã®ntÃ¢lni cuvÃ¢ntul [autowiring |dependency-injection:autowiring]. Acesta este un truc care vÄƒ va simplifica viaÈ›a Ã®ntr-un mod incredibil. Poate transmite automat obiectele acolo unde aveÈ›i nevoie de ele (de exemplu, Ã®n constructorii claselor voastre), fÄƒrÄƒ a fi nevoie sÄƒ faceÈ›i nimic. VeÈ›i descoperi cÄƒ containerul DI din Nette este un mic miracol.


Unde sÄƒ mergem mai departe?
===========================

Am parcurs principiile de bazÄƒ ale aplicaÈ›iilor Ã®n Nette. DeocamdatÄƒ foarte superficial, dar Ã®n curÃ¢nd veÈ›i pÄƒtrunde Ã®n profunzime È™i, Ã®n timp, veÈ›i crea aplicaÈ›ii web minunate. Unde sÄƒ continuÄƒm? AÈ›i Ã®ncercat deja tutorialul [Scriem prima aplicaÈ›ie|quickstart:]?

Pe lÃ¢ngÄƒ cele descrise mai sus, Nette dispune de un Ã®ntreg arsenal de [clase utile|utils:], [un strat de baze de date|database:], etc. ÃncercaÈ›i sÄƒ rÄƒsfoiÈ›i documentaÈ›ia. Sau [blogul|https://blog.nette.org]. VeÈ›i descoperi o mulÈ›ime de lucruri interesante.

SperÄƒm ca framework-ul sÄƒ vÄƒ aducÄƒ multÄƒ bucurie ğŸ’™
