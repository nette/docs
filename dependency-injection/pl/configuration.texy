Konfiguracja kontenera DI
*************************

.[perex]
Przegląd opcji konfiguracyjnych kontenera Nette DI.

Kontener Nette DI jest łatwy w użyciu dzięki plikom konfiguracyjnym. Zazwyczaj są one zapisane w [formacie NEON |neon:format]. Do edycji zalecane są [edytory z obsługą |best-practices:editors-and-tools#ide-editor] tego formatu.
<pre>

"dekorator .[prism-token prism-atrule]":[#decorator]: "dekorator .[prism-token prism-comment]"<br>
"di .[prism-token prism-atrule]":[#DI]: "kontener DI .[prism-token prism-comment]"<br>
"rozszerzenia .[prism-token prism-atrule]":[#Rozšíření]: "Zainstaluj inne rozszerzenia DI .[prism-token prism-comment]"<br>
"zawiera .[prism-token prism-atrule]":[#Vkládání souborů]: "Wstawianie plików .[prism-token prism-comment]"<br>
"parametry .[prism-token prism-atrule]":[#parametry]: "parametry .[prism-token prism-comment]"<br>
"wyszukiwanie .[prism-token prism-atrule]":[#Search]: "Automatyczna rejestracja serwisu .[prism-token prism-comment]</pre>"<pre><br>
"usługi .[prism-token prism-atrule]":[services]: "usługi .[prism-token prism-comment]"<br>
</pre>

Aby wprowadzić ciąg zawierający znak `%`, musíte jej escapovat zdvojením na `%%`. .[note]


Parametry .[#toc-parametry]
===========================

W konfiguracji można zdefiniować parametry, które następnie mogą być wykorzystane jako część definicji usług. Może to uczynić konfigurację bardziej przejrzystą lub ujednolicić i wyizolować wartości, które będą zmieniane.

```neon
parameters:
	dsn: 'mysql:host=127.0.0.1;dbname=test'
	user: root
	password: secret
```

Do parametru `dsn` można się odwołać w dowolnym miejscu konfiguracji, pisząc `%dsn%`. Parametry mogą być również używane wewnątrz łańcuchów, np. `'%wwwDir%/images'`.

Parametry nie muszą być ciągami znaków lub liczbami, mogą również zawierać pola:

```neon
parameters:
	mailer:
		host: smtp.example.com
		secure: ssl
		user: franta@gmail.com
	languages: [cs, en, de]
```

Określony klucz określamy jako `%mailer.user%`.

Jeśli potrzebujesz uzyskać wartość dowolnego parametru w swoim kodzie, na przykład klasy, przekaż ją do tej klasy. Na przykład w konstruktorze. Nie ma globalnego obiektu reprezentującego konfigurację, którą klasy odpytywałyby o wartości parametrów. Byłoby to naruszenie zasady wtrysku zależności.


Usługi .[#toc-sluzby]
=====================

Patrz [osobny rozdział |services].


Dekorator .[#toc-decorator]
===========================

Jak masowo edytować wszystkie usługi danego typu? Na przykład wywołaj określoną metodę na wszystkich prezenterach, które dziedziczą po określonym wspólnym przodku? Do tego właśnie służy dekorator.

```neon
decorator:
	# u všech služeb, co jsou instancí této třídy nebo rozhraní
	App\Presenters\BasePresenter:
		setup:
			- setProjectId(10)       # zavolej tuto metodu
			- $absoluteUrls = true   # a nastav proměnnou
```

Dekorator może być również użyty do ustawienia [tagów |services#Tagy] lub włączenia trybu [iniekcji |services#Režim Inject].

```neon
decorator:
	InjectableInterface:
		tags: [mytag: 1]
		inject: true
```


DI
===

Ustawienia techniczne kontenera DI.

```neon
di:
	# zobrazit DIC v Tracy Bar?
	debugger: ...        # (bool) výchozí je true

	# typy parametrů, které nikdy neautowirovat
	excluded: ...        # (string[])

	# třída, od které dědí DI kontejner
	parentClass: ...     # (string) výchozí je Nette\DI\Container
```


Eksport metadanych .[#toc-export-metadat]
-----------------------------------------

Klasa kontenera DI zawiera również wiele metadanych. Możesz go zmniejszyć, zmniejszając eksport metadanych.

```neon
di:
	export:
		# exportovat parametry?
		parameters: false   # (bool) výchozí je true

		# exportovat tagy a které?
		tags:               # (string[]|bool) výchozí jsou všechny
			- event.subscriber

		# exportovat data pro autowiring a které?
		types:              # (string[]|bool) výchozí jsou všechny
			- Nette\Database\Connection
			- Symfony\Component\Console\Application
```

Jeśli nie używasz pola `$container->parameters`, możesz wyłączyć eksport parametrów. Można również wyeksportować tylko te tagi, za pośrednictwem których uzyskuje się usługi metodą `$container->findByTag(...)`.
Jeśli w ogóle nie wywołujesz metody, możesz całkowicie wyłączyć eksport tagów za pomocą `false`.

Możesz znacznie zmniejszyć metadane dla [autowiring |autowiring], określając klasy, których używasz jako parametr metody `$container->getByType()`.
I znowu, jeśli nie wywołujesz metody w ogóle (lub tylko w [bootstrapie |application:bootstrap], aby uzyskać `Nette\Application\Application`), możesz całkowicie wyłączyć eksport za pomocą `false`.


Przedłużenie .[#toc-rozsireni]
==============================

Zarejestruj więcej rozszerzeń DI. W ten sposób dodajemy np. rozszerzenie DI `Dibi\Bridges\Nette\DibiExtension22` pod nazwą `dibi`

```neon
extensions:
	dibi: Dibi\Bridges\Nette\DibiExtension22
```

Następnie konfigurujemy go w sekcji `dibi`:

```neon
dibi:
	host: localhost
```

Jako rozszerzenie możesz również dodać klasę, która ma parametry:

```neon
extensions:
	application: Nette\Bridges\ApplicationDI\ApplicationExtension(%debugMode%, %appDir%, %tempDir%/cache)
```


Wstawianie plików .[#toc-vkladani-souboru]
==========================================

Dodatkowe pliki konfiguracyjne można przesłać w sekcji `includes`:

```neon
includes:
	- parameters.php
	- services.neon
	- presenters.neon
```

Nazwa `parameters.php` nie jest literówką, konfiguracja może być również zapisana w pliku PHP, który zwraca ją jako tablicę:

```php
<?php
return [
	'database' => [
		'main' => [
			'dsn' => 'sqlite::memory:',
		],
	],
];
```

Jeśli w plikach konfiguracyjnych pojawią się elementy o takich samych kluczach, zostaną one nadpisane, lub [scalone |#Slučování] w przypadku [pól |#Slučování]. Plik wstawiony później ma wyższy priorytet niż poprzedni. Plik, w którym wymieniona jest sekcja `includes` ma wyższy priorytet niż pliki wstawione do niego.


Szukaj .[#toc-search]
=====================

Automatyczne dodawanie usług do kontenera DI czyni pracę niezwykle wygodną. Nette automatycznie dodaje prezenterów do kontenera, ale możesz łatwo dodać dowolne inne klasy.

Wystarczy określić, w których katalogach (i podkatalogach) szukać klas:

```neon
search:
	# názvy sekcí si volíte sami
	formuláře:
		in: %appDir%/Forms

	model:
		in: %appDir%/Model
```

Zazwyczaj nie chcemy dodawać wszystkich klas i interfejsów, więc możemy je filtrować:

```neon
search:
	formuláře:
		in: %appDir%/Forms

		# filtrování podle názvu souboru (string|string[])
		files:
			- *Factory.php

		# filtrování podle názvu třídy (string|string[])
		classes:
			- *Factory
```

Możemy też wybrać klasy, które dziedziczą lub implementują przynajmniej jedną z wymienionych klas:


```neon
search:
	formuláře:
		extends:
			- App\*Form
		implements:
			- App\*FormInterface
```

Można również zdefiniować reguły wykluczenia, czyli maski nazw klas lub dziedziczonych przodków, które jeśli będą pasować, usługa nie zostanie dodana do kontenera DI:

```neon
search:
	formuláře:
		exclude:
			classes: ...
			extends: ...
			implements: ...
```

Wszystkie usługi mogą być oznakowane:

```neon
search:
	formuláře:
		tags: ...
```


Łączenie .[#toc-slucovani]
==========================

Jeśli elementy o tych samych kluczach pojawią się w wielu plikach konfiguracyjnych, zostaną nadpisane lub, w przypadku tablic, scalone. Plik wstawiony później ma wyższy priorytet niż poprzedni.

<table class=table>
<tr>
	<th width=33%>config1.neon</th>
	<th width=33%>config2.neon</th>
	<th>Wynik</th>
</tr>
<tr>
	<td>
```neon
items:
	- 1
	- 2
```
	</td>
	<td>
```neon
items:
	- 3
```
	</td>
	<td>
```neon
items:
	- 1
	- 2
	- 3
```
	</td>
</tr>
</table>

W przypadku pól można zapobiec scalaniu, umieszczając wykrzyknik po nazwie klucza:

<table class=table>
<tr>
	<th width=33%>config1.neon</th>
	<th width=33%>config2.neon</th>
	<th>Wynik</th>
</tr>
<tr>
	<td>
```neon
items:
	- 1
	- 2
```
	</td>
	<td>
```neon
items!:
	- 3
```
	</td>
	<td>
```neon
items:
	- 3
```
	</td>
</tr>
</table>

{{maintitle: Konfigurace Dependency Injection}}
