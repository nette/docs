Latte Filters
*************

.[perex]
Filters are functions that change or format the data to a form we want. This is summary of the built-in filters which are available.

.[table-latte-filters]
|## String / array transformation
| `batch`      | [listing linear data in a table |#batch]
| `breakLines` | [Inserts HTML line breaks before all newlines |#breakLines]
| `bytes`      | [formats size in bytes |#bytes]
| `clamp`      | [clamps value to the range |#clamp]
| `dataStream` | [Data URI protocol conversion |#datastream]
| `date`       | [formats date |#date]
| `implode`    | [joins an array to a string |#implode]
| `indent`     | [indents the text from left with number of tabs |#indent]
| `length`     | returns length of a string or array
| `number`     | [formats number |#number]
| `padLeft`    | [completes the string to given length from left |#padLeft]
| `padRight`   | [completes the string to given length from right |#padRight]
| `repeat`     | [repeats the string |#repeat]
| `replace`    | [replaces all occurrences of the search string with the replacement |#replace]
| `replaceRE`  | [replaces all occurrences according to regular expression |#replaceRE]
| `reverse`    | [reverses an UTF‑8 string or array |#reverse]
| `sort`       | [sorts an array |#sort]
| `strip`      | [removes whitespace |#strip], similar to [spaceless |tags] tag
| `stripHtml`  | [removes HTML tags and converts HTML entities to text |#stripHtml]
| `substr`     | [returns part of the string |#substr]
| `trim`       | [strips whitespace from the string |#trim]
| `truncate`   | [shortens the length preserving whole words |#truncate]
| `webalize`   | [adjusts the UTF‑8 string to the shape used in the URL |#webalize]

.[table-latte-filters]
|## Letter casing
| `capitalize` | [lower case, the first letter of each word upper case |#capitalize]
| `firstUpper` | [makes the first letter upper case |#firstUpper]
| `lower`      | [makes a string lower case |#lower]
| `upper`      | [makes a string upper case |#upper]

.[table-latte-filters]
|## Escaping
| `escapeUrl`  | [escapes parameter in URL |#escapeUrl]
| `noescape`   | [prints a variable without escaping |tags#printing]
| `query`      | [generates a query string in the URL |#query]

There are also escaping filters for HTML (`escapeHtml` and `escapeHtmlComment`), XML (`escapeXml`), JavaScript (`escapeJs`), CSS (`escapeCss`) and iCalendar (`escapeICal`),
which Latte uses itself thanks to [context-aware escaping |safety-first#Context-aware escaping] and you do not need to write them.

.[table-latte-filters]
|## Security
| `checkUrl`   | [sanitizes string for use inside href attribute |#checkUrl]
| `noCheck`    | [prevents automatic URL sanitization |#noCheck]

Latte the `src` and `href` attributes [checks automatically |safety-first#link checking], so you almost don't need to use the `checkUrl` filter.


.[note]
All built-in filters work with UTF‑8 encoded strings.


Usage
=====

Latte allows calling filters by using the pipe sign notation (preceding space is allowed):

```html
<h1>{$heading|upper}</h1>
```

Filters can be chained, in that case they apply in order from left to right:

```html
<h1>{$heading|lower|capitalize}</h1>
```

Parameters are put after the filter name separated by colon or comma:

```html
<h1>{$heading|truncate:20,''}</h1>
```

Filters can be applied on expression:

```html
{var $name = ($title|upper) . ($subtitle|lower)}</h1>
```

Custom filters can be registered this way:

```php
$latte = new Latte\Engine;
$latte->addFilter('shortify', function (string $s, int $len = 10): string {
	return mb_substr($s, 0, $len);
});
```

We use it in a template like this:

```html
<p>{$text|shortify}</p>
<p>{$text|shortify:100}</p>
```


Filters
=======


batch(int length, mixed item): array .[filter]{data-version:2.7}
----------------------------------------------------------------
Filter that simplifies the listing of linear data in the form of a table. It returns an array of array with the given number of items. If you provide a second parameter this is used to fill up missing items on the last row.

```html
{var $items = ['a', 'b', 'c', 'd', 'e']}
<table>
{foreach ($items|batch: 3, 'No item') as $row}
	<tr>
		{foreach $row as $column}
			<td>{$column}</td>
		{/foreach}
	</tr>
{/foreach}
</table>
```

Prints:

```html
<table>
	<tr>
		<td>a</td>
		<td>b</td>
		<td>c</td>
	</tr>
	<tr>
		<td>d</td>
		<td>e</td>
		<td>No item</td>
	</tr>
</table>
```


breakLines
----------
Inserts HTML line breaks before all newlines.

```latte
{var $s = "Text & with \n newline"}
{$s|breakLines}    {* outputs "Text &amp; with <br>\n newline" *}
```


bytes(int precision = 2) .[filter]
----------------------------------
Formats a size in bytes to human-readable form.

```html
{$size|bytes}     0 B, 1.25 GB, …
{$size|bytes:0}   10 B, 1 GB, …
```


clamp(int|float min, int|float max) .[filter]{data-version:2.9}
---------------------------------------------------------------
Returns value clamped to the inclusive range of min and max.

```html
{$level|clamp: 0, 255}
```

Also exists as function:

```html
{=clamp($level, 0, 255)}
```


dataStream(string mimetype = detect) .[filter]
----------------------------------------------
Converts the content to data URI scheme. It can be used to insert images into HTML or CSS without the need to link external files.

Lets have an image in a variable `$img = Image::fromFile('obrazek.gif')`, then

```html
<img src="{$img|dataStream}">
```

Prints for example:

```html
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==">
```

.[caution]
Requires PHP extension `fileinfo`.


date(string format) .[filter]
-----------------------------
Returns a date in the given format using options of [php:strftime] or [php:date] PHP functions. Filter gets a date as a UNIX timestamp, a string or an object of `DateTime` type.

```html
{$today|date:'%d.%m.%Y'}
{$today|date:'j. n. Y'}
```


implode(string glue = '') .[filter]
-----------------------------------
Return a string which is the concatenation of the strings in the array. The separator between elements is an empty string per default, you can define it with the optional parameter.

```latte
{=[1, 2, 3]|implode}      {* outputs '123' *}
{=[1, 2, 3]|implode:'|'}  {* outputs '1|2|3' *}
```


indent(int level = 1, string char = "\t") .[filter]
---------------------------------------------------
Indents a text from left by a given number of tabs or other characters which we specify in the second optional argument.
Blank lines are not indented.

```html
<div>
{block |indent}
<p>Hello</p>
{/block}
</div>
```

Prints:

```html
<div>
	<p>Hello</p>
</div>
```


length
------
Returns length of a string or array.

- for strings, it will return length in UTF‑8 characters
- for arrays, it will return count of items
- for objects that implement the Countable interface, it will use the return value of the count()
- for objects that implement the IteratorAggregate interface, it will use the return value of the iterator_count()


```latte
{if ($users|length) > 10}
	...
{/if}
```


number(int decimals = 0, string decPoint = '.', string thousandsSep = ',') .[filter]
------------------------------------------------------------------------------------
Formats a number to given number of decimal places. You can also specify a character of the decimal point and thousands separator.

```html
{1234.20 |number}              1,234
{1234.20 |number:1}            1,234.2
{1234.20 |number:2}            1,234.20
{1234.20 |number:2, ',', ' '}  1 234,20
```


padLeft(int length, string pad = ' ') .[filter]
-----------------------------------------------
Pads a string to a certain length with another string from left.

```latte
{='hello'|padLeft: 10, '123'}  {* outputs '12312hello' *}
```


padRight(int length, string pad = ' ') .[filter]
------------------------------------------------
Pads a string to a certain length with another string from right.

```latte
{='hello'|padRight: 10, '123'}  {* outputs 'hello12312' *}
```


repeat(int count) .[filter]
---------------------------
Repeats the string x-times.

```latte
{='hello'|repeat: 3}  {* outputs 'hellohellohello' *}
```


replace(string search, string replace = '') .[filter]
-----------------------------------------------------
Replaces all occurrences of the search string with the replacement string.

```latte
{='hello world'|replace: 'world', 'friend'}  {* outputs 'hello friend' *}
```


replaceRE(string pattern, string replace = '') .[filter]
--------------------------------------------------------
Replaces all occurrences according to regular expression.

```latte
{='hello world'|replaceRE: 'l.*', 'l'}  {* outputs 'hel' *}
```


reverse
-------
Reverses given string or array.

```latte
{var $s = 'Nette'}
{$s|reverse}    {* outputs 'etteN' *}
{var $a = ['N', 'e', 't', 't', 'e']}
{$a|reverse}    {* returns ['e', 't', 't', 'e', 'N'] *}
```


sort .{data-version:2.9}
------------------------
Filter that sorts array.

```html
{foreach ($names|sort) as $name}
	...
{/foreach}
```

Array sorted in reverse order.

```html
{foreach ($names|sort|reverse) as $name}
	...
{/foreach}
```


strip
-----
Removes unnecessary whitespace from the output.

```html
{block |strip}
	<ul>
		<li>Hello</li>
	</ul>
{/block}
```

Prints:

```html
<ul> <li>Hello</li> </ul>
```


stripHtml
---------
Removes HTML tags and converts HTML entities to text.

```latte
{='<p>one &lt; two</p>'|stripHtml}  {* outputs 'one < two' *}
```


substr(int offset, int length = null) .[filter]
-----------------------------------------------
Extracts a slice of a string. Works as the PHP function `mb_substr` with fallback to `iconv_substr` in UTF‑8 mode.

```latte
{$string|substr: 1, 2}
```


trim
----
Strip leading and trailing characters, by default whitespace.

```latte
{='  I like Latte.  '|trim}    {* outputs 'I like Latte.' *}
{='  I like Latte.'|trim: '.'} {* outputs '  I like Latte' *}
```


truncate(int length, string append = '…') .[filter]
---------------------------------------------------
Shortens a string to the maximum given length but tries to preserve whole words. If the string is truncated it adds ellipsis at the end (this can be changed by the second parameter).

```latte
{var $title = 'Hello, how are you?'}
{$title|truncate:5}  {* Hell…                *}
{$title|truncate:17} {* Hello, how are…      *}
{$title|truncate:30} {* Hello, how are you?  *}
```


webalize
--------
Converts to ASCII. Converts spaces to hyphens. Removes characters that aren’t alphanumerics, underscores, or hyphens. Converts to lowercase. Also strips leading and trailing whitespace.

```latte
{var $s = 'Our 10. product'}
{$s|webalize}    {* outputs 'our-10-product' *}
```

.[caution]
Requires package [nette/utils|doc:utils].


Letter Casing
=============

.[caution]
Requires PHP extension `mbstring`.


capitalize
----------
Returns a title-cased version of the value. Words will start with uppercase letters, all remaining characters are lowercase.

```latte
{='i like LATTE'|capitalize}  {* outputs 'I Like Latte' *}

```


firstUpper
----------
Converts a first letter of value to uppercase.

```latte
{='the latte'|firstUpper}  {* outputs 'The latte' *}
```


lower
-----
Converts a value to lowercase.


```latte
{='LATTE'|lower}   {* outputs 'latte' *}
```


upper
-----
Converts a value to uppercase.

```latte
{='latte'|upper}  {* outputs 'LATTE' *}
```


Escaping
========


escapeUrl
---------
Escapes a variable to be used as a parameter in URL.

```html
<a href="http://example.com/{$name|escapeUrl}">{$name}</a>
```


noescape
--------
Disables automatic escaping.


query .{data-version:2.10}
--------------------------
Dynamically generates a query string in the URL:

```html
<a href="http://example.com/?{[name: 'John Doe', age: 43]|query}">click</a>
```

Generates:

```html
<a href="http://example.com/?name=John+Doe&amp;age=43">click</a>
```

Keys with a value of `null` are omitted.


Security
========


checkUrl
--------
Enforces URL sanitization. It checks if the variable contains a web URL (ie. HTTP/HTTPS protocol) and prevents the writing of links that may pose a security risk.

```html
{var $link = 'javascript:window.close()'}
<a data-href="{$link|checkUrl}">checked</a>
<a data-href="{$link}">unchecked</a>
```

Generates:

```html
<a data-href="">checked</a>
<a data-href="javascript:window.close()">unchecked</a>
```


noCheck
-------
Prevents automatic URL sanitization. Latte [automatically checks|safety-first#Link checking] if the variable contains a web URL (ie. HTTP/HTTPS protocol) and prevents the writing of links that may pose a security risk.

If the link uses a different scheme, such as `javascript:` or `data:`, and you are sure of its contents, you can disable the check via `|noCheck`.

```html
{var $link = 'javascript:window.close()'}

<a href="{$link}">checked</a>
<a href="{$link|noCheck}">unchecked</a>
```

Generates:

```html
<a href="">checked</a>
<a href="javascript:window.close()">unchecked</a>
```


{{composer: latte/latte}}
