`nette.ajax.js`
**********

Alternativní obslužný skript pro AJAX. .[perex]

|* Github | https://github.com/vojtech-dobes/nette.ajax.js
|* Bug reporty,<br>feature requesty | https://github.com/vojtech-dobes/nette.ajax.js/issues
|* Fórum | http://forum.nette.org/cs/11005-nette-ajax-js-alt-obsluha-pro-ajax-s-jquery
|* Autor | Vojtěch Dobeš (vychází z "tohoto doplňku":http://addons.nette.org/cs/jquery-ajax)
|* Licence | MIT

Instalace
----------

1. Zkopírujeme `nette.ajax.js` do složky s Javascriptovými soubory.
2. Přilinkujeme jej nejlépe v `@layout.latte` (až za jQuery!).
3. Provedeme inicializaci (v nějakém našem zaváděcím JS skriptu):

/--js
$(function () {
	$.nette.init();
});
\--

Použití
----------

Ve výchozím nastavení skript zajaxuje všechny odkazy a formuláře s CSS třídou `ajax`. Chování lze změnit konfigurací rozšíření `init`. Na objektu vráceném po zavolání `var init = $.nette.ext('init');` lze nastavit tyto vlastností:

|--------------------------------
| název | výchozí hodnota | popis
|--------------------------------
| `linkSelector` | `a.ajax` | CSS selektor pro odkazy
| `formSelector` | `form.ajax` | CSS selektor pro formuláře
| `buttonSelector` | `input.ajax[type="submit"], input.ajax[type="image"]` | CSS selektor pro odesílací prvky formuláře

Ajaxizace je zavěšena na události `click` (resp. `submit`) ve jmenném prostoru `nette`. Z konkrétního odkazu lze tedy zrušit ajaxizaci podobným kódem (přičemž ostatní callbacky zůstanou zachovány):

/--js
$('a.no-ajax').off('click.nette');
\--

Pokud výchozí chování nestačí, lze celou ajaxizaci přepsat vlastním chováním, např.:

/--js
$.nette.init(function (netteAjaxHandler) {
	$('a.ajax:not(.no-ajax)').live('click', ajaxHandler);
});
\--

Rozšíření
----------

Ajaxizace zapouzdřuje standardní volání `$.ajax()` a doplňuje je o několik událostí, do nichž lze zavěšovat vlastní callbacky. Související skupina callbacků se nazývá **rozšíření**. Zpracování snippetů, možnost probíhající Ajaxový požadavek zrušit klávesou *Escape*... to vše je realizováno formou rozšíření. Registraci rozšíření vypadá takto:

/--js
$.nette.ext('name', {
	event1: function () {
	},
	event2: ...
}, {
	// ... sdílený kontext všech callbacků (dostupný přes this)
});
\--

První argument je název rozšíření, a je nepovinný.

Druhý argument obsahuje pole callbacků, kde klíčem je název odpovídající události. Poslouchat lze následující události:

|--------------
| název | popis
|--------------
| `init` | Volá se jen jednou při volání `$.nette.init();`.
| `load` | Slouží k ajaxizaci. Jako argument dostává funkci, která se postará o vyvolání ajaxového požadavku. Výchozí ajaxizace ji zavěšuje do událostí `click` a `submit` ajaxizovaných elementů.
| `before` | Volá se těsně před zahájením Ajaxového požadavku.
| `start` | Volá se těsně před zahájením Ajaxového požadavku. Jako argumenty dostává objekt `jqXHR` a objekt vlastností požadavku.
| `success` | Volá se při úspěšném dokončení Ajaxového požadavku. Ekvivalentní s `$.ajax( ... ).done( ...`.
| `complete` | Volá se vždy po dokončení Ajaxového požadavku. Ekvivalentní s `$.ajax( ... ).always( ...`.
| `error` | Volá se při selhání Ajaxového požadavku. Ekvivalentní s `$.ajax( ... ).fail( ...`.

Rozšíření lze vypnout voláním:

/--js
$.nette.ext('name', null);
\--

K úpravám nastavení lze získat kontext rozšíření:

/--js
var context = $.nette.ext('name');
\--

Výchozí rozšíření
-----------------

|--------------
| název | popis
|--------------
| `validation` | Povolí ajaxizaci pouze tehdy, pokud kliknutí/odeslání neproběhlo se stisknutou klávesou *Ctrl*, *Alt* nebo *Shift*, odkaz není externí nebo jen nemění hash a formulář je validní.
| `forms` | Umožňuje Ajaxově odesílat formuláře i s daty, názvem odesílacího tlačítka či souřadnicemi kliknutí v `input[type=image]`.
| `snippets` | Aktualizuje DOM, pokud server vrátí pole `snippets` (což Nette dělá v případě invalidace snippetů v šabloně).
| `redirect` | Provede přesměrování, pokud server vrátí položku `redirect` (což Nette dělá při zavolání `$this->redirect()`).
| `unique` | Stará se o to, aby vždy probíhal pouze jeden požadavek (automaticky zruší starší).
| `abort` | Umožňuje zrušit probíhající požadavek klávesou *Escape*.
| `init` | Zajišťuje výchozí ajaxizaci.

{{author: vojtech.dobes|3328}}
