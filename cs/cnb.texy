ČNB - aktuální kurzovní lístek
********************

Pomocí třídy **Cnb**, skript napsaný v PHP, můžete stáhnout libovolnou měnu a nechat ji na jakoukoliv přepočítat.

|Verze | 1.6
|Download | [cnb.zip | attachment:cnb.zip]
|Ukázka | [ČNB | http://nette.gepard-mb.cz/cnb/]
|Forum thread | http://forum.nette.org/cs/1880-cnb-ceska-narodni-banka
|Autor | Milan Matějček ([matata | http://forum.nette.org/cs/profile.php?id=1966])
|Licence | New BSD License

Instalace
---------

Stáhněte archiv [cnb.zip | attachment:cnb.zip] a jeho obsah si uložte dle vaší adresářové struktury např: do "app/components". V archivu je soubor EXAMPLE.php, v něm je ukázka použití.

Popis co umí
------------
-práce se session (pouze ve spolupraci s Nette) nativne ukládá poslední použitou měnu a zobrazení s dph nebo bez
-lze použít i pro zahraniční e-shop, protože nemusí využivat kourunu českou
-nezáleží na používání velikosti písma při definování měny např:(EUR, eur, eUr)
-metoda format() upravý měnu podle uživatelsky definované předlohy, výsledek tvoří validní UTF-8
-ukládá si jednu zálohu, kdyby došlo k špatnému stažení z ČNB tak si načte předchozí hodnoty
-vrací datum/timestamp posleslední aktualizace podle stáří souboru
-stahuje všechny dostupné měny na cnb.cz cca 160 (némá vliv na výkonnost)
-podpora zobrazení cen s dph
-korekcre kurzu, tzn. lze procentuelně zvednout kurz, či snížit


Nette\Templates
---------------
.[note]
**Příklad použití jako helper v šabloně [doc:Nette\Templates]**

**BasePresenter.php**
/--php

protected function beforeRender()
{
    //curr a dph, jsou názvy parametru v url, ?curr=eur&dph=0
    //stačí provést Copy/Paste
    CnbNette::register($this->template, 'curr', 'dph' /*true rovnou zobrazuje ceny s dph*/);
}
\--

**default.phtml**
/--php
{!$a=10|currency} //10 Kč
<br/>
{!$a|vat} //12 Kč - cena s dph
<br/>
{!$currency} // proměnná pro url = curr
<br/>
{!$vat} // proměnná pro url = dph
\--

v url pro viditelné změny stačí přidat **?curr=usd&dph=1**


mimo Nette šablony
-----------
.[note]
**Nasledující ukázka je použití mimo Nette šablony**

/--php
Environment::loadConfig();
\--
a doporučuji nastavit expiraci cookie a spuštení session které třída také využívá
/--php
$session    =Environment::getSession();
$session    ->setExpiration(15552000);//180 dní
if (!$session->isStarted())
    $session->start();
\--
kódy jako czk, rub, eur, usd jsou vzaty z kurzovního lístku na url Cnb::CNB_LIST

stačí za url zadat **?m=eur** a vse se přepočítá a zformátuje
/--php

if(!isset($_GET['m']))
    $_GET['m']=null;

$cnb    =new Cnb($_GET['m']);
//nebo $cnb    =new CnbHistory($_GET['m'], 30, 12, 2000);//budete pracovat s kurzem danného data
//nebo $cnb    =new CnbWithOutNette($_GET['m']);//jak pracovat bez Nette
echo $cnb->format(10);//10 Kč
echo $cnb->format(10, 'eur', 'usd');//převede 10 eur na dolary a vrati cca $1.56

echo $cnb->getDate('Y-m-d');//vrátí datum posledního stažení kurzovního lístku
var_dump( $cnb->getAllCode() );//všechny dostupné měny a jejich vlastnosti se kterými můžete pracovat
\--
Hisrotie
--------

1.6)
-kosmetické úpravy kodu
-špatně se načítala turecká měna
-zmenšení cache souboru na disku o více jak 50%

1.5.3)
-podstatné zrychlení metod format() a change()
-aj. kosmetické úpravy

1.5.2)
-statická třída určená jen pro Nette, **CnbNette**

1.5.1)
-popisky v angličtině
-příklady

1.5)
-podpora zobrazování cen s dph i bez dph


1.4)
-trošku pozměněná struktura souboru na disku
-nové stahovani historie s ukládaním do databáze

1.3)
-nová metoda __call, pro rychlejši přístup k informacím
-odstraněna metoda defineMoney() nahrazena getRating()
-možnost stažení staršího kurzu, použijte třídu CnbHistory
-nově se ukláda id kurzu vydaneho za danný rok a datum
-historie ma jedno omezení, tj nestahuje Cnb::CNB_LIST2 těchto měn se nevede historie

1.2)
-nova metoda defineMoney() spolupracuje s vlastnosti $defineMoney kde si nastavite vychozi pro web
-metoda format, kdyz druhy parametr je TRUE, mena se neprepocita jen zformatuje
-fix: opravena moznost korekce men
-vlastnosti static prevedeny na dynamicke aby sli dedenim menit
-funkcnost i bez Nette avsak prijdete o ukladani do session, trida **CnbWithOutNette**
-fix: opraveno nacitani pres CUrl

1.1)
-stahuje kompletne cely kurzovni listek a nacte se online pouze prepocet ktery bude potreba
-tzn nemusite premyslet nad tim jake vsechny meny budete potrebovat
-vsechny dostupne meny ziskate pomoci metody getAllCode()
-vylepsena metoda format(), nyní si lze nastavit z ceho na co prepocitat a zformatuje podle nastaveni

1.0)
-nová metoda format(), která formatuje každou měnu samostatně, tzn máte czk → 15 365 Kč, usd → $1,955.35, gbp → £1 568.45

0.9.1)
-vnitřní úpravy bez vlivu na funkčnost

0.9)
-přidán helper pro šablony na úpravu formátu čísla, vycházel jsem z [Helper currency | helper-currency]



{{attachment: cnb.zip}}
{{attachment: cnb.zip}}

{{author: h4kuna|1966}}
