Konfigurace
***********

.[perex]
Kompletn√≠ pr≈Øvodce konfigurac√≠ Texy. Nauƒç√≠te se ovl√°dat v≈°echny moduly, nastavit bezpeƒçnost a p≈ôizp≈Øsobit Texy va≈°im pot≈ôeb√°m.

Texy se konfiguruje pomoc√≠ **public properties** hlavn√≠ t≈ô√≠dy `Texy\Texy` a jej√≠ch **modul≈Ø**. Ka≈æd√Ω modul je zodpovƒõdn√Ω za zpracov√°n√≠ konkr√©tn√≠ ƒç√°sti syntaxe (obr√°zky, odkazy, nadpisy...).

Z√°kladn√≠ p≈ô√≠stup:

```php
$texy = new Texy\Texy;

// Konfigurace hlavn√≠ t≈ô√≠dy
$texy->allowedTags = Texy\Texy::NONE;

// Konfigurace modulu
$texy->imageModule->root = '/images/';
```


T≈ô√≠da Texy\Texy .[#texy-class]
==============================

Hlavn√≠ t≈ô√≠da obsahuje glob√°ln√≠ nastaven√≠ a vlastnosti ovliv≈àuj√≠c√≠ cel√© zpracov√°n√≠.


Povolen√© syntaxe ($allowed) .{toc: $allowed}
--------------------------------------------

Pole `$allowed` kontroluje, kter√© ƒç√°sti Texy syntaxe jsou aktivn√≠:

```php
// V√Ωchoz√≠: v≈°echny syntaxe povoleny (kromƒõ emotikon≈Ø)
$texy->allowed['image'] = true;
$texy->allowed['emoticon'] = false;

// Vypnout obr√°zky
$texy->allowed['image'] = false;

// Vypnout HTML znaƒçky ve vstupu
$texy->allowed['html/tag'] = false;
$texy->allowed['html/comment'] = false;

// Vypnout r≈Øzn√© typy odkaz≈Ø
$texy->allowed['link/reference'] = false;
$texy->allowed['link/email'] = false;
$texy->allowed['link/url'] = false;
```

**Kompletn√≠ seznam syntax√≠:**

|---
| Kl√≠ƒç | V√Ωchoz√≠ | Popis
|---
| `image` | `true` | Obr√°zky `[* img.jpg *]`
| `figure` | `true` | Obr√°zky s popiskou
| `link/reference` | `true` | Reference `[ref]`
| `link/email` | `true` | Email adresy
| `link/url` | `true` | Automatick√© URL
| `link/definition` | `true` | Definice referenc√≠
| `heading/underlined` | `true` | Podtr≈æen√© nadpisy
| `heading/surrounded` | `true` | Ohraniƒçen√© nadpisy
| `horizline` | `true` | Horizont√°ln√≠ ƒç√°ry
| `blockquote` | `true` | Citace
| `list` | `true` | Seznamy
| `list/definition` | `true` | Definiƒçn√≠ seznamy
| `table` | `true` | Tabulky
| `phrase/strong` | `true` | Tuƒçn√© p√≠smo `**text**`
| `phrase/em` | `true` | Kurz√≠va `//text//`
| `phrase/em-alt` | `true` | Kurz√≠va `*text*`
| `phrase/code` | `true` | K√≥d ```text```
| `phrase/ins` | `false` | Vlo≈æen√Ω text `++text++`
| `phrase/del` | `false` | Smazan√Ω text `--text--`
| `phrase/sup` | `false` | Horn√≠ index `^^text^^`
| `phrase/sub` | `false` | Doln√≠ index `__text__`
| `html/tag` | `true` | HTML znaƒçky ve vstupu
| `html/comment` | `true` | HTML koment√°≈ôe
| `emoticon` | `false` | Emotikony `:-)`, `:-(`
| `blocks` | `true` | Bloky `/-- \--`
| `typography` | `true` | Typografick√© √∫pravy
| `longwords` | `true` | Dƒõlen√≠ dlouh√Ωch slov


Povolen√© HTML znaƒçky ($allowedTags) .{toc: $allowedTags}
--------------------------------------------------------

Kontroluje, kter√© HTML znaƒçky mohou b√Ωt ve v√Ωstupu (a na vstupu):

```php
// V√Ωchoz√≠: v≈°echny validn√≠ HTML5 znaƒçky povoleny
$texy->allowedTags = Texy\Texy::ALL;

// Zak√°zat v≈°echny HTML znaƒçky
$texy->allowedTags = Texy\Texy::NONE;

// Povolit jen konkr√©tn√≠ znaƒçky
$texy->allowedTags = [
	'strong' => [],  // <strong> bez atribut≈Ø
	'a' => ['href', 'title'],  // <a> s atributy
	'img' => Texy\Texy::ALL,  // <img> s jak√Ωmikoliv atributy
];
```

**Form√°ty:**
- `Texy::ALL` ‚Äì v≈°echny znaƒçky povoleny
- `Texy::NONE` ‚Äì ≈æ√°dn√© znaƒçky povoleny
- Pole ‚Äì povolen√© znaƒçky jako kl√≠ƒçe, povolen√© atributy jako hodnoty


Povolen√© CSS t≈ô√≠dy ($allowedClasses) .{toc: $allowedClasses}
------------------------------------------------------------

Kontroluje, kter√© CSS t≈ô√≠dy a ID mohou b√Ωt pou≈æity:

```php
// V√Ωchoz√≠: v≈°echny t≈ô√≠dy a ID povoleny
$texy->allowedClasses = Texy\Texy::ALL;

// Zak√°zat t≈ô√≠dy a ID
$texy->allowedClasses = Texy\Texy::NONE;

// Povolit konkr√©tn√≠ t≈ô√≠dy a ID
$texy->allowedClasses = [
	'highlight',
	'important',
	'#main',  // ID zaƒç√≠naj√≠ #
	'#sidebar',
];
```

Pou≈æit√≠:
```texy
Text s t≈ô√≠dou .[highlight]

Text s ID .{toc: main}
```


Povolen√© CSS styly ($allowedStyles) .{toc: $allowedStyles}
----------------------------------------------------------

Kontroluje, kter√© inline CSS vlastnosti mohou b√Ωt pou≈æity:

```php
// V√Ωchoz√≠: v≈°echny styly povoleny
$texy->allowedStyles = Texy\Texy::ALL;

// Zak√°zat inline styly
$texy->allowedStyles = Texy\Texy::NONE;

// Povolit konkr√©tn√≠ CSS vlastnosti
$texy->allowedStyles = [
	'color',
	'background-color',
	'font-size',
];
```

Pou≈æit√≠:
```texy
Text s barvou .{color: red}
```


CSS t≈ô√≠dy pro zarovn√°n√≠ ($alignClasses) .{toc: $alignClasses}
-------------------------------------------------------------

M√≠sto inline styl≈Ø `style="text-align:left"` m≈Ø≈æete pou≈æ√≠t CSS t≈ô√≠dy:

```php
// V√Ωchoz√≠: pr√°zdn√© pole (pou≈æij√≠ se inline styly)
$texy->alignClasses = [
	'left' => null,
	'right' => null,
	'center' => null,
	'justify' => null,
	'top' => null,
	'middle' => null,
	'bottom' => null,
];

// Nastavit t≈ô√≠dy
$texy->alignClasses['left'] = 'text-left';
$texy->alignClasses['right'] = 'text-right';
$texy->alignClasses['center'] = 'text-center';
```

Pou≈æit√≠:
```texy
Text zarovnan√Ω doleva .

Text zarovnan√Ω doprava .>
```

S nastaven√Ωm `alignClasses` vygeneruje `<p class="text-left">` m√≠sto `<p style="text-align:left">`.


Dal≈°√≠ vlastnosti
----------------

```php
// Spojov√°n√≠ ≈ô√°dk≈Ø do odstavc≈Ø (v√Ωchoz√≠: true)
$texy->mergeLines = true;

// ≈†√≠≈ôka tabul√°toru (v√Ωchoz√≠: 8)
$texy->tabWidth = 8;

// Maskov√°n√≠ email≈Ø p≈ôed roboty (v√Ωchoz√≠: true)
$texy->obfuscateEmail = true;

// Odstra≈àov√°n√≠ mƒõkk√Ωch spojovn√≠k≈Ø (v√Ωchoz√≠: true)
$texy->removeSoftHyphens = true;

// Element pro netextov√© odstavce (v√Ωchoz√≠: 'div')
$texy->nontextParagraph = 'div';
```


Moduly
======

Ka≈æd√Ω modul zpracov√°v√° konkr√©tn√≠ ƒç√°st syntaxe. Moduly jsou p≈ô√≠stupn√© jako public properties t≈ô√≠dy `Texy\Texy`.


HeadingModule
-------------

Zpracov√°v√° nadpisy (podtr≈æen√© i ohraniƒçen√©).

```php
// √örove≈à nejvy≈°≈°√≠ho nadpisu (v√Ωchoz√≠: 1)
$texy->headingModule->top = 1;  // <h1>

// Generovat automatick√° ID (v√Ωchoz√≠: false)
$texy->headingModule->generateID = true;

// Prefix pro generovan√° ID (v√Ωchoz√≠: 'toc-')
$texy->headingModule->idPrefix = 'section-';

// V√≠ce znak≈Ø = vy≈°≈°√≠ nadpis? (v√Ωchoz√≠: true)
$texy->headingModule->moreMeansHigher = true;

// Re≈æim vyva≈æov√°n√≠ (v√Ωchoz√≠: DYNAMIC)
$texy->headingModule->balancing = Texy\Modules\HeadingModule::DYNAMIC;
```

Po zpracov√°n√≠:

```php
// Prvn√≠ nadpis (pro <title>)
echo $texy->headingModule->title;

// Obsah (Table of Contents)
print_r($texy->headingModule->TOC);
```


PhraseModule
------------

Zpracov√°v√° inline form√°tov√°n√≠ (tuƒçn√©, kurz√≠va, odkazy v textu...).

```php
// HTML znaƒçky pro jednotliv√© fr√°ze (v√Ωchoz√≠: viz n√≠≈æe)
$texy->phraseModule->tags = [
	'phrase/strong' => 'strong',
	'phrase/em' => 'em',
	'phrase/code' => 'code',
	// ... dal≈°√≠
];

// Povolit odkazy ve fr√°z√≠ch (v√Ωchoz√≠: true)
$texy->phraseModule->linksAllowed = true;
```


LinkModule
----------

Zpracov√°v√° odkazy, reference a URL.

```php
// Ko≈ôenov√° cesta pro odkazy (v√Ωchoz√≠: '')
$texy->linkModule->root = '/articles/';

// CSS t≈ô√≠da pro odkazy na obr√°zky (v√Ωchoz√≠: null)
$texy->linkModule->imageClass = 'image-link';

// V≈ædy p≈ôid√°vat rel="nofollow" (v√Ωchoz√≠: false)
$texy->linkModule->forceNoFollow = false;

// Zkracovat URL na ƒçitelnƒõj≈°√≠ formu (v√Ωchoz√≠: true)
$texy->linkModule->shorten = true;
```

**Reference:**

```php
// P≈ôidat referenci
$link = new Texy\Link('https://example.com');
$link->modifier->title = 'Uk√°zkov√° str√°nka';
$link->label = 'P≈ô√≠klad';
$texy->linkModule->addReference('example', $link);
```

Pou≈æit√≠:
```texy
Odkaz na [example]
```


ImageModule
-----------

Zpracov√°v√° obr√°zky.

```php
// Ko≈ôenov√° cesta pro obr√°zky (v√Ωchoz√≠: 'images/')
$texy->imageModule->root = '/assets/images/';

// Ko≈ôenov√° cesta pro linkovan√© obr√°zky (v√Ωchoz√≠: 'images/')
$texy->imageModule->linkedRoot = '/assets/images/full/';

// Fyzick√° cesta na disku (pro zji≈°tƒõn√≠ rozmƒõr≈Ø)
$texy->imageModule->fileRoot = __DIR__ . '/public/images/';

// CSS t≈ô√≠da pro plovouc√≠ obr√°zky (v√Ωchoz√≠: null)
$texy->imageModule->leftClass = 'float-left';
$texy->imageModule->rightClass = 'float-right';

// V√Ωchoz√≠ alternativn√≠ text (v√Ωchoz√≠: '')
$texy->imageModule->defaultAlt = 'Obr√°zek';
```

**Reference:**

```php
// P≈ôidat referenci
$image = new Texy\Image;
$image->URL = 'photo.jpg';
$image->modifier->title = 'Fotografie';
$texy->imageModule->addReference('photo', $image);
```


FigureModule
------------

Zpracov√°v√° obr√°zky s popiskou.

```php
// HTML element (v√Ωchoz√≠: 'div')
$texy->figureModule->tagName = 'figure';

// CSS t≈ô√≠da (v√Ωchoz√≠: 'figure')
$texy->figureModule->class = 'photo-figure';

// T≈ô√≠dy pro plovouc√≠ obr√°zky (v√Ωchoz√≠: null)
$texy->figureModule->leftClass = 'figure-left';
$texy->figureModule->rightClass = 'figure-right';

// Offset pro v√Ωpoƒçet ≈°√≠≈ôky (v√Ωchoz√≠: 10)
$texy->figureModule->widthDelta = 20;

// Vy≈æadovat popisku (v√Ωchoz√≠: true)
$texy->figureModule->requireCaption = true;
```


ListModule
----------

Zpracov√°v√° odr√°≈ækov√©, ƒç√≠slovan√© a definiƒçn√≠ seznamy.

```php
// Definice odr√°≈æek a stylu (v√Ωchoz√≠: viz zdrojov√Ω k√≥d)
$texy->listModule->bullets = [
	'*' => ['\*[\ \t]', 0, ''],
	'-' => ['[\x{2013}-](?![>-])', 0, ''],
	// ... dal≈°√≠
];
```


TableModule
-----------

Zpracov√°v√° tabulky.

```php
// CSS t≈ô√≠dy pro ≈ô√°dky (v√Ωchoz√≠: null)
$texy->tableModule->oddClass = 'odd';
$texy->tableModule->evenClass = 'even';
```

*Pozn√°mka: `oddClass` a `evenClass` jsou deprecated.*


HorizLineModule
---------------

Zpracov√°v√° horizont√°ln√≠ ƒç√°ry.

```php
// CSS t≈ô√≠dy podle typu (v√Ωchoz√≠: null)
$texy->horizLineModule->classes = [
	'-' => 'hr-line',
	'*' => 'hr-star',
];
```


TypographyModule
----------------

Zpracov√°v√° typografick√© √∫pravy.

```php
// Locale (v√Ωchoz√≠: 'cs')
$texy->typographyModule->locale = 'en';
```

**Podporovan√© locales:**
- `cs` ‚Äì ƒçesk√© uvozovky ‚Äûtext" a ‚Äötext'
- `en` ‚Äì anglick√© uvozovky "text" a 'text'
- `fr` ‚Äì francouzsk√© uvozovky ¬´text¬ª a ‚Äπtext‚Ä∫
- `de` ‚Äì nƒõmeck√© uvozovky ‚Äûtext" a ‚Äötext'
- `pl` ‚Äì polsk√© uvozovky ‚Äûtext" a ‚Äötext'


LongWordsModule
---------------

Rozdƒõluje dlouh√° slova pomoc√≠ `&shy;`.

```php
// Maxim√°ln√≠ d√©lka slova (v√Ωchoz√≠: 20)
$texy->longWordsModule->wordLimit = 25;
```


EmoticonModule
--------------

Nahrazuje emotikony za obr√°zky nebo Unicode znaky.

```php
// CSS t≈ô√≠da (v√Ωchoz√≠: null)
$texy->emoticonModule->class = 'emoji';

// Cesta k obr√°zk≈Øm (v√Ωchoz√≠: null = pou≈æije imageModule->root)
$texy->emoticonModule->root = '/images/smilies/';
$texy->emoticonModule->fileRoot = __DIR__ . '/public/smilies/';

// Definice emotikon≈Ø (v√Ωchoz√≠: z√°kladn√≠ sada)
$texy->emoticonModule->icons = [
	':-)' => 'üôÇ',
	':-(' => '‚òπ',
	';-)' => 'üòâ',
	// ... nebo cesty k obr√°zk≈Øm
	':cool:' => 'cool.gif',
];
```


HtmlModule
----------

Zpracov√°v√° HTML znaƒçky a koment√°≈ôe ve vstupn√≠m textu.

```php
// Zobrazit HTML koment√°≈ôe na v√Ωstupu (v√Ωchoz√≠: true)
$texy->htmlModule->passComment = true;
```


HtmlOutputModule
----------------

Form√°tuje v√Ωstupn√≠ HTML.

```php
// Form√°tovat v√Ωstup (odsazen√≠) (v√Ωchoz√≠: true)
$texy->htmlOutputModule->indent = true;

// Z√°kladn√≠ odsazen√≠ (v√Ωchoz√≠: 0)
$texy->htmlOutputModule->baseIndent = 0;

// Maxim√°ln√≠ ≈°√≠≈ôka ≈ô√°dku (v√Ωchoz√≠: 80)
$texy->htmlOutputModule->lineWrap = 100;

// Zachovat mezery v tƒõchto elementech (v√Ωchoz√≠: seznam)
$texy->htmlOutputModule->preserveSpaces = [
	'textarea', 'pre', 'script', 'code',
];
```


ScriptModule
------------

Zpracov√°v√° vol√°n√≠ `{{makro}}`.

```php
// Oddƒõlovaƒç argument≈Ø (v√Ωchoz√≠: ',')
$texy->scriptModule->separator = ';';
```


T≈ô√≠da Texy\Configurator .{toc: Texy\Configurator}
=================================================

P≈ôedp≈ôipraven√© konfiguraƒçn√≠ sety pro ƒçast√© use-case.


safeMode() ‚Äì Bezpeƒçn√Ω re≈æim .{toc: safeMode()}
----------------------------------------------

Konfigurace pro zpracov√°n√≠ **ned≈Øvƒõryhodn√©ho obsahu** od u≈æivatel≈Ø.

```php
Texy\Configurator::safeMode($texy);
```

**Co dƒõl√°:**
- Zak√°≈æe t≈ô√≠dy a ID (`$allowedClasses = NONE`)
- Zak√°≈æe inline styly (`$allowedStyles = NONE`)
- Povol√≠ jen bezpeƒçn√© HTML znaƒçky:

```php
[
	'a' => ['href', 'title'],
	'abbr' => ['title'],
	'b' => [],
	'br' => [],
	'cite' => [],
	'code' => [],
	'em' => [],
	'i' => [],
	'strong' => [],
	'sub' => [],
	'sup' => [],
	'q' => [],
	'small' => [],
]
```

- Filtruje URL sch√©mata (jen `http:`, `https:`, `ftp:`, `mailto:`)
- Zak√°≈æe obr√°zky
- Zak√°≈æe definice referenc√≠
- Zak√°≈æe HTML koment√°≈ôe
- P≈ôid√° `rel="nofollow"` ke v≈°em odkaz≈Øm


disableLinks() ‚Äì Vypnout odkazy .{toc: disableLinks()}
------------------------------------------------------

Zak√°≈æe v≈°echny typy odkaz≈Ø.

```php
Texy\Configurator::disableLinks($texy);
```

**Co dƒõl√°:**
- Zak√°≈æe v≈°echny typy odkaz≈Ø (`link/reference`, `link/email`, `link/url`, `link/definition`)
- Zak√°≈æe odkazy ve fr√°z√≠ch (`phraseModule->linksAllowed = false`)
- Odebere `<a>` z povolen√Ωch znaƒçek


disableImages() ‚Äì Vypnout obr√°zky .{toc: disableImages()}
---------------------------------------------------------

Zak√°≈æe v≈°echny typy obr√°zk≈Ø.

```php
Texy\Configurator::disableImages($texy);
```

**Co dƒõl√°:**
- Zak√°≈æe obr√°zky (`image`, `figure`, `image/definition`)
- Odebere `<img>`, `<object>`, `<embed>`, `<applet>` z povolen√Ωch znaƒçek


Bezpeƒçnost
==========

Texy je navr≈æeno s d≈Ørazem na bezpeƒçnost. Automaticky chr√°n√≠ p≈ôed bƒõ≈æn√Ωmi √∫toky.


Ochrana proti XSS
-----------------

Cross-Site Scripting (XSS) je √∫tok, kdy √∫toƒçn√≠k vlo≈æ√≠ ≈°kodliv√Ω JavaScript do str√°nky.

**P≈ô√≠klad √∫tok≈Ø, kter√© Texy zablokuje:**

```texy
Pokus o √∫tok: <script>alert('XSS')</script>

Pokus o √∫tok: <img src=x onerror="alert('XSS')">

Pokus o √∫tok: "klikni":javascript:alert('XSS')

Pokus o √∫tok: [* image.jpg onload="alert('XSS')" *]
```

Texy automaticky:
- **Validuje HTML** ‚Äì odstran√≠ nepovolen√© znaƒçky a atributy
- **Filtruje URL** ‚Äì povol√≠ jen bezpeƒçn√° sch√©mata (`http:`, `https:`, `mailto:`, `ftp:`)
- **Escapuje obsah** ‚Äì spr√°vnƒõ escapuje text v atributech
- **Sanitizuje atributy** ‚Äì odstran√≠ event handlery (`onclick`, `onerror`, ...)

```php
$texy = new Texy\Texy;
Texy\Configurator::safeMode($texy);

$input = '<script>alert("XSS")</script>';
$output = $texy->process($input);

// V√Ωstup: pr√°zdn√Ω (script tag odstranƒõn)
```


Validace URL
------------

Texy kontroluje URL ve v≈°ech odkazech a obr√°zc√≠ch:

```php
$texy = new Texy\Texy;

// Nastavit povolen√° sch√©mata (v√Ωchoz√≠ v safeMode)
$texy->urlSchemeFilters[Texy\Texy::FILTER_ANCHOR] =
	'#https?:|ftp:|mailto:#Ai';
$texy->urlSchemeFilters[Texy\Texy::FILTER_IMAGE] =
	'#https?:#Ai';
```

**P≈ô√≠klady blokovan√Ωch URL:**

```texy
"√∫tok":javascript:alert('XSS')  // blokov√°no
"√∫tok":data:text/html,<script>  // blokov√°no
[* javascript:alert() *]  // blokov√°no
```


Filtrov√°n√≠ HTML znaƒçek
----------------------

Kontrola p≈ôes `$allowedTags`:

```php
$texy = new Texy\Texy;

// Povolit jen bezpeƒçn√© znaƒçky
$texy->allowedTags = [
	'p' => [],
	'strong' => [],
	'em' => [],
	'a' => ['href', 'title'],  // jen tyto atributy
];

$input = '<p>Text <script>alert()</script></p>';
$output = $texy->process($input);

// V√Ωstup: <p>Text alert()</p>
// (script tag odstranƒõn)
```


Praktick√Ω p≈ô√≠klad
-----------------

```php
function processComment(string $userInput): string
{
	$texy = new Texy\Texy;

	// Bezpeƒçn√Ω re≈æim
	Texy\Configurator::safeMode($texy);

	// Dodateƒçn√° omezen√≠
	$texy->allowed['link/url'] = false;  // zak√°zat auto-linky
	$texy->allowed['html/tag'] = false;  // zak√°zat HTML

	// Zpracovat
	return $texy->process($userInput);
}

// Pou≈æit√≠
$comment = $_POST['comment'];
$html = processComment($comment);
echo $html;  // bezpeƒçn√Ω v√Ωstup
```


Best practices
--------------

1. **V≈ædy pou≈æijte safeMode()** pro u≈æivatelsk√Ω obsah
2. **Validujte vstup** p≈ôed p≈ôed√°n√≠m Texy (d√©lka, form√°t)
3. **Limitujte HTML znaƒçky** podle pot≈ôeby
4. **Kontrolujte v√Ωstup** ‚Äì i kdy≈æ Texy je bezpeƒçn√©, double-check nikdy neu≈°kod√≠
5. **Logujte podez≈ôel√© pokusy** ‚Äì m≈Ø≈æe v√°m pomoci identifikovat √∫toƒçn√≠ky

```php
$texy = new Texy\Texy;
Texy\Configurator::safeMode($texy);

// Logov√°n√≠
$texy->addHandler('htmlTag', function($invocation, $el, $isStart) {
	if ($el->getName() === 'script') {
		error_log('XSS attempt detected!');
	}
	return $invocation->proceed();
});
```
