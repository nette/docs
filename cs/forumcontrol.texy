ForumControl
************

Doplněk umožňuje jednoduché vytváření diskuzních fór ve stylu, který se dá považovat za standard na webech jako jsou Root.cz, Zdroják.cz, Lupa nebo Živě.

Komponenta je napsána pro PHP 5.3 a Nette Framework 2.0 (20110804). Jedinou použitou knihovnou (kromě Nette) je knihovna dibi.

Databázový model diskuzního fóra (MySQL) vychází z článku [Diskuze s reakcemi | http://php.vrana.cz/diskuse-s-reakcemi.php], který uveřejnil Jakub Vrána na svém blogu. Z něj je patrné, že pro úspěšné provozování fóra je potřeba pro uživatele databáze oprávnění k zamykání tabulek. Výhodou Jakubova přístupu je vždy jen jeden SQL dotaz, kterým lze zobrazit buď všechny názory v diskuzi nebo jen vybrané.

|Verze | 1.1.0
|Download | [ForumControl.zip | http://nette.radekdostal.cz/forumcontrol/ForumControl-v1.1.0.zip] (180 kB)
|GitHub | [https://github.com/radekdostal/Nette-ForumControl/ | https://github.com/radekdostal/Nette-ForumControl/]
|Fórum | [http://forum.nette.org/cs/7146-komponenta-forumcontrol-pro-diskuzni-fora | http://forum.nette.org/cs/7146-komponenta-forumcontrol-pro-diskuzni-fora]
|Autor | Radek Dostál
|Licence | GNU Lesser General Public License
|PHP | 5.3

Instalace
---------

V archivu je doplněk již součástí ukázkové aplikace. Samotná komponenta se nachází v adresáři lib/Nette/Extras/ForumControl.

Součástí distribuce je rovněž SQL skript, který vytvoří dvě databázové tabulky - //forum// pro diskuzní fóra a //forum_threads// pro názory v těchto fórech.

Implementace
------------

Prvním krokem je vytvoření továrničky na komponentu - viz metoda //createComponentForumControl()//. V této metodě se vytvoří instance modelu a společně s namapovanými parametry se předá konstruktoru třídy //ForumControl//. Model je součástí distribučního archivu. Nic ovšem nebrání použití jiného modelu, za předpokladu, že tento bude implementovat rozhraní //IForumControlModel// a zachovávat aliasy sloupců databázových tabulek.

Dalším krokem je použití takto vytvořené továrničky na komponentu - viz metoda //renderDefault()//.

Posledním krokem je už jen vykreslení komponenty do šablony //default.latte//.

Příklad použití
---------------

Metody v presenteru:

/--php
/**
 * Forum Control component
 *
 * @access protected
 * @return ForumControl
 */
protected function createComponentForumControl()
{
  // 1 = forum ID from table "forum"
  $model = new ForumControl\ForumControlModel(1, new \DibiConnection($this->context->params['database']));

  // Params mapping
  $params = array(
    'topicId' => 'id',
    'allTopics' => 'id2',
    'selectedTopicsIds' => 'o'
  );

  return new ForumControl\ForumControl($this->context, $model, $params);
}

/**
 * Discussion forum
 *
 * @access public
 * @param int $id topic ID to reply (0 = new topic)
 * @param int $id2 view all topics? (1 = yes)
 * @return void
 */
public function renderDefault($id, $id2)
{
  $this->template->dataOk = TRUE;

  try
  {
    ob_start();
    $this['forumControl']->render();
    $this->template->forumControl = ob_get_clean();
  }
  catch (ForumControlException $e)
  {
    $this->presenter->flashMessage($e->getMessage(), 'error');
    $this->template->dataOk = FALSE;
  }
}
\--

Kód v šabloně:

/--php
{block #content}
{if $dataOk}
{!$forumControl}
{/if}
\--

Ukázky použití
--------------

[Statické obrázky | http://www.radekdostal.cz/software/forum-control#toc-ukazky-pouziti]

Poznámka
--------

Je-li např. podstrčeno neexistující ID názoru, na který se reaguje, komponenta vyhodí výjimku //ForumControlException//. A tady bych chtěl požádat o radu. Právě kvůli zachycení výjimky se mi kód v metodě //renderDefault()// vůbec nelíbí. Chtěl bych, aby šlo i v případě vyhození výjimky použít v šabloně jen {control forumControl}, existuje způsob, jak by to šlo udělat? Protože v této chvíli by k vyhození výjimky došlo až při samotném renderování, a to už je pozdě.

{{author: radas|2560}}
