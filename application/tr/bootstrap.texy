Bootstrap
*********

<div class=perex>

Bootstrap, ortamÄ± baÅŸlatan, baÄŸÄ±mlÄ±lÄ±k enjeksiyonu (DI) konteynerini oluÅŸturan ve uygulamayÄ± baÅŸlatan bir baÅŸlatma kodudur. ÅunlarÄ± ele alacaÄŸÄ±z:

- NEON dosyalarÄ± kullanÄ±larak nasÄ±l yapÄ±landÄ±rÄ±lÄ±r
- Ã¼retim ve geliÅŸtirme modlarÄ± nasÄ±l ayÄ±rt edilir
- DI konteyneri nasÄ±l oluÅŸturulur

</div>


Uygulamalar, ister web uygulamalarÄ± ister komut satÄ±rÄ±ndan Ã§alÄ±ÅŸtÄ±rÄ±lan betikler olsun, Ã§alÄ±ÅŸmalarÄ±na bir tÃ¼r ortam baÅŸlatma ile baÅŸlarlar. Eski zamanlarda, bu genellikle ilk dosyanÄ±n dahil ettiÄŸi `include.inc.php` gibi bir dosyanÄ±n sorumluluÄŸundaydÄ±.
Modern Nette uygulamalarÄ±nda, bunun yerini uygulamanÄ±n bir parÃ§asÄ± olarak `app/Bootstrap.php` dosyasÄ±nda bulunan `Bootstrap` sÄ±nÄ±fÄ± almÄ±ÅŸtÄ±r. Ã–rneÄŸin ÅŸÃ¶yle gÃ¶rÃ¼nebilir:

```php
use Nette\Bootstrap\Configurator;

class Bootstrap
{
	private Configurator $configurator;
	private string $rootDir;

	public function __construct()
	{
		$this->rootDir = dirname(__DIR__);
		// YapÄ±landÄ±rÄ±cÄ±, uygulama ortamÄ±nÄ± ve servisleri ayarlamaktan sorumludur.
		$this->configurator = new Configurator;
		// Nette tarafÄ±ndan oluÅŸturulan geÃ§ici dosyalar iÃ§in dizini ayarlar (Ã¶rn. derlenmiÅŸ ÅŸablonlar)
		$this->configurator->setTempDirectory($this->rootDir . '/temp');
	}

	public function bootWebApplication(): Nette\DI\Container
	{
		$this->initializeEnvironment();
		$this->setupContainer();
		return $this->configurator->createContainer();
	}

	private function initializeEnvironment(): void
	{
		// Nette akÄ±llÄ±dÄ±r ve geliÅŸtirme modu otomatik olarak aÃ§Ä±lÄ±r,
		// veya aÅŸaÄŸÄ±daki satÄ±rÄ±n yorumunu kaldÄ±rarak belirli bir IP adresi iÃ§in etkinleÅŸtirebilirsiniz:
		// $this->configurator->setDebugMode('secret@23.75.345.200');

		// Tracy'yi etkinleÅŸtirir: hata ayÄ±klama iÃ§in nihai "Ä°sviÃ§re Ã§akÄ±sÄ±".
		$this->configurator->enableTracy($this->rootDir . '/log');

		// RobotLoader: seÃ§ilen dizindeki tÃ¼m sÄ±nÄ±flarÄ± otomatik olarak yÃ¼kler
		$this->configurator->createRobotLoader()
			->addDirectory(__DIR__)
			->register();
	}

	private function setupContainer(): void
	{
		// YapÄ±landÄ±rma dosyalarÄ±nÄ± yÃ¼kler
		$this->configurator->addConfig($this->rootDir . '/config/common.neon');
	}
}
```


index.php
=========

Web uygulamalarÄ± durumunda ilk dosya, [genel dizinde |directory-structure#verejny-adresar-www] `www/` bulunan `index.php` dosyasÄ±dÄ±r. Bu dosya, Bootstrap sÄ±nÄ±fÄ±ndan ortamÄ± baÅŸlatmasÄ±nÄ± ve DI konteynerini oluÅŸturmasÄ±nÄ± ister. ArdÄ±ndan, web uygulamasÄ±nÄ± baÅŸlatan `Application` servisini ondan alÄ±r:

```php
$bootstrap = new App\Bootstrap;
// OrtamÄ± baÅŸlat + DI konteynerini oluÅŸtur
$container = $bootstrap->bootWebApplication();
// DI konteyneri Nette\Application\Application nesnesini oluÅŸturur
$application = $container->getByType(Nette\Application\Application::class);
// Nette uygulamasÄ±nÄ± baÅŸlat ve gelen isteÄŸi iÅŸle
$application->run();
```

GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z gibi, ortamÄ± ayarlamaya ve baÄŸÄ±mlÄ±lÄ±k enjeksiyonu (DI) konteynerini oluÅŸturmaya [api:Nette\Bootstrap\Configurator] sÄ±nÄ±fÄ± yardÄ±mcÄ± olur, ÅŸimdi onu daha yakÄ±ndan tanÄ±yacaÄŸÄ±z.


GeliÅŸtirme vs Ãœretim Modu
=========================

Nette, geliÅŸtirme veya Ã¼retim sunucusunda Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±na baÄŸlÄ± olarak farklÄ± davranÄ±r:

ğŸ› ï¸  GeliÅŸtirme Modu (Development):
	- YararlÄ± bilgilerle (SQL sorgularÄ±, yÃ¼rÃ¼tme sÃ¼resi, kullanÄ±lan bellek) Tracy hata ayÄ±klama Ã§ubuÄŸunu gÃ¶sterir
	- Bir hata durumunda, fonksiyon Ã§aÄŸrÄ±larÄ± ve deÄŸiÅŸken iÃ§erikleriyle ayrÄ±ntÄ±lÄ± bir hata sayfasÄ± gÃ¶sterir
	- Latte ÅŸablonlarÄ± deÄŸiÅŸtiÄŸinde, yapÄ±landÄ±rma dosyalarÄ± dÃ¼zenlendiÄŸinde vb. Ã¶nbelleÄŸi otomatik olarak yeniler


ğŸš€  Ãœretim Modu (Production):
	- Hata ayÄ±klama bilgisi gÃ¶stermez, tÃ¼m hatalarÄ± gÃ¼nlÃ¼ÄŸe yazar
	- Bir hata durumunda, ErrorPresenter'Ä± veya genel "Server Error" sayfasÄ±nÄ± gÃ¶sterir
	- Ã–nbellek asla otomatik olarak yenilenmez!
	- HÄ±z ve gÃ¼venlik iÃ§in optimize edilmiÅŸtir


Mod seÃ§imi otomatik algÄ±lama ile yapÄ±lÄ±r, bu nedenle genellikle herhangi bir ÅŸeyi yapÄ±landÄ±rmaya veya manuel olarak deÄŸiÅŸtirmeye gerek yoktur:

- geliÅŸtirme modu: localhost'ta (IP adresi `127.0.0.1` veya `::1`) proxy mevcut deÄŸilse (yani HTTP baÅŸlÄ±ÄŸÄ± yoksa)
- Ã¼retim modu: her yerde

GeliÅŸtirme modunu diÄŸer durumlarda da etkinleÅŸtirmek istersek, Ã¶rneÄŸin belirli bir IP adresinden eriÅŸen programcÄ±lar iÃ§in, `setDebugMode()` kullanÄ±rÄ±z:

```php
$this->configurator->setDebugMode('23.75.345.200'); // IP adresleri dizisi de belirtilebilir
```

Kesinlikle IP adresini bir Ã§erezle birleÅŸtirmenizi Ã¶neririz. `nette-debug` Ã§erezine gizli bir belirteÃ§, Ã¶rneÄŸin `secret1234` kaydederiz ve bu ÅŸekilde belirli bir IP adresinden eriÅŸen ve aynÄ± zamanda Ã§erezde belirtilen belirtece sahip olan programcÄ±lar iÃ§in geliÅŸtirme modunu etkinleÅŸtiririz:

```php
$this->configurator->setDebugMode('secret1234@23.75.345.200');
```

GeliÅŸtirme modunu tamamen kapatabiliriz, localhost iÃ§in bile:

```php
$this->configurator->setDebugMode(false);
```

Dikkat, `true` deÄŸeri geliÅŸtirme modunu zorla aÃ§ar, bu Ã¼retim sunucusunda asla olmamalÄ±dÄ±r.


Hata AyÄ±klama AracÄ± Tracy
=========================

Kolay hata ayÄ±klama iÃ§in harika [Tracy |tracy:] aracÄ±nÄ± da etkinleÅŸtireceÄŸiz. GeliÅŸtirme modunda hatalarÄ± gÃ¶rselleÅŸtirir ve Ã¼retim modunda hatalarÄ± belirtilen dizine gÃ¼nlÃ¼ÄŸe kaydeder:

```php
$this->configurator->enableTracy($this->rootDir . '/log');
```


GeÃ§ici Dosyalar
===============

Nette, DI konteyneri, RobotLoader, ÅŸablonlar vb. iÃ§in Ã¶nbellek kullanÄ±r. Bu nedenle, Ã¶nbelleÄŸin depolanacaÄŸÄ± dizinin yolunu ayarlamak gerekir:

```php
$this->configurator->setTempDirectory($this->rootDir . '/temp');
```

Linux veya macOS'ta, `log/` ve `temp/` dizinlerine [yazma izinlerini |nette:troubleshooting#NastavenÃ­ prÃ¡v adresÃ¡Å™Å¯] ayarlayÄ±n.


RobotLoader
===========

Genellikle [RobotLoader |robot-loader:] kullanarak sÄ±nÄ±flarÄ± otomatik olarak yÃ¼klemek isteyeceÄŸiz, bu yÃ¼zden onu baÅŸlatmalÄ± ve `Bootstrap.php` dosyasÄ±nÄ±n bulunduÄŸu dizinden (yani `__DIR__`) ve tÃ¼m alt dizinlerden sÄ±nÄ±flarÄ± yÃ¼klemesine izin vermeliyiz:

```php
$this->configurator->createRobotLoader()
	->addDirectory(__DIR__)
	->register();
```

Alternatif bir yaklaÅŸÄ±m, PSR-4'e uyarak sÄ±nÄ±flarÄ± yalnÄ±zca [Composer |best-practices:composer] aracÄ±lÄ±ÄŸÄ±yla yÃ¼klemektir.


Zaman Dilimi
============

YapÄ±landÄ±rÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla varsayÄ±lan zaman dilimini ayarlayabilirsiniz.

```php
$this->configurator->setTimeZone('Europe/Prague');
```


DI Konteyner YapÄ±landÄ±rmasÄ±
===========================

BaÅŸlatma sÃ¼recinin bir parÃ§asÄ±, tÃ¼m uygulamanÄ±n kalbi olan nesneler iÃ§in bir fabrika olan DI konteynerinin oluÅŸturulmasÄ±dÄ±r. AslÄ±nda bu, Nette tarafÄ±ndan oluÅŸturulan ve Ã¶nbellek dizinine kaydedilen bir PHP sÄ±nÄ±fÄ±dÄ±r. Fabrika, uygulamanÄ±n temel nesnelerini Ã¼retir ve yapÄ±landÄ±rma dosyalarÄ± aracÄ±lÄ±ÄŸÄ±yla ona nasÄ±l oluÅŸturulacaÄŸÄ±nÄ± ve ayarlanacaÄŸÄ±nÄ± bildiririz, bÃ¶ylece tÃ¼m uygulamanÄ±n davranÄ±ÅŸÄ±nÄ± etkileriz.

YapÄ±landÄ±rma dosyalarÄ± genellikle [NEON |neon:format] formatÄ±nda yazÄ±lÄ±r. AyrÄ± bir bÃ¶lÃ¼mde, [nelerin yapÄ±landÄ±rÄ±labileceÄŸini |nette:configuring] Ã¶ÄŸreneceksiniz.

.[tip]
GeliÅŸtirme modunda, kod veya yapÄ±landÄ±rma dosyalarÄ± her deÄŸiÅŸtiÄŸinde konteyner otomatik olarak gÃ¼ncellenir. Ãœretim modunda, yalnÄ±zca bir kez oluÅŸturulur ve performansÄ± en Ã¼st dÃ¼zeye Ã§Ä±karmak iÃ§in deÄŸiÅŸiklikler kontrol edilmez.

YapÄ±landÄ±rma dosyalarÄ±nÄ± `addConfig()` kullanarak yÃ¼kleriz:

```php
$this->configurator->addConfig($this->rootDir . '/config/common.neon');
```

Daha fazla yapÄ±landÄ±rma dosyasÄ± eklemek istiyorsak, `addConfig()` fonksiyonunu birden Ã§ok kez Ã§aÄŸÄ±rabiliriz.

```php
$configDir = $this->rootDir . '/config';
$this->configurator->addConfig($configDir . '/common.neon');
$this->configurator->addConfig($configDir . '/services.neon');
if (PHP_SAPI === 'cli') {
	$this->configurator->addConfig($configDir . '/cli.php');
}
```

`cli.php` adÄ± bir yazÄ±m hatasÄ± deÄŸildir, yapÄ±landÄ±rma bir dizi olarak dÃ¶ndÃ¼ren bir PHP dosyasÄ±nda da yazÄ±labilir.

AyrÄ±ca [ `includes` bÃ¶lÃ¼mÃ¼nde |dependency-injection:configuration#VklÃ¡dÃ¡nÃ­ souborÅ¯] baÅŸka yapÄ±landÄ±rma dosyalarÄ± da ekleyebiliriz.

YapÄ±landÄ±rma dosyalarÄ±nda aynÄ± anahtarlara sahip Ã¶ÄŸeler gÃ¶rÃ¼nÃ¼rse, bunlar Ã¼zerine yazÄ±lÄ±r veya [diziler durumunda birleÅŸtirilir |dependency-injection:configuration#SluÄovÃ¡nÃ­]. Daha sonra eklenen dosya, Ã¶ncekinden daha yÃ¼ksek Ã¶nceliÄŸe sahiptir. `includes` bÃ¶lÃ¼mÃ¼nÃ¼n belirtildiÄŸi dosya, iÃ§ine dahil edilen dosyalardan daha yÃ¼ksek Ã¶nceliÄŸe sahiptir.


Statik Parametreler
-------------------

YapÄ±landÄ±rma dosyalarÄ±nda kullanÄ±lan parametreleri [`parameters` bÃ¶lÃ¼mÃ¼nde|dependency-injection:configuration#parametry] tanÄ±mlayabilir ve ayrÄ±ca `addStaticParameters()` metoduyla (alias `addParameters()`) iletebilir (veya Ã¼zerine yazabiliriz). Ã–nemli olan, farklÄ± parametre deÄŸerlerinin ek DI konteynerlerinin, yani ek sÄ±nÄ±flarÄ±n oluÅŸturulmasÄ±na neden olmasÄ±dÄ±r.

```php
$this->configurator->addStaticParameters([
	'projectId' => 23,
]);
```

`projectId` parametresine yapÄ±landÄ±rmada normal `%projectId%` gÃ¶sterimiyle baÅŸvurulabilir.


Dinamik Parametreler
--------------------

Konteynere dinamik parametreler de ekleyebiliriz; bunlarÄ±n farklÄ± deÄŸerleri, statik parametrelerin aksine, yeni DI konteynerlerinin oluÅŸturulmasÄ±na neden olmaz.

```php
$this->configurator->addDynamicParameters([
	'remoteIp' => $_SERVER['REMOTE_ADDR'],
]);
```

Bu ÅŸekilde, Ã¶rneÄŸin ortam deÄŸiÅŸkenlerini kolayca ekleyebiliriz, bunlara daha sonra yapÄ±landÄ±rmada `%env.variable%` gÃ¶sterimiyle baÅŸvurulabilir.

```php
$this->configurator->addDynamicParameters([
	'env' => getenv(),
]);
```


VarsayÄ±lan Parametreler
-----------------------

YapÄ±landÄ±rma dosyalarÄ±nda ÅŸu statik parametreleri kullanabilirsiniz:

- `%appDir%`, `Bootstrap.php` dosyasÄ±nÄ± iÃ§eren dizine mutlak yoldur
- `%wwwDir%`, giriÅŸ dosyasÄ± `index.php` dosyasÄ±nÄ± iÃ§eren dizine mutlak yoldur
- `%tempDir%`, geÃ§ici dosyalar iÃ§in dizine mutlak yoldur
- `%vendorDir%`, Composer'Ä±n kÃ¼tÃ¼phaneleri kurduÄŸu dizine mutlak yoldur
- `%rootDir%`, projenin kÃ¶k dizinine mutlak yoldur
- `%debugMode%`, uygulamanÄ±n hata ayÄ±klama modunda olup olmadÄ±ÄŸÄ±nÄ± belirtir
- `%consoleMode%`, isteÄŸin komut satÄ±rÄ±ndan gelip gelmediÄŸini belirtir


Ä°Ã§e AktarÄ±lan Servisler
-----------------------

Åimdi daha derine iniyoruz. DI konteynerinin amacÄ± nesneleri Ã¼retmek olsa da, istisnai olarak mevcut bir nesneyi konteynere ekleme ihtiyacÄ± doÄŸabilir. Bunu, servisi `imported: true` bayraÄŸÄ±yla tanÄ±mlayarak yaparÄ±z.

```neon
services:
	myservice:
		type: App\Model\MyCustomService
		imported: true
```

Ve bootstrap'ta nesneyi konteynere ekleriz:

```php
$this->configurator->addServices([
	'myservice' => new App\Model\MyCustomService('foobar'),
]);
```


FarklÄ± Ortam
============

Bootstrap sÄ±nÄ±fÄ±nÄ± ihtiyaÃ§larÄ±nÄ±za gÃ¶re deÄŸiÅŸtirmekten Ã§ekinmeyin. Web projelerini ayÄ±rt etmek iÃ§in `bootWebApplication()` metoduna parametreler ekleyebilirsiniz. Veya birim testleri iÃ§in ortamÄ± baÅŸlatan `bootTestEnvironment()`, komut satÄ±rÄ±ndan Ã§aÄŸrÄ±lan betikler iÃ§in `bootConsoleApplication()` gibi baÅŸka metotlar ekleyebiliriz.

```php
public function bootTestEnvironment(): Nette\DI\Container
{
	Tester\Environment::setup(); // Nette Tester'Ä± baÅŸlat
	$this->setupContainer();
	return $this->configurator->createContainer();
}

public function bootConsoleApplication(): Nette\DI\Container
{
	$this->configurator->setDebugMode(false);
	$this->initializeEnvironment();
	$this->setupContainer();
	return $this->configurator->createContainer();
}
```
