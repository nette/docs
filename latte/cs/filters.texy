Latte filtry
************

.[perex]
V šablonách můžeme používat funkce, které pomáhají upravit nebo přeformátovat data do výsledné podoby. Říkáme jim *filtry*.

.[table-latte-summary]
|## Transformace řetězců nebo polí
| `truncate`  `(length, append = '…') .[small]`         | [zkrátí délku se zachováním slov |#truncate]
| `substr`    `(offset [, length]) .[small]`            | vrátí část řetězce
| `trim`      `(charset = mezery) .[small]`             | odstraní počáteční a koncové mezery či jiné znaky
| `stripHtml`                                           | odstraní HTML značky a HTML entity převede na znaky
| `strip`                                               | [odstraní bílé místo |#strip], podobně jako značka [spaceless |tags]
| `indent`    `(level = 1, char = "\t") .[small]`       | [odsadí text zleva o daný počet tabulátorů |#indent]
| `replace`   `(search, replace = '') .[small]`         | zamění výskyty hledaného řetězce
| `replaceRE` `(pattern, replace = '') .[small]`        | zamění výskyty dle regulárního výrazu
| `padLeft`   `(length, pad = ' ') .[small]`            | doplní řetězec zleva na požadovanou délku
| `padRight`  `(length, pad = ' ') .[small]`            | doplní řetězec zprava na požadovanou délku
| `repeat`    `(count) .[small]`                        | opakování řetězce
| `implode`   `(glue = '') .[small]`                    | spojí pole do řetězce
| `webalize`                                            | [upraví UTF-8 řetězec do tvaru používaného v URL |#webalize]
| `breakLines`                                          | [Před konce řádku přidá HTML odřádkování |#breakLines]
| `reverse`                                             | [obrátí UTF-8 řetězec nebo pole |#reverse]
| `length`                                              | vrací délku řetězce ve znacích nebo pole
| `batch`  `(array, length [, item]) .[small]`          | [výpis lineárních dat do tabulky |#batch]

.[table-latte-summary]
|## Velikost písmen
| `lower`      | [převede na malá písmenka |#Velikost písmen]
| `upper`      | [převede na velká písmenka |#Velikost písmen]
| `firstUpper` | [převede první písmenko na velké |#Velikost písmen]
| `capitalize` | [malá písmena, první písmeno ve slovech velké |#Velikost písmen]

.[table-latte-summary]
|## Formátování hodnot
| `date`      `(format) .[small]`                       | [formátuje datum |#date]
| `number`    `(decimals = 0, decPoint = '.') .[small]` | [formátuje číslo |#number]
| `bytes`     `(precision = 2) .[small]`                | [formátuje velikost v bajtech |#bytes]
| `dataStream` `(mimetype = detect) .[small]`           | [konverze pro Data URI protokol |#datastream]

.[table-latte-summary]
|## Escapování
| `noescape`                                        | [vypíše proměnnou bez escapování |tags#vypsani-promenne]
| `escapeUrl`                                       | [escapuje parametr v URL |#escapeUrl]

Dále existují escapovací filtry pro HTML (`escapeHtml` a `escapeHtmlComment`), XML (`escapeXml`), JavaScript (`escapeJs`), CSS (`escapeCss`) a iCalendar (`escapeICal`),
které Latte používá samo díky [kontextově sensitivnímu escapováním|guide#Kontextově sensitivní escapování] a nemusíte je zapisovat.

.[table-latte-summary]
|## Bezpečnost
| `noCheck`                                         | [předejde automatickému ošetření URL adresy |#noCheck]
| `checkUrl`                                        | ošetří URL adresu od nebezpečných vstupů

Latte atributy `src` a `href` [kontroluje automaticky |guide#Kontrola odkazů], takže filtr `checkUrl` téměř nemusíte používat.


.[note]
Všechny výchozí filtry jsou určeny pro řetězce v kódování UTF-8.

Použití
-------

Filtry se zapisují za svislítko (může být před ním mezera) do tzv. modifikátoru:

```html
<h1>{$heading|upper}</h1>
```

Filtry (ve starších verzích helpery) lze zřetězit a poté se aplikují v pořadí od levého k pravému:

```html
<h1>{$heading|lower|capitalize}</h1>
```

Parametry se zadávají za jménem filtru oddělené dvojtečkami nebo čárkami:

```html
<h1>{$heading|truncate:20,''}</h1>
```

Filtry lze aplikovat i na výraz:

```html
{var $name = ($title|upper) . ($subtitle|lower)}</h1>
```

Jako filtr lze do šablony zaregistrovat libovolný callback:

```php
$latte = new Latte\Engine;
$latte->addFilter('shortify', function (string $s, int $len = 10): string {
	return mb_substr($s, 0, $len);
});
```

V šabloně se potom volá takto:

```html
<p>{$text|shortify}</p>
<p>{$text|shortify:100}</p>
```


truncate
--------

Ořízne řetězec na uvedenou maximální délku, přičemž se snaží zachovávat celá slova. Pokud dojde ke zkrácení řetězce, přidá nakonec trojtečku (lze změnit druhým parametrem).

```html
{var $title = 'Řekněte, jak se máte?'}
{$title|truncate:5} Řekn…
{$title|truncate:20} Řekněte, jak se…
{$title|truncate:30} Řekněte, jak se máte?
```


strip
-----

Odstraní zbytečné bílé místo (mezery) z výstupu.

```html
{block |strip}
	<ul>
		<li>Hello</li>
	</ul>
{/block}
```

Vygeneruje

```html
<ul> <li>Hello</li> </ul>
```


indent
------

Odsadí text zleva o daný počet tabulátorů nebo jiných znaků, které můžeme uvést ve druhém argumentu:

```html
<div>
{block |indent}
<p>Hello</p>
{/block}
</div>
```

Vygeneruje

```html
<div>
	<p>Hello</p>
</div>
```


webalize
--------
Filtr odstraní diakritiku a všechny znaky kromě písmen anglické abecedy a číslic nahradí spojovníkem. Vyžaduje instalaci [nette/utils |api:Nette\Utils].

```html
{var $s = 'Náš 10. produkt'}
{$s|webalize} nas-10-produkt
```


breakLines
----------
Přidává před každý znak nového řádku HTML značku `<br>`. Vstupní text je automaticky escapován.
```html
{var $s = "Text & with \n newline"}
{$s|breakLines} "Text &amp; with <br>\n newline"
```


reverse
-------
```html
{var $s = 'Nette'}
{$s|reverse} etteN
{var $a = ['N', 'e', 't', 't', 'e']}
{$a|reverse} ['e', 't', 't', 'e', 'N']
```


Velikost písmen
---------------

```html
{var $s = 'dobrý DEN'}
{$s|lower} dobrý den
{$s|upper} DOBRÝ DEN
{$s|firstUpper} Dobrý DEN
{$s|capitalize} Dobrý Den
```


date
----

Formátuje datum podle masky buď ve tvaru používaném PHP funkcí [php:strftime] nebo [php:date]. Filtr přijímá datum buď ve formátu UNIX timestamp, v podobě řetězce nebo jako objekt `DateTime`.

```html
{$today|date:'%d.%m.%Y'}
{$today|date:'j. n. Y'}
```


number
------

Formátuje číslo na určitý počet desetinných míst. Lze určit znak pro desetinnou čárku a oddělovač tisíců.

```html
{1234.20 |number}  1,234
{1234.20 |number:1}  1,234.2
{1234.20 |number:2}  1,234.20
{1234.20 |number:2:',':' '}  1 234,20
```


bytes
-----

Formátuje velikost v bajtech do lidsky čitelné podoby.

```html
{$size|bytes} 0 B, 10 B nebo 1.25 GB, …
```


dataStream
----------

Konvertuje do data URI scheme. Pomocí něj lze do HTML nebo CSS vkládat obrázky bez nutnosti linkovat externí soubory. Podporují jej všechny moderní prohlížeče. Vyžaduje PHP rozšíření [fileinfo |http://php.net/manual/en/fileinfo.installation.php].

Mějme v proměnné obrázek `$img = Image::fromFile('obrazek.gif')`, poté

```html
<img src="{$img|dataStream}">
```

Vygeneruje například:

```html
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
9TXL0Y4OHwAAAABJRU5ErkJggg==">
```


batch
-----

*od Latte 2.7*

Zjednodušuje výpis lineárních dat do podoby tabulky. Prvním parametrem je počet sloupců, druhým (volitelným) doplňková hodnota, kterou se zarovná poslední řádek.

```html
{var $items = ['a', 'b', 'c', 'd', 'e', 'f', 'g']}
<table>
{foreach ($items|batch:3:'No item') as $row}
    <tr>
        {foreach $row as $column}
            <td>{$column}</td>
        {/foreach}
    </tr>
{/foreach}
</table>
```

vygeneruje:

```html
<table>
    <tr>
        <td>a</td>
        <td>b</td>
        <td>c</td>
    </tr>
    <tr>
        <td>d</td>
        <td>e</td>
        <td>f</td>
    </tr>
    <tr>
        <td>g</td>
        <td>No item</td>
        <td>No item</td>
    </tr>
</table>
```


escapeUrl
---------

Escapuje proměnnou pro použítí jakožto parametru v URL.

```html
<a href="http://example.com/{$name|escapeUrl}">{$name}</a>
```


noCheck
-------

Předejde automatickému ošetření URL adresy. Latte automaticky kontroluje, zda proměnná obsahuje webovou URL (tj. protokol HTTP) a předchází vypsání odkazů, které mohou představovat bezpečnostní riziko.

Pokud odkaz používá jiné schéma, např. `javascript:` nebo `data:`, a jste si jistí jeho obsahem, můžete kontrolu vypnout pomoci `|noCheck`.

```html
{var $link = 'javascript:window.close()'}

<a href="{$link}">kontrolované</a>
<a href="{$link|noCheck}">nekontrolované</a>
```

Vygeneruje:

```html
<a href="">kontrolované</a>
<a href="javascript:window.close()">nekontrolované</a>
```

{{composer: latte/latte}}
