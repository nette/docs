ČNB - aktuální kurzovní lístek
********************

Pomocí pluginu můžete stáhnout libovolnou měnu a nechat ji na jakoukoliv přepočítat.

|Verze | 1.5
|Download | [cnb.zip | attachment:cnb.zip]
|Ukázka | [ČNB | http://nette.gepard-mb.cz/cnb/]
|Forum thread | http://forum.nette.org/cs/1880-cnb-ceska-narodni-banka
|Autor | Milan Matějček ([matata | http://forum.nette.org/cs/profile.php?id=1966])
|Licence | New BSD License

Instalace
---------

Stáhněte archiv [cnb.zip | attachment:cnb.zip] a jeho obsah si uložte dle vaší adresářové struktury např: do "app/plugin". V archivu je soubor Cnb.php, v něm je ukázka použití kódu a samotná funkcionalita. Doporučuji přečíst vlákno ve fóru.


.[note]
**Příklad použití jako helper v šabloně**

**BasePresenter.php**
/--php
/**
 * staticky ulozena instance Cnb();
 * @var Cnb
 */
static public $currency;

/**
 * registrace helperu
 */
protected function beforeRender()
{
//'?n' je bool tzn 1 nebo 0, default je 0 to se nic nemeni, globalni nastaveni zda zobrazovat rovnou s DPH nebo bez
    self::$currency = new Cnb( $this->getHttpRequest()->getQuery('m'), $this->getHttpRequest()->getQuery('n') );
    $this->template->registerHelper('currency', __CLASS__ .'::currency');
    $this->template->registerHelper('vat', __CLASS__ .'::vat');
}

/**
 * helper pro sablonu
 */
public static function currency($number, $from=false, $to=false, $vat=false)
{
    return self::$currency->format($number, $from, $to, $vat);
}

public static function vat()
{
    return self::$currency->formatVat();
}
\--

**default.phtml**
/--php
{? $price=100;}
{$price|currency}
{$price|vat}
{* bude-li ?n=1 obe hodnoty budou stejne}
\--

v url pro viditelne zmeny staci pridat **?m=eur&n=1**


.[note]
**Nasledující ukázka je použití mimo Nette šablony**


**Nepouzivateli Nette, pro správné fungování je potřeba nastavit tempDir**
/--php
Environment::loadConfig();
Environment::setVariable('tempDir', APP_DIR . '/temp');
\--
a doporučuji nastavit expiraci cookie a spuštení session které třída také využívá
/--php
$session    =Environment::getSession();
$session    ->setExpiration(15552000);//180 dni
if (!$session->isStarted())
    $session->start();
\--
Předpokládá se že využíváte RobotLoader

kódy jako czk, rub, eur, usd jsou vzaty z kurzovního lístku na url Cnb::CNB_LIST

staci za url zadat **?m=eur** a vse se prepocita a zformatuje
/--php

if(!isset($_GET['m']))
    $_GET['m']=null;

$cnb    =new Cnb($_GET['m']);
//nebo $cnb    =new CnbHistory($_GET['m'], 30, 12, 2000);//budete pracovat s kurzem danneho data
echo $cnb->format(10);//10 Kč
echo $cnb->format(10, 'eur', 'usd');//převede 10 eur na dolary a vrati cca $1.56

echo $cnb->getDate('Y-m-d');//vrátí datum posledního stažení kurzovního lístku
Debug::dump( $cnb->getAllCode());//všechny dostupné měny a jejich vlastnosti se kterými můžete pracovat
\--
v1.5
------
-podpora zobrazovani cen s dph i bez dph

v1.4
------
-trosku pozmenena struktura souboru na disku
-nove stahovani historie s ukladanim do databaze

v1.3
------
-nova metoda __call, pro rychlejsi pristup k informacim
-odstranena metoda defineMoney() nahrazena getRating()
-moznost stazeni starsiho kurzu, pouzijte tridu CnbHistory
-nove se uklada id kurzu vydaneho za danny rok a datum
-historie ma jedno omezeni, tj nestahuje Cnb::CNB_LIST2 techto men se nevede historie

v1.2
------
-nova metoda defineMoney() spolupracuje s vlastnosti $defineMoney kde si nastavite vychozi pro web
-metoda format ma novy parametr $change kdy lze vybrat zda se ma nebo nema mena prepocitat
-fix: opravena moznost korekce men
-vlastnosti static prevedeny na dynamicke aby sli dedenim menit
-funkcnost i bez Nette avsak prijdete o ukladani do session, trida Cnb2 upne dole
-fix: opraveno nacitani pres CUrl

v1.1
------
-stahuje kompletne cely kurzovni listek a nacte se online pouze prepocet ktery bude potreba
-tzn nemusite premyslet nad tim jake vsechny meny budete potrebovat
-vsechny dostupne meny ziskate pomoci metody getAllCode()
-vylepsena metoda format(), nyni si lze nastavit z ceho na co prepocitat a zformatuje podle nastaveni

v1.0
------
-nova metoda format(), ktera formatuje kazdou menu samostatne, tzn mate czk → 15 365 Kč, usd → $1,955.35, gbp → £1 568.45

v0.9.1
------
-vnitrni upravy bez vlivu na funkcnos

v0.9
----
-pridan helper pro sablony na upravu formatu cisla, vychazel jsem z [Helper currency | helper-currency]


{{attachment: cnb.zip}}
{{attachment: cnb.zip}}

{{author: h4kuna|1966}}
