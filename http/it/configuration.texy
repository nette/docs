Configurazione di HTTP
**********************

.[perex]
Panoramica delle opzioni di configurazione di Nette HTTP.

Se non si utilizza l'intero framework, ma solo questa libreria, leggere [come caricare la configurazione |bootstrap:].


Intestazioni HTTP .[#toc-http-headers]
======================================

```neon
http:
	# headers that are sent with each request
	headers:
		X-Powered-By: MyCMS
		X-Content-Type-Options: nosniff
		X-XSS-Protection: '1; mode=block'

	# affects header X-Frame-Options
	frames: ...      # (string|bool) defaults to 'SAMEORIGIN'
```

Per motivi di sicurezza, il framework invia un'intestazione `X-Frame-Options: SAMEORIGIN`, che dice che una pagina può essere visualizzata all'interno di un'altra pagina (nell'elemento `<iframe>`) solo se si trova sullo stesso dominio. Questo può essere indesiderato in alcune situazioni (per esempio, se si sta sviluppando un'applicazione Facebook), quindi il comportamento può essere modificato impostando i frame `frames: http://allowed-host.com`.


Politica di sicurezza dei contenuti .[#toc-content-security-policy]
-------------------------------------------------------------------

Le intestazioni `Content-Security-Policy` (d'ora in poi denominate CSP) possono essere facilmente assemblate; la loro descrizione si trova nella [descrizione delle CSP |https://content-security-policy.com]. Le direttive CSP (come `script-src`) possono essere scritte come stringhe secondo le specifiche o come array di valori per una migliore leggibilità. Non è quindi necessario scrivere le virgolette intorno a parole chiave come `'self'`. Nette genererà automaticamente anche un valore di `nonce`, quindi `'nonce-y4PopTLM=='` sarà inviato nell'intestazione.

```neon
http:
	# Content Security Policy
	csp:
		# string according to CSP specification
		default-src: "'self' https://example.com"

		# array of values
		script-src:
			- nonce
			- strict-dynamic
			- self
			- https://example.com

		# bool in the case of switches
		upgrade-insecure-requests: true
		block-all-mixed-content: false
```

Utilizzare `<script n:nonce>...</script>` nei template e il valore nonce verrà compilato automaticamente. Creare siti web sicuri in Nette è davvero facile.

Allo stesso modo, è possibile aggiungere le intestazioni `Content-Security-Policy-Report-Only` (che può essere utilizzata in parallelo con CSP) e [Feature Policy |https://developers.google.com/web/updates/2018/06/feature-policy]:

```neon
http:
	# Content Security Policy Report-Only
	cspReportOnly:
		default-src: self
		report-uri: 'https://my-report-uri-endpoint'

	# Feature Policy
	featurePolicy:
		unsized-media: none
		geolocation:
			- self
			- https://example.com
```


Cookie HTTP .[#toc-http-cookie]
-------------------------------

È possibile modificare i valori predefiniti di alcuni parametri dei metodi [Nette\Http\Response::setCookie() |response#setCookie] e session.

```neon
http:
	# cookie scope by path
	cookiePath: ...        # (string) defaults to '/'

	# which hosts are allowed to receive the cookie
	cookieDomain: 'example.com'  # (string|domain) defaults to unset

	# to send cookies only via HTTPS?
	cookieSecure: ...      # (bool|auto) defaults to auto

	# disables the sending of the cookie that Nette uses as protection against CSRF
	disableNetteCookie: ...  # (bool) defaults to false
```

L'opzione `cookieDomain` determina quali domini (origini) possono accettare i cookie. Se non è specificata, il cookie viene accettato dallo stesso (sotto)dominio in cui è impostato, *escludendo* i suoi sottodomini. Se viene specificato `cookieDomain`, sono inclusi anche i sottodomini. Pertanto, specificare `cookieDomain` è meno restrittivo che ometterlo.

Ad esempio, se viene impostato `cookieDomain: nette.org`, il cookie è disponibile anche su tutti i sottodomini come `doc.nette.org`. Questo può essere ottenuto anche con il valore speciale `domain`, cioè `cookieDomain: domain`.

Il valore predefinito di `cookieSecure` è `auto`, il che significa che se il sito web funziona su HTTPS, i cookie saranno inviati con il flag `Secure` e saranno quindi disponibili solo tramite HTTPS.


Proxy HTTP .[#toc-http-proxy]
-----------------------------

Se il sito funziona dietro un proxy HTTP, inserire l'indirizzo IP del proxy in modo che il rilevamento delle connessioni HTTPS funzioni correttamente, oltre all'indirizzo IP del client. In altre parole, affinché [Nette\Http\Request::getRemoteAddress() |request#getRemoteAddress] e [isSecured() |request#isSecured] restituiscano i valori corretti e i link siano generati con il protocollo `https:` nei template.

```neon
http:
	# IP address, range (ie. 127.0.0.1/8) or array of these values
	proxy: 127.0.0.1       # (string|string[]) defaults to none
```


Sessione .[#toc-session]
========================

Impostazioni di base [delle sessioni |sessions]:

```neon
session:
	# shows session panel in Tracy Bar?
	debugger: ...        # (bool) defaults to false

	# inactivity time after which the session expires
	expiration: 14 days  # (string) defaults to '3 hours'

	# when to start the session?
	autoStart: ...       # (smart|always|never) defaults to 'smart'

	# handler, service that implements the SessionHandlerInterface interface
	handler: @handlerService
```

L'opzione `autoStart` controlla quando avviare la sessione. Il valore `always` significa che la sessione viene sempre avviata all'avvio dell'applicazione. Il valore `smart` significa che la sessione verrà avviata all'avvio dell'applicazione solo se esiste già, oppure nel momento in cui si vuole leggere o scrivere su di essa. Infine, il valore `never` disabilita l'avvio automatico della sessione.

È inoltre possibile impostare tutte le [direttive di sessione |https://www.php.net/manual/en/session.configuration.php] di PHP (in formato camelCase) e anche [readAndClose |https://www.php.net/manual/en/function.session-start.php#refsect1-function.session-start-parameters]. Esempio:

```neon
session:
	# 'session.name' written as 'name'
	name: MYID

	# 'session.save_path' written as 'savePath'
	savePath: "%tempDir%/sessions"
```


Cookie di sessione .[#toc-session-cookie]
-----------------------------------------

Il cookie di sessione viene inviato con gli stessi parametri degli [altri cookie |#HTTP cookie], ma è possibile modificarli:

```neon
session:
	# which hosts are allowed to receive the cookie
	cookieDomain: 'example.com'   # (string|domain)

	# restrictions when accessing cross-origin request
	cookieSamesite: None          # (Strict|Lax|None) defaults to Lax
```

L'opzione `cookieSamesite` influisce sull'invio del cookie con le [richieste di origine incrociata |nette:glossary#SameSite cookie], il che fornisce una certa protezione contro gli attacchi di [Cross-Site Request Forgery |nette:glossary#cross-site-request-forgery-csrf].
